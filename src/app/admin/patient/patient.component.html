<mat-tab-group>
  <mat-tab label="Billing">
    <div class="container-fluid registrationform">
      <form [formGroup]="patientRegistrationForm">
        <div style="margin-bottom: -1px" class="patient">
          <h2 class="m-0">PATIENT REGISTRATION</h2>
          <div class="button-group">
            <div class="mr-2">
              <mat-form-field class="example-full-width">
                <input
                  type="text"
                  placeholder="Search  By Name or PID"
                  aria-label="Number"
                  matInput
                  [(ngModel)]="selectValue"
                  [formControl]="myControl"
                  (keyup)="getpatients($event)"
                  [matAutocomplete]="auto"
                />
                <!-- (keyup)="checkPin($event)"  -->
                <mat-autocomplete
                  autoActiveFirstOption
                  #auto="matAutocomplete"
                  (optionSelected)="onFileChange($event.option.value)"
                >
                  <mat-option
                    *ngFor="let option of options"
                    [value]="option.pid"
                    multiple
                  >
                    {{ option?.name }} {{ option?.mobileNumber }}
                    {{ option?.pid }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>
            <button
              style="height: 40px"
              class="btn-primary mr-2"
              *ngIf="patientdetailsdata?.pid"
              printSectionId="print-barcode"
              ngxPrint
            >
              Print Barcode
            </button>
          </div>
        </div>

        <div *ngIf="!showQuestioner && !showUploadFiles">
          <div class="card bg-light">
            <!-- <div class="card-body firstCard">
              <div class="card p-3" *ngIf="isSubDivisionPatient">
                <div class="progress-bar-icons" style="height: 73px;">
                  <ul>
                    <li [ngClass]="{ active: patientaccshow === 'patient' }">
                      <span>Patient</span>
                      <p class="active"></p>
                    </li>
                    <li [ngClass]="{ active: testaccshow === 'test' }">
                      <span>Tests</span>
                      <p class="active"></p>
                    </li>
                    <li [ngClass]="{ active: vaccineaccshow === 'vaccine' }"
                      *ngIf="patientdetailsdata?.isVaccineREG == true">
                      <span>Vaccine</span>
                      <p class="active"></p>
                    </li>
                    <li [ngClass]="{ active: pastaccshow === 'past' }">
                      <span>Past Medic History</span>
                      <p class="active"></p>
                    </li>
                    <li [ngClass]="{ active: familyaccshow === 'family' }">
                      <span>Family History</span>
                      <p class="active"></p>
                    </li>
                    <li [ngClass]="{ active: doctorReviewshow === 'doctorReview' }">
                      <span>Doctor Review</span>
                      <p class="active"></p>
                    </li>
                    <li [ngClass]="{ active: questionnaireshow === 'questionnaireView' }" *ngIf="showQuestionnaireView">
                      <span>Questionnaire</span>
                      <p class="active"></p>
                    </li>
                    <li [ngClass]="{ active: billingshow === 'billing' }">
                      <span>Billing</span>
                      <p class="active"></p>
                    </li>
                  </ul>
                </div>
              </div>
            </div> -->
            <div class="card-body firstCard">
              <div class="card p-3">
                <div class="row">
                  <div class="col-lg-3">
                    <div class="form-group">
                      <label for="">Patient Name</label>
                      <span
                        style="color: red; font-size: 17px"
                        class="ng-star-inserted"
                      >
                        *</span
                      >
                      <input
                        class="form-control"
                        formControlName="name"
                        [ngClass]="{
                          'is-invalid': submitted && f.name.errors
                        }"
                      />
                      <div
                        *ngIf="submitted && f.name.errors"
                        class="invalid-feedback"
                      >
                        <div *ngIf="f.name.errors.required">
                          Please enter name
                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                      <label style="padding-right: 19px">Mobile</label>
                      <!-- <input type="text" class="form-control" formControlName="mobileNumber" required [ngClass]="{
                          'is-invalid': submitted && f.mobileNumber.errors
                        }" max="10" min="10" required pattern="^[0-9]\d{9}$" (keypress)="checkIfNumber($event)" /> -->
                      <mat-form-field style="width: 100%" appearance="none">
                        <input
                          class="mobileInput"
                          type="text"
                          placeholder="Search By Mobile"
                          aria-label="Number"
                          matInput
                          formControlName="mobileNumber"
                          required
                          [ngClass]="{
                            'is-invalid': submitted && f.mobileNumber.errors
                          }"
                          (keyup)="getpatients($event)"
                          [matAutocomplete]="auto"
                          max="10"
                          min="10"
                          required
                          pattern="^[0-9]\d{9}$"
                          (keypress)="checkIfNumber($event)"
                        />

                        <mat-autocomplete
                          autoActiveFirstOption
                          #auto="matAutocomplete"
                          (optionSelected)="onFileChange($event.option.value)"
                        >
                          <mat-option
                            *ngFor="let option of options"
                            [value]="option.pid"
                            multiple
                          >
                            {{ option?.mobileNumber }}
                          </mat-option>
                        </mat-autocomplete>
                      </mat-form-field>

                      <div
                        *ngIf="submitted && f.mobileNumber.errors"
                        class="invalid-feedback"
                        (input)="patientDynamicFormValidation()"
                        required
                      >
                        <div *ngIf="f.mobileNumber.errors.required">
                          MobileNumber must be a valid MobileNumber
                        </div>
                      </div>
                    </div>

                    <!-- tryagain -->
                    <div class="mb-5">
                   
                        <div
                     [formGroupName]="i">
                     <label for="">Book Your slot</label>
                     <input
                       class="select_date date mt-2"
                       type="date"
                       [min]="minDate"
                       formControlName="sampleDate"
                       (change)="onTestDateChange($event)"
/>
                 
                  
                     
<input
 placeholder="Select Time"
 class="mt-1 select_time1"
 [ngxTimepicker]="range"
 formControlName="sampleTime"
 min="{{ timePickerMin }}"
 readonly
/>
<ngx-material-timepicker
 #range
 (timeSet)="setTime($event)"
>
</ngx-material-timepicker>
                   </div> 

                    </div>
                  </div>
                  <div class="col-lg-3">
                    <div class="form-group">
                      <label>Gender</label>
                      <span
                        style="color: red; font-size: 17px"
                        class="ng-star-inserted"
                      >
                        *</span
                      >
                      <select
                        class="form-control"
                        formControlName="gender"
                        [ngClass]="{
                          'is-invalid': submitted && f.gender.errors
                        }"
                        required
                      >
                        <option value="" disabled>Select Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                      </select>
                      <div
                        *ngIf="submitted && f.gender.errors"
                        class="invalid-feedback"
                      >
                        <div *ngIf="f.gender.errors.required">
                          :Please Select a Gender
                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                      <label>Email</label>
                      <input
                        type="text"
                        class="form-control"
                        formControlName="emailAddress"
                        [ngClass]="{
                          'is-invalid': submitted && f.emailAddress.errors
                        }"
                        (input)="patientDynamicFormValidation()"
                        required
                      />
                      <div
                        *ngIf="submitted && f.emailAddress.errors"
                        class="invalid-feedback"
                      >
                        <div *ngIf="f.emailAddress.errors.required">
                          Email must be a valid email address
                        </div>
                      </div>
                    </div>
                    <!-- find -->
                    <!--  -->
              
                    <!-- start -->
                    
                    <!-- end -->
                    
                    <!-- <div class="col-lg-2">
                      <div class="form-group" class="fieldtop">
                        <label style="margin-left: -5px">Slot Booking</label>
                      <mat-form-field>
    <input matInput [ngxMatDatetimePicker]="picker" placeholder="Choose a date & time" [(ngModel)]="myDatePicker">
    
    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>

    <ngx-mat-datetime-picker #picker></ngx-mat-datetime-picker>
</mat-form-field>

                    </div>
                    </div> -->

                    <!-- <p *ngIf="patientdetailsdata?.createdAt">Date:{{patientdetailsdata?.createdAt | date:'dd-MM-yyyy'}}</p> -->
                  </div>
                    <div class="col-lg-3">
                      <div class="form-group">
                        <label for="">PID</label>
                      <button
                        class="btn-btn-primary scanButton"
                        (click)="sacnEanble()"
                        type="submit"
                        id="pid-b"
                        *ngIf="!hideScannerbutton"
                      >
                        Scan
                      </button>
                      <input
                        class="form-control"
                        formControlName="PID"
                        [attr.disabled]="disbalePIDInput"
                        #search
                      />
                    </div>
                    <div
                      class="form-group"
                      [ngClass]="{
                        visiable: patientdetailsdata?.createdAt,
                        visiableNone: !patientdetailsdata?.createdAt
                      }"
                    >
                      <label for="">REG. Date</label>
                      <input
                        class="form-control"
                        disabled
                        [value]="
                          patientdetailsdata?.createdAt
                            | date: 'dd-MM-yyyy HH:mm'
                        "
                      />
                    </div>
                  </div>
                  <div class="col-lg-2">
                    <div class="qr-code border-success">
                      <label style="margin-left: 73px">Bar Code</label>
                      <ngx-barcode
                        [bc-value]="value"
                        [bc-display-value]="true"
                        class="barcode"
                      ></ngx-barcode>
                    </div>
                    <!-- dusra -->
<!--                     
           
                    <div class="col-lg-3">
                      <mat-form-field>
    <input matInput [ngxMatDatetimePicker]="picker" placeholder="Choose a date & time" [(ngModel)]="myDatePicker">
    
    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>

    <ngx-mat-datetime-picker #picker></ngx-mat-datetime-picker>
</mat-form-field>

                    </div> -->
                    <!--  -->

                    <!-- <div class="qr-code border-success">
                                    <label class="d-block">QR Code</label>
                                    <ngx-qrcode    [elementType]="'svg'" 
                                    [value] = "value"
                                    cssClass = "aclass"
                                    [width]="120"
                                    errorCorrectionLevel = "L">
                                    </ngx-qrcode>
                                </div> -->
                    <!-- <div class="row">
                      
                      <div class="col-md-6"> -->

                    <!-- </div> -->

                    <!-- <div class="col-md-6">
                        <img src="../../../assets/PreviaLogo.png" class="img-responsive img-fluid" /> -->
                    <!-- <img [src]="sanitizer.bypassSecurityTrustUrl('/' + cardModel[r.content].value)" /> -->
                    <!-- </div> -->
                    <!-- </div> -->
                  </div>

                  <div class="col-lg-2">
                    <div
                      class="form-group"
                      class="fieldtop"
                      *ngIf="ageSelected == true"
                    >
                      <label>DOB</label>
                      <input
                        type="date"
                        class="form-control"
                        formControlName="DOB"
                        [(ngModel)]="dateValue"
                        [max]="getToday()"
                        (click)="dobClick()"
                        (change)="onDateChange($event)"
                      />
                    </div>
                  </div>
                  <div class="col-lg-1" *ngIf="dobSelected == true">
                    <div class="form-group" class="fieldtop">
                      <label>Age</label>

                      <input
                        type="text"
                        class="form-control"
                        [(ngModel)]="age"
                        [ngModelOptions]="{ standalone: true }"
                        (input)="getDate($event)"
                        (click)="ageClick()"
                      />
                    </div>
                  </div>
                  <div class="col-lg-1" *ngIf="dobSelected == true">
                    <div class="form-group" style="margin-top: 4px">
                      <select class="form-control">
                        <option>Days</option>
                        <option>Months</option>
                        <option>Years</option>
                      </select>
                    </div>
                  </div>
                  <!-- <div class="col-lg-2">
                    <div class="form-group">
                      <label>Proof Details</label>
                      <div class="">
    
                        <ng-select formControlName="proofType" (input)="patientDynamicFormValidation()">
                          <ng-option value="" disabled>Select Proof</ng-option> -->
                  <!-- <ng-option *ngFor="let item of proofDetails" value="{{item}}">{{item}}</ng-option> -->
                  <!-- <ng-option value="voter">Voter Id</ng-option>
                          <ng-option value="license">License</ng-option>
                          <ng-option value="others">Others</ng-option>
                        </ng-select>
    
                      </div>
    
                    </div>
                  </div>
                  <div class="col-lg-3 " style="margin-top: 26px;">
                    <input  type="text" class="form-control" placeholder="Enter Id No" [ngClass]="{
                      'is-invalid':
                       f.proofType.value&& f.proofValue.errors 
                    }"  formControlName="proofValue" maxlength="16" />
    
    
                    <div *ngIf=" f.proofValue.errors && f.proofType.value " class="invalid-feedback">
                      <div *ngIf="f.proofValue.errors.required ">
                        Please enter Id No</div> -->
                  <!-- <div *ngIf="f.proofValue.errors.maxlength ">
                          Please enter 16 digits Id No</div> -->
                  <!-- </div>
                  </div>
   -->
                  <div class="col-lg-2">
                    <div class="form-group" class="fieldtop">
                      <label style="margin-left: -12px">Aadhar</label>
                      <!-- <input class="form-control" formControlName="aadhaar" required
                        [ngClass]="{ 'is-invalid': submitted && f.aadhaar.errors }" max="12" min="12" required
                        pattern="^[0-9]\d{9}$" (keypress)="checkIfNumberAadhar($event)"
                        (input)="patientDynamicFormValidation()" /> -->

                      <mat-form-field
                        style="width: 100%; margin-left: -16px"
                        appearance="none"
                      >
                        <input
                          type="text"
                          class="mobileInput"
                          placeholder="Search By aadhaar"
                          aria-label="Number"
                          matInput
                          formControlName="aadhaar"
                          [ngClass]="{
                            'is-invalid': submitted && f.aadhaar.errors
                          }"
                          max="12"
                          min="12"
                          required
                          pattern="^[0-9]\d{9}$"
                          (keypress)="checkIfNumberAadhar($event)"
                          (input)="patientDynamicFormValidation()"
                          (keyup)="getpatients($event)"
                          [matAutocomplete]="auto"
                        />

                        <mat-autocomplete
                          autoActiveFirstOption
                          #auto="matAutocomplete"
                          (optionSelected)="onFileChange($event.option.value)"
                        >
                          <mat-option
                            *ngFor="let option of options"
                            [value]="option.pid"
                            multiple
                          >
                            {{ option?.aadhaar }}
                          </mat-option>
                        </mat-autocomplete>
                      </mat-form-field>
                      <div
                        *ngIf="submitted && f.aadhaar.errors"
                        class="invalid-feedback"
                      >
                        <div *ngIf="f.aadhaar.errors.required">
                          Please enter valid Aadhar
                        </div>
                      </div>
                    </div>
                  </div>
                  <!-- <div class="col-lg-2">
                  
                  </div>
                  <div class="col-lg-2">
                  
                  </div>
                  <div class="col-lg-2 mt-4">
    
                   
                  </div>
                  <div class="col-lg-3">
                  
                  </div> -->
                  <div class="col-lg-2">
                    <div class="form-group" class="fieldtop">
                      <label style="margin-left: -5px">Passport</label>
                      <!-- <input type="text" class="form-control" formControlName="passport" /> -->
                      <mat-form-field
                        style="
                          max-width: 100%;
                          margin-left: -16px;
                          display: inline;
                        "
                        appearance="none"
                      >
                        <input
                          class="mobileInput"
                          style="margin-left: -6%"
                          type="text"
                          placeholder="Search By passport"
                          aria-label="Number"
                          matInput
                          formControlName="passport"
                          (keyup)="getpatients($event)"
                          [matAutocomplete]="auto"
                        />

                        <mat-autocomplete
                          autoActiveFirstOption
                          #auto="matAutocomplete"
                          (optionSelected)="onFileChange($event.option.value)"
                        >
                          <mat-option
                            *ngFor="let option of options"
                            [value]="option.pid"
                            multiple
                          >
                            {{ option?.passport }}
                          </mat-option>
                        </mat-autocomplete>
                      </mat-form-field>
                    </div>
                  </div>

                  <div class="col-lg-2">
                    <div class="form-group" class="fieldtop">
                      <label>Kyc</label>
                      <input
                        type="text"
                        class="form-control"
                        formControlName="kycDetails"
                      />
                    </div>
                    <!-- <div class="form-group" class="fieldtop">
                      <label>Occupation</label>
                      <input type="text" class="form-control" formControlName="occupation" />
                    </div> -->
                  </div>
                  <div class="col-lg-2">
                    <div
                      class="qr-code border-success"
                      style="margin-top: -30px"
                    >
                      <label style="margin-left: 19px">QR Code</label>

                      <qrcode
                        [qrdata]="value"
                        [width]="100"
                        [errorCorrectionLevel]="'M'"
                        style="margin-top: -11px"
                      >
                      </qrcode>
                    </div>
                  </div>
                  <!-- <div class="col-lg-3">
                    <div class="form-group">
                      <label>City</label>
                      <input type="text" class="form-control" formControlName="city" />
                    </div>
                  </div>
                  <div class="col-lg-3">
                    <div class="form-group">
                      <label>State</label>
                      <input type="text" class="form-control" formControlName="state" />
                    </div>
                  </div> -->
                  <!-- <div class="col-lg-4">
                    <div class="form-group">
                      <label>Address</label>
                      <textarea type="text" class="form-control" formControlName="address"></textarea>
                    </div>
                  </div> -->
                  <!-- <div class="col-lg-4">
                    <div class="form-group">
                      <label>Habits</label>
                      <textarea class="form-control" formControlName="habits"></textarea>
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div class="form-group">
                      <label>LifeStyle</label>
                      <textarea type="text" class="form-control" formControlName="lifeStyle"></textarea>
                    </div>
                  </div> -->
                  <!-- <div class="col-lg-2">
                                    <div class="form-group">
                                        <label class="mb-3">Default Test package</label>
                                        <mat-checkbox class="defaultCheckBox" (change)="selectDefaultTestPackages($event)"
                                            [checked]="isDefaultTestPackage">
                                            Default Test package</mat-checkbox>
                                    </div>
                                </div> -->
                </div>

                <div class="row mt-2" *ngIf="isSubDivisionPatient">
                  <!-- <div class="col-md-1"> -->
                  &nbsp;&nbsp;<label style="margin-top: -6px; margin-left: 7px"
                    >Select Address</label
                  >
                  <!-- </div> -->
                  <div class="col-md-10 col-10">
                    <div class="form-group">
                      <input
                        style="
                          margin-left: 40px;
                          width: 900px;
                          margin-top: -15px;
                        "
                        type="text"
                        class="form-control"
                        (keydown.enter)="$event.preventDefault()"
                        placeholder="Search Patient Address"
                        autocorrect="off"
                        autocapitalize="off"
                        spellcheck="off"
                        type="text"
                        formControlName="address"
                        #searchtext
                      />
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-lg-4">
                    <div class="form-group">
                      <label>Address 2</label>
                      <!-- <div class="col-md-12 col-12"> -->

                      <textarea
                        rows="1"
                        type="text"
                        class="form-control"
                        formControlName="address2"
                      ></textarea>
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div class="form-group">
                      <label>City</label>
                      <input
                        type="text"
                        class="form-control"
                        formControlName="city"
                      />
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div class="form-group">
                      <label>State</label>
                      <input
                        type="text"
                        class="form-control"
                        formControlName="state"
                      />
                    </div>
                  </div>
                </div>

                <div class="row" *ngIf="isSubDivisionPatient">
                  <div class="col-md-2">
                    <h3 style="font-weight: bold; margin-top: 10px">
                      Test/Packages
                    </h3>
                  </div>
                  <div class="col-md-4 col-4" style="right: 30px">
                    <mat-form-field class="example-full-width searchTest">
                      <input
                        type="text"
                        class="input"
                        placeholder="Search Tests"
                        aria-label="Number"
                        matInput
                        [(ngModel)]="testControl"
                        [ngModelOptions]="{ standalone: true }"
                        (keyup)="getTests($event)"
                        [matAutocomplete]="auto1"
                      />
                      <mat-autocomplete
                        autoActiveFirstOption
                        #auto1="matAutocomplete"
                        (optionSelected)="
                          onChangeTestValue($event.option.value)
                        "
                      >
                        <mat-option
                          *ngFor="let option of tests"
                          [value]="option"
                        >
                          {{ option?.name }} <b>|</b> {{ option?.type }}
                          <b>|</b> {{ option?.price || 0 | currency: "INR" }}
                        </mat-option>
                      </mat-autocomplete>
                    </mat-form-field>
                    <!-- <h3 class="col-md-6 col-lg-6 col-6"></h3>
                  <h3 class="col-md-3 col-lg-3 col-3" style="font-weight: bold;" *ngIf="totalAmount">Total Amount:
                    {{totalAmount}}</h3> -->
                    <!-- <h3 class="col-md-3 col-lg-3 col-3 "><input class="inputfield" type="number" *ngIf="totalAmount"
                      placeholder="Paid Amount" formControlName="paidAmount" (input)="changePadAmount()"></h3> -->
                    <!-- <h3 >Paid Amount: {{totalPaidAmount}}</h3> -->
                    <!-- <h3 class="col-md-3 col-lg-3 col-3" *ngIf="totalAmount">Balance To Be Paid: {{totalAmount -
                    totalPaidAmount}}</h3> -->
                  </div>
                  <div
                    class="col-md-2"
                    style="font-weight: bold; margin-top: 1.5%"
                  >
                    Organization
                  </div>
                  <div
                    class="col-md-3 col-3"
                    style="right: 12px; margin-top: 1.5%"
                  >
                    <mat-icon (click)="getHospitalsData(referrerDialogue)">
                      search</mat-icon
                    >
                  </div>
                  <div class="col-md-12 col-12">
                    <div class="card">
                      <mat-card
                        *ngIf="
                          patientRegistrationForm.value.patientTestsArray
                            ?.length > 0
                        "
                      >
                        <div class="table-responsive">
                          <table class="table table-bordered">
                            <thead>
                              <tr>
                                <th>S.No</th>
                                <th>Test Names</th>
                                <th>Price</th>
                                <!-- <th>Paid Amount</th> -->
                                <th>Instructions</th>
                                <th>Date</th>
                                <th>Time</th>
                                <th>Refer By</th>
                                <th>Referral Name</th>
                                <th>Action</th>
                              </tr>
                              <tr
                                formArrayName="patientTestsArray"
                                *ngFor="
                                  let patientInfo of patientRegistrationForm.get(
                                    'patientTestsArray'
                                  )['controls'];
                                  let i = index
                                "
                              >
                                <td [formGroupName]="i">{{ i + 1 }}</td>
                                <td [formGroupName]="i">
                                  {{ patientInfo.value.name }}
                                  <p
                                    class="p-0 m-0"
                                    *ngIf="
                                      patientInfo?.value?.tests?.length > 0
                                    "
                                  >
                                    (<span
                                      *ngFor="
                                        let test of patientInfo?.value.tests
                                      "
                                      >{{ test?.name }}, </span
                                    >)
                                  </p>
                                </td>
                                <td [formGroupName]="i">
                                  {{ patientInfo?.value?.price }}
                                </td>
                                <!-- <td [formGroupName]="i">
                            <input
                              type="text"
                              class="select_vaccine"
                              formControlName="paidAmount"
                              (input)="enterTestPaidAmount()"
                            />
                          </td> -->
                                <td [formGroupName]="i">
                                  <input
                                    type="text"
                                    style="width: 300px"
                                    class="select_vaccine"
                                    formControlName="instructions"
                                  />
                                </td>
                                <td [formGroupName]="i">
                                  <input
                                    class="select_date date"
                                    type="date"
                                    [min]="minDate"
                                    formControlName="sampleDate"
                                    (change)="onTestDateChange($event)"
                                  />
                                </td>
                                <td [formGroupName]="i">
                                  <input
                                    placeholder="Select Time"
                                    class="select_time1"
                                    [ngxTimepicker]="range"
                                    formControlName="sampleTime"
                                    min="{{ timePickerMin }}"
                                    readonly
                                  />
                                  <ngx-material-timepicker
                                    #range
                                    (timeSet)="setTime($event)"
                                  >
                                  </ngx-material-timepicker>
                                </td>
                                <td [formGroupName]="i">
                                  <select
                                    style="width: 130px"
                                    class="select_vaccine"
                                    (change)="
                                      selectReferRole($event.target.value)
                                    "
                                    [(ngModel)]="referredTypeValue"
                                    formControlName="referredType"
                                  >
                                    <option hidden value="" disabled selected>
                                      Select Refer By
                                    </option>
                                    <option
                                      value="{{ refer.name }}"
                                      *ngFor="let refer of referRoles"
                                    >
                                      {{ refer.displayName }}
                                    </option>
                                  </select>
                                </td>
                                <td [formGroupName]="i">
                                  <select
                                    style="width: 182px"
                                    class="select_vaccine"
                                    [(ngModel)]="referredByValue"
                                    formControlName="referredBy"
                                  >
                                    <option hidden value="" disabled selected>
                                      Select Referral Name
                                    </option>
                                    <option
                                      value="{{ referInfo?._id }}"
                                      *ngFor="let referInfo of referRoleList"
                                    >
                                      {{ referInfo?.name }}
                                    </option>
                                  </select>
                                </td>
                                <td [formGroupName]="i">
                                  <mat-icon
                                    class="deleteTests"
                                    class="delete_icon_color"
                                    (click)="
                                      deleteTestsFromSelectionList(
                                        patientInfo,
                                        i
                                      )
                                    "
                                    style="
                                      cursor: pointer;
                                      background-color: none;
                                    "
                                    >delete
                                  </mat-icon>
                                </td>
                              </tr>
                            </thead>
                          </table>
                        </div>
                      </mat-card>
                    </div>
                  </div>
                  <br />
                  <h3
                    style="margin-left: 10px"
                    *ngIf="patientdetailsdata?.tests?.length > 0"
                  >
                    Previous Tests
                  </h3>
                  <div
                    class="table-responsive test_data_scrool example-container mat-elevation-z8"
                    *ngIf="
                      patientdetailsdata?.tests?.length > 0 &&
                      patientdetailsdata?.isReferralPatient == false
                    "
                  >
                    <div class="row m-0 mb-2 mt-2 p-0 border_info">
                      <div class="col-md-2 font-weight-bold">
                        Sample Reg Date
                      </div>
                      <div class="col-md-2 font-weight-bold">
                        Sample Rec Date
                      </div>
                      <div class="col-md-1 font-weight-bold">SID</div>
                      <div class="col-md-1 font-weight-bold">Test Name</div>
                      <div class="col-md-1 font-weight-bold p-0 m-0">Value</div>
                      <div class="col-md-1 font-weight-bold p-0 m-0">
                        Comment
                      </div>
                      <!-- <div class="col-md-2 font-weight-bold">
                      Technician Comment
                    </div> -->
                      <div class="col-md-1 font-weight-bold p-0 m-0">
                        Referred By
                      </div>
                      <div class="col-md-1 font-weight-bold">Status</div>
                      <div
                        class="col-md-1 font-weight-bold"
                        style="margin-left: 10px"
                      >
                        Action
                      </div>
                    </div>

                    <div
                      *ngFor="
                        let item of patientdetailsdata?.tests
                          | patientPreviousTests
                      "
                      class="row"
                    >
                      <div class="col-md-11">
                        <div
                          class="row m-0"
                          *ngFor="let bind of item?.packageTests"
                        >
                          <div class="col-md-2">
                            <!-- <p>{{item?.sampleDate}} {{item?.sampleTime}}</p> -->
                            <mat-form-field style="width: 150px">
                              <input
                                matInput
                                [(ngModel)]="date"
                                [ngModelOptions]="{ standalone: true }"
                                [ngxMatDatetimePicker]="picker"
                                placeholder="Choose a date"
                                [disabled]="disabled"
                              />
                              <mat-datepicker-toggle
                                matSuffix
                                [for]="picker"
                              ></mat-datepicker-toggle>
                              <ngx-mat-datetime-picker
                                #picker
                                format="hh:mm a"
                                [showSpinners]="showSpinners"
                                [showSeconds]="showSeconds"
                                [stepHour]="stepHour"
                                [stepMinute]="stepMinute"
                                [stepSecond]="stepSecond"
                              >
                              </ngx-mat-datetime-picker>
                            </mat-form-field>
                            <!-- <p><input type="date"  class="select_date date"></p> -->
                          </div>
                          <div class="col-md-2">
                            <!-- <p><input type="date"  class="select_date date"></p> -->
                            <mat-form-field style="width: 150px">
                              <input
                                matInput
                                [ngxMatDatetimePicker]="picker"
                                placeholder="Choose a date"
                                [disabled]="disabled"
                              />
                              <mat-datepicker-toggle
                                matSuffix
                                [for]="picker"
                              ></mat-datepicker-toggle>
                              <ngx-mat-datetime-picker
                                #picker
                                [format]="12"
                                [showSpinners]="showSpinners"
                                [showSeconds]="showSeconds"
                                [stepHour]="stepHour"
                                [stepMinute]="stepMinute"
                                [stepSecond]="stepSecond"
                              >
                              </ngx-mat-datetime-picker>
                            </mat-form-field>
                          </div>
                          <div class="col-md-1">
                            <p>{{ item?.sid }}</p>
                          </div>
                          <div class="col-md-1 p-1 m-0">
                            <div>{{ bind?.testName }}</div>
                          </div>
                          <div class="col-md-1 text-center p-0 m-0">
                            {{ bind?.value }}
                          </div>
                          <div class="col-md-1 p-1 m-0">
                            {{ bind?.comment }}
                          </div>
                          <!-- <div class="col-md-1 p-1 m-0">
                          {{ bind?.technicianComments }}
                        </div> -->
                          <div class="col-md-2 p-1 m-0 text-center">
                            {{
                              bind?.labReferred
                                ? bind?.labReferred?.name
                                : bind?.referred?.name
                            }}
                            -
                            {{
                              bind?.labReferred
                                ? bind?.referredType
                                : bind?.referredType
                            }}
                          </div>
                          <div class="col-md-1 p-1 m-0">
                            {{ bind?.status }}
                          </div>
                        </div>
                        <div class="row m-0" *ngIf="item?.packageTests == 0">
                          <div class="col-md-2">
                            <!-- <p>{{item?.sampleDate}} {{item?.sampleTime}}</p> -->
                            <!-- <p><input type="date"  class="select_date date"></p> -->
                            <mat-form-field style="width: 150px">
                              <input
                                [(ngModel)]="date"
                                [ngModelOptions]="{ standalone: true }"
                                matInput
                                [ngxMatDatetimePicker]="picker"
                                placeholder="Choose a date"
                                [disabled]="disabled"
                              />
                              <mat-datepicker-toggle
                                matSuffix
                                [for]="picker"
                              ></mat-datepicker-toggle>
                              <ngx-mat-datetime-picker
                                #picker
                                [format]="12"
                                [showSpinners]="showSpinners"
                                [showSeconds]="showSeconds"
                                [stepHour]="stepHour"
                                [stepMinute]="stepMinute"
                                [stepSecond]="stepSecond"
                              >
                              </ngx-mat-datetime-picker>
                            </mat-form-field>
                          </div>
                          <div class="col-md-2">
                            <!-- <p><input type="date" class="select_date date"></p> -->
                            <mat-form-field style="width: 150px">
                              <input
                                matInput
                                [ngxMatDatetimePicker]="picker"
                                placeholder="Choose a date"
                                [disabled]="disabled"
                              />
                              <mat-datepicker-toggle
                                matSuffix
                                [for]="picker"
                              ></mat-datepicker-toggle>
                              <ngx-mat-datetime-picker
                                #picker
                                [format]="12"
                                [showSpinners]="showSpinners"
                                [showSeconds]="showSeconds"
                                [stepHour]="stepHour"
                                [stepMinute]="stepMinute"
                                [stepSecond]="stepSecond"
                              >
                              </ngx-mat-datetime-picker>
                            </mat-form-field>
                          </div>
                          <div class="col-md-1">
                            <p>{{ item?.sid }}</p>
                          </div>
                          <div class="col-md-1 p-1 m-0">
                            {{ item.test?.name }}
                          </div>
                          <div class="col-md-1 text-center p-0 m-0">
                            {{ item?.value }}
                          </div>
                          <div class="col-md-1 p-1 m-0">
                            {{ item?.comment }}
                          </div>
                          <!-- <div class="col-md-1 p-1 m-0">
                          {{ item?.technicianComments }}
                        </div> -->
                          <div class="col-md-2 p-1 m-0 text-center">
                            {{
                              item?.labReferred
                                ? item?.labReferred?.name
                                : item?.referred?.name
                            }}
                            - {{ item?.referredType }}
                            <!-- {{ item?.labReferred ?
                                                    item?.referredType : item?.referredType }} -->
                          </div>
                          <div class="col-md-1 p-1 m-0">
                            {{ item?.status }}
                          </div>
                        </div>
                        <hr class="m-2" />
                      </div>

                      <div class="col-md-1 border-bottom">
                        <span class="d-flex">
                          <button
                            class="deleteTests1"
                            [class.buttonColorDisabled]="
                              item?.status == 'completed'
                            "
                            [disabled]="item?.status == 'completed'"
                            *ngIf="isSubDivisionPatient"
                            (click)="
                              cancelTestsFromSelectionList(openTestsModal, item)
                            "
                          >
                            cancel
                          </button>
                          &nbsp;
                          <button
                            [class.buttonColorDisabled]="
                              item?.status != 'completed'
                            "
                            class="download-rpt"
                            type="button"
                            [disabled]="item?.status != 'completed'"
                            (click)="
                              openDownloadReportModel(downloadTestReport, item)
                            "
                          >
                            Download Report
                          </button>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div *ngIf="patientdetailsdata?.isReferralPatient == true">
                    <div class="table-responsive">
                      <table class="table table-hover w-100">
                        <thead class="text-center">
                          <tr>
                            <th>S.No</th>
                            <th>Test Name</th>
                            <th>Test Info</th>
                            <th>Status</th>
                            <th>Actions</th>
                          </tr>
                        </thead>
                        <tbody class="text-center">
                          <tr
                            *ngFor="
                              let data of patientdetailsdata
                                ?.organizationPatientInfo?.description
                                ?.sidResultDetails;
                              let i = index
                            "
                          >
                            <td>{{ i + 1 }}</td>
                            <td>{{ data?.testName }}</td>
                            <td>
                              <button
                                [disabled]="data?.reportStatusCode == 'PR'"
                                mat-raised-button
                                class="mat-primary1"
                                (click)="
                                  openTestObjInfoModel(testObjInfo, data)
                                "
                              >
                                View
                              </button>
                            </td>
                            <td>
                              {{
                                patientdetailsdata?.organizationPatientInfo
                                  ?.description?.reportStatusCode == null
                                  ? "AwaitingSample"
                                  : patientdetailsdata?.organizationPatientInfo
                                      ?.description?.reportStatusCode == "PE"
                                  ? "Pending"
                                  : patientdetailsdata?.organizationPatientInfo
                                      ?.description?.reportStatusCode == "CO"
                                  ? "Completed"
                                  : patientdetailsdata?.organizationPatientInfo
                                      ?.description?.reportStatusCode == "AU"
                                  ? "Authorized"
                                  : patientdetailsdata?.organizationPatientInfo
                                      ?.description?.reportStatusCode == "PR"
                                  ? "Printed"
                                  : "Dispatched"
                              }}
                            </td>
                            <td>
                              <button
                                mat-raised-button
                                class="mat-primary1"
                                (click)="
                                  openDownloadReportModel(
                                    downloadTestReport,
                                    data
                                  )
                                "
                              >
                                DownloadReport
                              </button>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </div>

                  <!-- <div class="position-relative" *ngIf="isSubDivisionPatient">
                  <agm-map [latitude]="latitude" [longitude]="longitude" [zoom]="zoom">
                    <agm-marker [latitude]="latitude" [longitude]="longitude" [markerDraggable]="true" [iconUrl]="icon"
                      [iconUrl]="" (dragEnd)="markerDragEnd($event)">
                    </agm-marker>
                  </agm-map>
                  <div class="currentlocation">
                    <div>
                      <button class="btn current-btn" (click)="CurrentAddress()">
                        <img src="assets/images/352557-128.png" />
                      </button>
                    </div>
                  </div>
                </div> -->
                </div>
                <div
                  class="text-right my-2 submitButton"
                  *ngIf="!showQuestioner && !showUploadFiles"
                >
                  <!-- *ngIf="patientCreatedBy == user._id || !patientCreatedBy" -->
                  <div *ngIf="isSubDivisionPatient">
                    <button class="btn mr-3" (click)="clearForm()">
                      Clear
                    </button>
                    <button class="btn" type="submit" (click)="onSubmit()">
                      Get Quote
                    </button>
                  </div>

                  <!-- [disabled]="!patientRegistrationForm.valid" [ngClass]="{'btnDisabled':!patientRegistrationForm.valid}" -->
                </div>
                <hr
                  style="background-color: black"
                  *ngIf="transactions.length > 0"
                />
                <div *ngIf="transactions.length > 0" class="row">
                  <!-- <div class="col-md-6">
                    <input type="search" placeholder="Search By Name" class="select_vaccine">
                    <table style="height: 100px;" class="table table-bordered m-0 text-center  mt-3">
                      <thead>
                        <tr>
                          <th>S.No</th>
                          <th>Test/Profile</th>
                          <th>Reporting Date</th>
                          <th>Amount</th>
                          <th>Discount</th>
                          <th>Action</th>
                        </tr>
                      </thead>
                      <tbody>

                        <tr *ngFor="
                        let item of patientdetailsdata?.tests
                          | patientPreviousTests;let i=index
                      ">
                          <td>{{i+1}}</td>
                          <td>{{ item?.test?.testMaster?.name }}</td>
                          <td>{{item?.sampleDate}}</td>
                          <td>{{item?.test?.price | number : '1.2-2'}}</td>
                          <td></td>
                          <td>
                            <mat-icon class="delete_icon_color">delete</mat-icon>
                          </td>

                        </tr>

                      </tbody>
                    </table>
                  </div> -->
                  <div class="col-md-12">
                    <h2 style="font-weight: bold">Billing</h2>
                    <!-- <input type="search" placeholder="Search By Name" class="select_vaccine"> -->
                    <table
                      style="height: 100px"
                      class="table table-bordered m-0 text-center mt-3"
                    >
                      <thead>
                        <tr>
                          <th>Select</th>
                          <th>S.No</th>
                          <th>Invoice ID</th>
                          <th>Invoice Date</th>
                          <th>Bill Amount</th>
                          <th>Other Charges</th>
                          <th>Total Amount</th>
                          <th>Paid Amount</th>
                          <th>Due Amount</th>
                          <th>Transactions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr *ngFor="let item of transactions; let i = index">
                          <td>
                            <span *ngIf="item.dueAmount == 0">Paid</span>
                            <mat-radio-button
                              *ngIf="item.dueAmount > 0"
                              (change)="selectedInvoice(item)"
                              class="example-radio-button"
                              name="payment"
                            >
                            </mat-radio-button>
                          </td>
                          <td>{{ i + 1 }}</td>
                          <td>{{ item?.invoiceId }}</td>
                          <td>{{ item?.invoiceDate }}</td>
                          <td>
                            {{
                              item?.billAmount ||
                                item?.totalAmount - (item?.otherCharges || 0)
                                | currency: "INR"
                            }}
                          </td>
                          <td>
                            {{ item?.otherCharges || 0 | currency: "INR" }}
                          </td>
                          <td>{{ item?.totalAmount | currency: "INR" }}</td>
                          <td>
                            {{
                              item?.totalAmount - item?.dueAmount
                                | currency: "INR"
                            }}
                          </td>
                          <td>{{ item.dueAmount | currency: "INR" }}</td>
                          <td>
                            <i
                              class="fa fa-eye"
                              *ngIf="item && item.transactions.length > 0"
                              (click)="
                                openTransactionLog(
                                  transationLogModal,
                                  item.transactions
                                )
                              "
                            ></i>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                  <div
                    class="col-md-12"
                    *ngIf="patientpaymentObj && patientpaymentObj.totalAmount"
                  >
                    <div class="card" style="margin-top: 20px">
                      <div class="row">
                        <div class="col-md-12">
                          <mat-radio-group
                            aria-label="Select an option"
                            class="example-radio-group"
                            [(ngModel)]="selectedPayment"
                            [ngModelOptions]="{ standalone: true }"
                          >
                            <mat-radio-button
                              class="example-radio-button"
                              [value]="item"
                              *ngFor="let item of paymentTypes"
                              (change)="paymentChange($event)"
                              >{{ item }}
                            </mat-radio-button>
                            <mat-radio-button
                              class="example-radio-button"
                              (click)="openInvoiceModel(sendPaymentLink)"
                            >
                              Payment Link</mat-radio-button
                            >
                          </mat-radio-group>
                        </div>
                      </div>
                      <!-- <div class="col-md-6 mt-3"> -->
                      <!-- <div class="row"> -->
                      <!-- <div *ngIf="selectedPayment == 'Cash'">
                            <table>
                              <tr>
                                <td> <label for="amount">Amount:</label>
                                </td>
                                <td><input name="amount" id="amount" type="number" /></td>
                              </tr>
                            </table>
                           </div> -->
                      <!-- <div class="row"> -->
                      <div *ngIf="selectedPayment == 'Card'">
                        <table>
                          <tr>
                            <td><label for="Card No">Card No:</label></td>
                            <td>
                              <input
                                name="Card No"
                                id="Card No"
                                type="number"
                              />
                            </td>
                          </tr>
                          <br />
                          <tr>
                            <td><label for="Bank Name">BankName:</label></td>
                            <td class="ml-2">
                              <input
                                name="Bank Name"
                                id="Bank Name"
                                type="text"
                              />
                            </td>
                          </tr>
                        </table>
                      </div>
                      <div *ngIf="selectedPayment == 'UPI'">
                        <table>
                          <tr>
                            <td><label for="UPI"> UPI:</label></td>
                            <td><input name="UPI" id="UPI" type="text" /></td>
                          </tr>
                        </table>
                      </div>
                      <div
                        class="ml-2 mb-2"
                        *ngIf="selectedPayment == 'Cheque'"
                      >
                        <table>
                          <tr>
                            <td><label for="Cheque no">Cheq No:</label></td>
                            <td>
                              <input
                                name="Cheque no"
                                id="Cheque no"
                                type="number"
                                [(ngModel)]="
                                  patientpaymentObj.paymentInfo.chequeNo
                                "
                                [ngModelOptions]="{ standalone: true }"
                              />
                            </td>
                          </tr>
                          <tr>
                            <td>
                              <label for="Cheque date">Cheq Date:</label>
                            </td>
                            <td>
                              <input
                                name="Cheque date"
                                id="Cheque date"
                                type="text"
                                [(ngModel)]="
                                  patientpaymentObj.paymentInfo.chequeDate
                                "
                                [ngModelOptions]="{ standalone: true }"
                              />
                            </td>
                          </tr>
                        </table>
                      </div>
                      <!-- </div> -->
                    </div>

                    <div class="row mt-4">
                      <div class="col md-12">
                        <table>
                          <tr>
                            <td>
                              <label for="Bill Amount">Bill Amount:</label>
                            </td>
                            <td>
                              <input
                                class="input"
                                name="Bill Amount"
                                id="Bill Amount"
                                type="number"
                                [(ngModel)]="patientpaymentObj.billAmount"
                                [ngModelOptions]="{ standalone: true }"
                                disabled
                              />
                            </td>
                            <td><label for="Discount">Discount:</label></td>
                            <td>
                              <input
                                style="width: 40px"
                                placeholder="%"
                                name="Discount"
                                id="Discount"
                                type="text"
                                (input)="discount('percentage')"
                                [(ngModel)]="
                                  patientpaymentObj.discountPercentage
                                "
                                [ngModelOptions]="{ standalone: true }"
                                (keypress)="keyPressNumbersWithDecimal($event)"
                              />&nbsp;
                              <input
                                style="width: 70px"
                                name="Discount"
                                placeholder="Amount"
                                id="Discount"
                                type="number"
                                (input)="discount('amount')"
                                [(ngModel)]="patientpaymentObj.discountAmount"
                                [ngModelOptions]="{ standalone: true }"
                                (keypress)="keyPressNumbersWithDecimal($event)"
                              />
                            </td>
                          </tr>
                          <tr>
                            <td>
                              <label for="Other Charges">Other Charges:</label>
                            </td>
                            <td>
                              <input
                                class="input"
                                name="Other Charges"
                                id="Other Charges"
                                type="number"
                                (input)="otherChanges($event)"
                                [(ngModel)]="patientpaymentObj.otherCharges"
                                [ngModelOptions]="{ standalone: true }"
                                (keypress)="keyPressNumbersWithDecimal($event)"
                              />
                            </td>
                            <td>
                              <label
                                for="Total Amount"
                                style="font-weight: bolder"
                                >Total Amount:
                              </label>
                            </td>
                            <td>
                              <input
                                style="outline: solid 1px; font-weight: bolder"
                                class="input"
                                name="Total Amount"
                                id="Total Amount"
                                type="number"
                                [(ngModel)]="patientpaymentObj.totalAmount"
                                [ngModelOptions]="{ standalone: true }"
                                disabled
                              />
                            </td>
                          </tr>
                          <tr>
                            <td>
                              <label for="Paid Amount">Paid Amount:</label>
                            </td>
                            <td>
                              <input
                                class="input"
                                name="Paid Amount"
                                type="number"
                                [(ngModel)]="patientpaymentObj.paidAmount"
                                disabled
                                [ngModelOptions]="{ standalone: true }"
                                (keypress)="keyPressNumbersWithDecimal($event)"
                              />
                            </td>
                            <td>
                              <label for="Balance TO Be Paid"
                                >Balance To Be Paid:
                              </label>
                            </td>
                            <td>
                              <input
                                class="input"
                                name="Balance TO Be Paid"
                                id="Balance TO Be Paid"
                                type="number"
                                [(ngModel)]="
                                  patientpaymentObj.totalAmount -
                                  patientpaymentObj.paidAmount -
                                  patientpaymentObj.orderAmount
                                "
                                [ngModelOptions]="{ standalone: true }"
                                disabled
                              />
                            </td>
                            <td>
                              <label for="paying_now"
                                >Paying Now (Amount) :
                              </label>
                            </td>
                            <td>
                              <input
                                class="input"
                                name="Paid Amount"
                                id="paying_now"
                                type="number"
                                (input)="balancePaid()"
                                [(ngModel)]="patientpaymentObj.orderAmount"
                                [ngModelOptions]="{ standalone: true }"
                                (keypress)="keyPressNumbersWithDecimal($event)"
                              />
                            </td>
                          </tr>
                        </table>
                      </div>
                      <div class="col-md-12 mt-2">
                        <table>
                          <tr>
                            <td><label for="Remarks">Comments: </label></td>
                            <td>
                              <textarea
                                name="Remarks"
                                style="margin-left: 21px"
                                [(ngModel)]="patientpaymentObj.comments"
                                [ngModelOptions]="{ standalone: true }"
                              ></textarea>
                            </td>
                          </tr>
                        </table>
                      </div>
                    </div>

                    <br />
                    <button
                      type="submit"
                      style="margin-left: 920px"
                      class="btn btn-primary"
                      (click)="clearBilling()"
                    >
                      Clear
                    </button>
                    <button
                      type="submit"
                      style="float: right"
                      class="btn btn-primary"
                      (click)="addBillingData()"
                    >
                      Save
                    </button>
                    <br />
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- <div class="card p-3 my-3" *ngIf="isSubDivisionPatient">
            <div class="progress-bar-icons">
              <ul>
                <li [ngClass]="{ active: patientaccshow === 'patient' }">
                  <span>Patient</span>
                  <p class="active"></p>
                </li>
                <li [ngClass]="{ active: testaccshow === 'test' }">
                  <span>Tests</span>
                  <p class="active"></p>
                </li>
                <li
                  [ngClass]="{ active: vaccineaccshow === 'vaccine' }"
                  *ngIf="patientdetailsdata?.isVaccineREG == true"
                >
                  <span>Vaccine</span>
                  <p class="active"></p>
                </li>
                <li [ngClass]="{ active: pastaccshow === 'past' }">
                  <span>Past Medic History</span>
                  <p class="active"></p>
                </li>
                <li [ngClass]="{ active: familyaccshow === 'family' }">
                  <span>Family History</span>
                  <p class="active"></p>
                </li>
                <li [ngClass]="{ active: doctorReviewshow === 'doctorReview' }">
                  <span>Doctor Review</span>
                  <p class="active"></p>
                </li>
                <li
                  [ngClass]="{ active: questionnaireshow === 'questionnaireView' }"
                  *ngIf="showQuestionnaireView"
                >
                  <span>Questionnaire</span>
                  <p class="active"></p>
                </li>
              </ul>
            </div>
          </div> -->
          <!-- <div class="card mt-3 bg-light">
            <div class="card-body"> -->
          <!-- <div class="" *ngIf="isSubDivisionPatient">
                <mat-accordion class="example-headers-align mt-2" multi>
                  <mat-expansion-panel>
                    <mat-expansion-panel-header (click)="accordian('patient')">
                      <mat-panel-title> Patient </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="table-responsive details" formGroupName="details">
                      <table class="table table-bordered">
                        <thead>
                          <tr>
                            <th>Height(cms)</th>
                            <th>Weight(Kgs)</th>
                            <th>BMi</th>
                            <th>Blood Presure</th>
                            <th>Acuity Of Vision</th>
                            <th>Blood Group</th>
                            <th>Temperature (°F)</th>
                            <th>Comment</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>
                              <input type="text" class="form-control" formControlName="height" placeholder="Value" />
                            </td>
                            <td>
                              <input type="text" class="form-control" formControlName="weight" placeholder="Value" />
                            </td>
                            <td>
                              <input type="text" class="form-control" formControlName="BMI" placeholder="Value" />
                            </td>
                            <td>
                              <input type="text" class="form-control" formControlName="BP" placeholder="Value" />
                            </td>
                            <td>
                              <input type="text" class="form-control" formControlName="acuityOfVision"
                                placeholder="Value" />
                            </td>
                            <td>
                              <input type="text" class="form-control" formControlName="bloodGroup" placeholder="Value" />
                            </td>
                            <td>
                              <input type="text" class="form-control" formControlName="temperature" placeholder="Value" />
                            </td>
                            <td>
                              <input type="text" class="form-control" formControlName="comment" placeholder="Value" />
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <h3 *ngIf="patientdetailsdata?.details?.length > 0">
                      Patient General Test details
                    </h3>
                    <div class="table-responsive example-container mat-elevation-z8"
                      *ngIf="patientdetailsdata?.details?.length > 0">
                      <table class="table">
                        <thead>
                          <th>Date</th>
                          <th>Height(cms)</th>
                          <th>Weight(Kgs)</th>
                          <th>BMi</th>
                          <th>Blood Presure</th>
                          <th>Acuity Of Vision</th>
                          <th>Blood Group</th>
                          <th>Temperature(°F)</th>
                          <th>comment</th>
                        </thead>
                        <tbody>
                          <tr class="previousData" *ngFor="let item of patientdetailsdata?.details">
                            <td>{{ item.createdAt | date: "dd-MM-yyyy HH:mm" }}</td>
                            <td>{{ item.height }}</td>
                            <td>{{ item.weight }}</td>
                            <td>{{ item.BMI }}</td>
                            <td>{{ item.BP }}</td>
                            <td>{{ item.acuityOfVision }}</td>
                            <td>{{ item.bloodGroup }}</td>
                            <td>{{ item.temperature }}</td>
                            <td>{{ item.comment }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
              </div> -->

          <!-- <div class="mt-3">
                <mat-accordion class="example-headers-align mt-2" multi>
                  <mat-expansion-panel >
                    <mat-expansion-panel-header  (click)="accordian('test')">
                      <mat-panel-title> Test </mat-panel-title>
                    </mat-expansion-panel-header>
    
                                     </mat-expansion-panel>
                </mat-accordion>
              </div> -->
          <!-- <div class="mt-3" *ngIf="patientdetailsdata?.isVaccineREG == true">
                <mat-accordion class="example-headers-align mt-2" multi>
                  <mat-expansion-panel>
                    <mat-expansion-panel-header (click)="accordian('vaccine')">
                      <mat-panel-title> Vaccine </mat-panel-title>
                    </mat-expansion-panel-header>
    
                    <div>
                      <form [formGroup]="vaccineForm">
                        <div class="table-responsive">
                          <table class="table table-bordered">
                            <thead>
                              <tr class="text-center">
                                <th class="date-heading-table">Date</th>
    
                                <th class="">Vaccine Name</th>
                                <th class="">Dose</th>
                                <th class="">Status</th>
                                <th>Vaccine Quantity</th>
                                <th class="">Technician</th>
    
                                <th>Action</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr class="text-center">
                                <td>
                                  <div class="form-group mb-0">
                                    <input type="date" class="mb-0" formControlName="vaccinatedDate"
                                      class="select_vaccine-date" [ngClass]="{
                                        'is-invalid':
                                          submitted && l.vaccinatedDate.errors
                                      }" required />
                                    <div *ngIf="submitted && l.vaccinatedDate.errors" class="invalid-feedback">
                                      <div *ngIf="l.vaccinatedDate.errors.required">
                                        Date is required
                                      </div>
                                    </div>
                                  </div>
                                </td>
    
                                <td>
                                  <select class="select_vaccine" formControlName="vaccineName">
                                    <option hidden value="" disabled selected>
                                      Select Vaccine
                                    </option>
                                    <option value="covishield">Covishield</option>
                                    <option value="covaxin">Covaxin</option>
                                  </select>
                                </td>
                                <td>
                                  <input type="text" placeholder="" formControlName="vaccinationDose" readonly
                                    class="vaccine_dose" />
                                </td>
                                <td>
                                  <input type="text" placeholder="" formControlName="vaccinationStatus" readonly
                                    class="vaccine_status" />
                                </td>
    
                                <td>
                                  <input type="text" placeholder="" formControlName="noOfPersons" readonly
                                    class="vaccine_dose" />
                                </td>
    
                                <td>
                                  <div class="form-group mb-0">
                                    <select class="" formControlName="technician_id" class="select_vaccine" [ngClass]="{
                                        'is-invalid':
                                          submitted && l.technician_id.errors
                                      }" required>
                                      <option value="" disabled selected>
                                        Select Technician
                                      </option>
                                      <option *ngFor="let item of technicianListData " value="{{ item?._id }}">
                                        {{ item.name }}
                                      </option>
                                    </select>
                                    <div *ngIf="submitted && l.technician_id.errors" class="invalid-feedback">
                                      <div *ngIf="l.technician_id.errors.required">
                                        Technician is required
                                      </div>
                                    </div>
                                  </div>
                                </td>
    
                                <td>
                                  <button class="button-select" (click)="openVaccine()">
                                    Assign
                                  </button>
                                </td> -->

          <!-- <td>
                                                                <button class="button-select"
                                                                    (click)="openVaccine()">{{vaccineForm.value?.technician_id
                                                                    ?
                                                                    "Modify" : "Assign" }}</button>
                                                            </td> -->
          <!-- </tr>
                            </tbody>
                          </table>
                        </div>
                      </form>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
              </div>
    
              <div class="mt-3" *ngIf="isSubDivisionPatient">
                <mat-accordion class="example-headers-align mt-2" multi>
                  <mat-expansion-panel>
                    <mat-expansion-panel-header (click)="accordian('past')">
                      <mat-panel-title> Past Medic History </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="addRow text-right">
                      <button (click)="addmedicalHistoryItem()">Add row</button> -->
          <!-- <mat-icon (click)="addmedicalHistoryItem()">add</mat-icon> -->
          <!-- </div>
                    <div class="table-responsive">
                      <table class="table table-bordered">
                        <thead>
                          <tr>
                            <th>Medicine Name</th>
                            <th>Frequency</th>
                            <th>Number of Days</th>
                            <th>Comment</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr formArrayName="medicalHistory" *ngFor="
                              let item of patientRegistrationForm.get(
                                'medicalHistory'
                              )['controls'];
                              let i = index
                            ">
                            <td [formGroupName]="i">
                              <input type="text" class="form-control" formControlName="medicine" />
                            </td>
                            <td [formGroupName]="i">
                              <input type="number" class="form-control" formControlName="frequency" />
                            </td>
                            <td [formGroupName]="i">
                              <input type="number" class="form-control" formControlName="noOfDays" />
                            </td>
                            <td [formGroupName]="i">
                              <input type="text" class="form-control" formControlName="comment" />
                            </td>
                            <td [formGroupName]="i">
                              <mat-icon class="delete_icon_color" (click)="removePatientmedicalHistory(i)">delete</mat-icon>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div> -->
          <!-- <div formArrayName="medicalHistory"
                                        *ngFor="let item of patientRegistrationForm.get('medicalHistory')['controls'];  let i = index;">
                                        <div [formGroupName]="i">
                                            <div class="row">
                                                <div class="col-lg-3">
                                                    <div class="form-group">
                                                        <label>Medicine Name</label>
                                                        <input type="text" class="form-control" formControlName="medicine">
                                                    </div>
                                                </div>
                                                <div class="col-lg-3">
                                                    <div class="form-group">
                                                        <label>frequency</label>
                                                        <input type="text" class="form-control" formControlName="frequency">
                                                    </div>
                                                </div>
                                                <div class="col-lg-2">
                                                    <div class="form-group">
                                                        <label for="">number of days</label>
                                                        <input type="text" class="form-control" formControlName="noOfDays">
                                                    </div>
                                                </div>
                                                <div class="col-lg-3">
                                                    <div class="form-group">
                                                        <label>Comment</label>
                                                        <textarea type="text" class="form-control"
                                                            formControlName="comment"></textarea>
    
                                                    </div>
                                                </div>
                                                <div class="col-lg-1 mt-5" *ngIf="i>0">
                                                    <div  class="text-center removeIcon">
                                                        <span (click)="removePatientmedicalHistory(i)">&times;</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div> -->
          <!-- <h3 *ngIf="patientdetailsdata?.medicalHistory?.length > 0">
                      Medical History details
                    </h3>
                    <div class="table-responsive example-container mat-elevation-z8"
                      *ngIf="patientdetailsdata?.medicalHistory?.length > 0">
                      <table class="table">
                        <thead>
                          <th>Date</th>
                          <th>Medicine</th>
                          <th>Frequency</th>
                          <th>noOfDays</th>
                          <th>comment</th>
                        </thead>
                        <tbody>
                          <tr *ngFor="let item of patientdetailsdata?.medicalHistory">
                            <td>{{ item.createdAt | date: "dd-MM-yyyy HH:mm" }}</td>
                            <td>{{ item.medicine }}</td>
                            <td>{{ item.frequency }}</td>
                            <td>{{ item.noOfDays }}</td>
                            <td>{{ item.comment }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
              </div>
              <div class="mt-3" *ngIf="isSubDivisionPatient">
                <mat-accordion class="example-headers-align mt-2" multi>
                  <mat-expansion-panel>
                    <mat-expansion-panel-header (click)="accordian('family')">
                      <mat-panel-title> Family History </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="addRow text-right">
                      <button (click)="addfamilyHistoryItem()">Add row</button> -->
          <!-- <mat-icon (click)="addmedicalHistoryItem()">add</mat-icon> -->
          <!-- </div>
                    <div class="table-responsive">
                      <table class="table table-bordered">
                        <thead>
                          <tr>
                            <th>Disease</th>
                            <th>Relation With Patient</th>
                            <th>From Years</th>
                            <th>Comment</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr formArrayName="familyHistory" *ngFor="
                              let item of patientRegistrationForm.get(
                                'familyHistory'
                              )['controls'];
                              let i = index
                            ">
                            <td [formGroupName]="i">
                              <input type="text" class="form-control" formControlName="decease" />
                            </td>
                            <td [formGroupName]="i">
                              <input type="text" class="form-control" formControlName="relation" />
                            </td>
                            <td [formGroupName]="i">
                              <input type="number" class="form-control" formControlName="fromYears" />
                            </td>
                            <td [formGroupName]="i">
                              <input type="text" class="form-control" formControlName="comment" />
                            </td>
                            <td [formGroupName]="i">
                              <mat-icon class="delete_icon_color" (click)="removePatientfamilyHistory(i)">delete</mat-icon>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div> -->
          <!-- <div class="addRow text-right">
                                        <mat-icon (click)="addfamilyHistoryItem()">add</mat-icon>
                                    </div>
                                    <div formArrayName="familyHistory"
                                        *ngFor="let item of patientRegistrationForm.get('familyHistory')['controls'];  let i = index;">
                                        <div [formGroupName]="i">
                                            <div class="row">
                                                <div class="col-lg-3">
                                                    <div class="form-group">
                                                        <label>Decease</label>
                                                        <input type="text" class="form-control" formControlName="decease">
                                                    </div>
                                                </div>
                                                <div class="col-lg-3">
                                                    <div class="form-group">
                                                        <label>Relation With Patient</label>
                                                        <input type="text" class="form-control" formControlName="relation">
                                                    </div>
                                                </div>
                                                <div class="col-lg-2">
                                                    <div class="form-group">
                                                        <label for="">From Years</label>
                                                        <input type="text" class="form-control" formControlName="fromYears">
                                                    </div>
                                                </div>
                                                <div class="col-lg-3">
                                                    <div class="form-group">
                                                        <label>Comment</label>
                                                        <textarea type="text" class="form-control"
                                                            formControlName="comment"></textarea>
                                                    </div>
                                                </div>
                                                <div class="col-lg-1 mt-5" *ngIf="i>0">
                                                    <div  class="text-center removeIcon">
                                                        <span (click)="removePatientfamilyHistory(i)">&times;</span>
                                                    </div>
                                                </div>
    
                                            </div>
                                        </div>
                                    </div> -->
          <!-- <h3 *ngIf="patientdetailsdata?.familyHistory?.length > 0">
                      Family History details
                    </h3>
                    <div class="table-responsive example-container mat-elevation-z8"
                      *ngIf="patientdetailsdata?.familyHistory?.length > 0">
                      <table class="table">
                        <thead>
                          <th>Date</th>
                          <th>Disease</th>
                          <th>Relation</th>
                          <th>FromYears</th>
                          <th>comment</th>
                        </thead>
                        <tbody>
                          <tr *ngFor="let item of patientdetailsdata?.familyHistory">
                            <td>{{ item.createdAt | date: "dd-MM-yyyy HH:mm" }}</td>
                            <td>{{ item.decease }}</td>
                            <td>{{ item.relation }}</td>
                            <td>{{ item.fromYears }}</td>
                            <td>{{ item.comment }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
              </div>
              <div class="mt-3" *ngIf="isSubDivisionPatient">
                <mat-accordion class="example-headers-align mt-2" multi>
                  <mat-expansion-panel>
                    <mat-expansion-panel-header (click)="accordian('doctorReview')">
                      <mat-panel-title> Doctor Review </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="addRow text-right">
                      <button (click)="addDoctorReviewItem()">Add row</button> -->
          <!-- <mat-icon (click)="addmedicalHistoryItem()">add</mat-icon> -->
          <!-- </div>
                    <div class="table-responsive">
                      <table class="table table-bordered">
                        <thead>
                          <tr>
                            <th>Review</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr formArrayName="doctorReview" *ngFor="
                              let item of patientRegistrationForm.get(
                                'doctorReview'
                              )['controls'];
                              let i = index
                            ">
                            <td [formGroupName]="i">
                              <textarea type="text" class="form-control" formControlName="review"
                                placeholder="Review"></textarea>
                            </td>
                            <td [formGroupName]="i">
                              <mat-icon (click)="removePatientdoctorReview(i)">delete</mat-icon>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div> -->
          <!-- <div class="addRow text-right">
                                        <mat-icon (click)="addDoctorReviewItem()">add</mat-icon>
                                    </div>
                                    <div formArrayName="doctorReview"
                                        *ngFor="let item of patientRegistrationForm.get('doctorReview')['controls'];  let i = index;">
                                        <div [formGroupName]="i">
                                            <div class="row">
                                                <div class="col-lg-11">
                                                    <div class="form-group">
                                                        <label>Review</label>
                                                        <textarea type="text" class="form-control" formControlName="review"
                                                            placeholder="Review"></textarea>
                                                    </div>
                                                    
                                                </div>
                                                <div class="col-lg-1 mt-5" *ngIf="i>0">
                                                    <div  class="text-center removeIcon">
                                                        <span (click)="removePatientdoctorReview(i)">&times;</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div> -->
          <!-- <h3 *ngIf="patientdetailsdata?.doctorReviews?.length > 0">
                      Previous Reviews
                    </h3>
                    <div class="table-responsive example-container mat-elevation-z8"
                      *ngIf="patientdetailsdata?.doctorReviews?.length > 0">
                      <table class="table">
                        <thead>
                          <th>Date</th>
                          <th>Review</th>
                        </thead>
                        <tbody>
                          <tr *ngFor="let item of patientdetailsdata?.doctorReviews">
                            <td>{{ item.createdAt | date: "dd-MM-yyyy HH:mm" }}</td>
                            <td>{{ item.review }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
              </div>
              <div class="mt-3" *ngIf="showQuestionnaireView && isSubDivisionPatient">
                <mat-accordion class="example-headers-align mt-2" multi>
                  <mat-expansion-panel>
                    <mat-expansion-panel-header (click)="accordian('questionnaireView')">
                      <mat-panel-title> Questionnaire Review </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="card bg-light">
                      <div class="card-body">
                        <mat-card class="mt-3 questionnaire">
                          <h4>Questionnaire</h4>
                          <table class="table table-bordered m-0 text-center">
                            <tr>
                              <th class="sno">S.No</th>
                              <th class="question">Question</th>
                              <th class="answer">Answer</th>
                              <th>Code</th>
                            </tr>
                          </table>
                          <div *ngFor="let grp of questionForm.controls">
                            <form [formGroup]="grp" class="questForm">
                              <table class="table table-bordered m-0 text-center">
                                <td class="sec">{{ grp.value.name }}</td>
                              </table> -->
          <!-- <label > </label> -->
          <!-- <div formArrayName="questions" *ngFor="
                                  let item of grp?.get('questions')['controls'];
                                  let i = index
                                ">
                                <table [formGroup]="item" class="table table-bordered m-0">
                                  <tr>
                                    <td class="sno">{{ i + 1 }}</td>
                                    <td class="question">
                                      {{ item?.value?.question }}
                                    </td>
                                    <td class="answer">
                                      <div *ngIf="item.value.type == 'options'">
                                        <mat-radio-group aria-label="Select an option" class="checkbox"
                                          formControlName="answer">
                                          <mat-radio-button [disabled]="true" class="col-lg-12 optionText" *ngFor="
                                              let answers of item.value
                                                ?.possibleAnswers
                                            " [value]="answers">{{ answers }}
                                          </mat-radio-button> -->
          <!-- <mat-radio-button value="no">No</mat-radio-button> -->
          <!-- </mat-radio-group>
                                      </div>
                                      <div *ngIf="item.value.type == 'checkbox'"> -->
          <!-- <label formArrayName="answer" *ngFor="let order of item.get('answer')['controls']; let i = index">
                                                                            <input type="checkbox" [formControlName]="i">
                                                                            {{item.value.possibleAnswers[i]}}
                                                                          </label> -->
          <!-- <section class="example-section checkbox" formArrayName="answer" *ngFor="
                                            let order of item.get('answer')[
                                              'controls'
                                            ];
                                            let i = index
                                          ">
                                          <mat-checkbox class="example-margin" [disabled]="true" [formControlName]="i"
                                            class="col-lg-12 optionText" [value]="item.value.possibleAnswers[i]">
                                            {{ item.value.possibleAnswers[i] }}
                                          </mat-checkbox>
                                        </section>
                                      </div>
                                      <div class="input-with-measure" *ngIf="
                                          item.value.type == 'input' ||
                                          item.value.type == 'paragraph' ||
                                          item.value.type == 'textArea' ||
                                          item.value.type == 'numeric'
                                        ">
                                        <input class="form-control" formControlName="answer" readonly /><span>{{
                                          item.value.units }}</span>
                                      </div>
                                      <div *ngIf="item.value.type == 'date'">
                                        <input class="form-control" type="date" formControlName="answer" readonly />
                                      </div>
                                      <div *ngIf="item.value.type == 'radio'">
                                        <mat-radio-group aria-label="Select an option" formControlName="answer">
                                          <mat-radio-button value="yes" [disabled]="true">Yes
                                          </mat-radio-button>
                                          <mat-radio-button value="no" [disabled]="true">No
                                          </mat-radio-button>
                                        </mat-radio-group>
                                      </div>
                                    </td>
                                    <td>{{ item.value.code }}</td>
                                  </tr>
    
                                  <tr formArrayName="subquestions" *ngFor="
                                      let sub of item.get('subquestions')[
                                        'controls'
                                      ];
                                      let j = index
                                    "> -->
          <!-- < > -->
          <!-- <td [formGroupName]="j" class="sno">
                                      {{ i + 1 }}.{{ j + 1 }}
                                    </td>
                                    <td [formGroupName]="j" class="question">
                                      {{ sub.value.question }}
                                    </td>
                                    <td [formGroupName]="j" class="answer">
                                      <div *ngIf="sub.value.type == 'options'">
                                        <mat-radio-group aria-label="Select an option" class="checkbox"
                                          formControlName="answer">
                                          <mat-radio-button [disabled]="true" class="col-lg-12 optionText" *ngFor="
                                              let answers of sub.value
                                                ?.possibleAnswers
                                            " [value]="answers">{{ answers }}
                                          </mat-radio-button> -->
          <!-- <mat-radio-button value="no">No</mat-radio-button> -->
          <!-- </mat-radio-group>
                                      </div>
                                      <div *ngIf="sub.value.type == 'checkbox'"> -->
          <!-- <label formArrayName="answer" *ngFor="let order of item.get('answer')['controls']; let i = index">
                                                                                   <input type="checkbox" [formControlName]="i">
                                                                                   {{item.value.possibleAnswers[i]}}
                                                                                 </label> -->
          <!-- <section class="example-section checkbox" formArrayName="answer" *ngFor="
                                            let order of sub.get('answer')[
                                              'controls'
                                            ];
                                            let i = index
                                          ">
                                          <mat-checkbox class="example-margin" [disabled]="true" [formControlName]="i"
                                            class="col-lg-12 optionText" [value]="sub.value.possibleAnswers[i]">
                                            {{ sub.value.possibleAnswers[i] }}
                                          </mat-checkbox>
                                        </section>
                                      </div>
                                      <div *ngIf="
                                          sub.value.type == 'input' ||
                                          sub.value.type == 'paragraph' ||
                                          sub.value.type == 'textArea' ||
                                          sub.value.type == 'numeric'
                                        ">
                                        <input class="form-control" formControlName="answer" readonly />{{ sub.value?.units
                                        }}
                                      </div>
                                      <div *ngIf="sub.value.type == 'date'">
                                        <input class="form-control" type="date" formControlName="answer" readonly />
                                      </div>
                                      <div *ngIf="sub.value.type == 'radio'">
                                        <mat-radio-group aria-label="Select an option" formControlName="answer">
                                          <mat-radio-button value="yes" [disabled]="true">Yes
                                          </mat-radio-button>
                                          <mat-radio-button value="no" [disabled]="true">No
                                          </mat-radio-button>
                                        </mat-radio-group>
                                      </div>
                                    </td>
                                    <td [formGroupName]="j">
                                      {{ sub.value.code }}
                                    </td>
                                  </tr>
                                </table>
                              </div>
                            </form>
                          </div>
                        </mat-card>
                      </div>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
              </div>
              <div class=" mt-3">
                <mat-accordion class="example-headers-align mt-2" multi>
                  <mat-expansion-panel>
                    <mat-expansion-panel-header (click)="accordian('billing')">
                      <mat-panel-title> Billing </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="row"> -->
          <!-- <div class="col-md-6">
                        <input type="search" placeholder="Search By Name" class="select_vaccine">
                        <table style="height: 100px;" class="table table-bordered m-0 text-center  mt-3">
                          <thead>
                            <tr>
                              <th>S.No</th>
                              <th>Test/Profile</th>
                              <th>Reporting Date</th>
                              <th>Amount</th>
                              <th>Discount</th>
                              <th>Action</th>
                            </tr>
                          </thead>
                          <tbody>
    
                            <tr *ngFor="
                            let item of patientdetailsdata?.tests
                              | patientPreviousTests;let i=index
                          ">
                              <td>{{i+1}}</td>
                              <td>{{ item?.test?.testMaster?.name }}</td>
                              <td>{{item?.sampleDate}}</td>
                              <td>{{item?.test?.price | number : '1.2-2'}}</td>
                              <td></td>
                              <td>
                                <mat-icon class="delete_icon_color">delete</mat-icon>
                              </td>
    
                            </tr>
    
                          </tbody>
                        </table>
                      </div> -->
          <!-- <div class="col-md-12"> -->
          <!-- <input type="search" placeholder="Search By Name" class="select_vaccine"> -->
          <!-- <table style="height: 100px;" class="table table-bordered m-0 text-center  mt-3">
                          <thead>
                            <tr>
                              <th>Select</th>
                              <th>S.No</th>
                              <th>Invoice ID</th>
                              <th>Invoice Date</th>
                              <th>Bill Amount</th>
                              <th>Other Charges</th>
                              <th>Total Amount</th>
                              <th>Paid Amount</th>
                              <th>Due Amount</th>
                              <th>Transactions</th>
                            </tr>
                          </thead>
                          <tbody>
    
                            <tr *ngFor="
                            let item of transactions;let i=index
                          ">
                              <td>
                                <span *ngIf="item.dueAmount == 0">Paid</span>
                                <mat-radio-button *ngIf="item.dueAmount > 0" (change)="selectedInvoice(item)"
                                  class="example-radio-button" name="payment">
                                </mat-radio-button>
                              </td>
                              <td>{{i+1}}</td>
                              <td>{{ item?.invoiceId }}</td>
                              <td>{{item?.invoiceDate }}</td>
                              <td>{{item?.billAmount || item?.totalAmount - (item?.otherCharges || 0) | currency : 'INR'}}
                              </td>
                              <td>{{item?.otherCharges || 0 | currency : 'INR'}}</td>
                              <td>{{item?.totalAmount | currency : 'INR'}}</td>
                              <td>{{item?.totalAmount - item?.dueAmount | currency : 'INR'}}</td>
                              <td>{{item.dueAmount | currency : 'INR'}}</td>
                              <td> <i class="fa fa-eye" *ngIf="item && item.transactions.length > 0"
                                  (click)="openTransactionLog(transationLogModal,item.transactions)"></i> </td>
    
                            </tr>
    
                          </tbody>
                        </table>
                      </div>
                      <div class="col-md-12" *ngIf="patientpaymentObj && patientpaymentObj.totalAmount">
                        <div class="card" style="margin-top: 20px;">
                          <div class="row">
                            <div class="col-md-12">
                              <mat-radio-group aria-label="Select an option" class="example-radio-group"
                                [(ngModel)]="selectedPayment" [ngModelOptions]="{standalone: true}">
                                <mat-radio-button class="example-radio-button" [value]="item"
                                  *ngFor="let  item of paymentTypes" (change)="paymentChange($event)">{{item}}
                                </mat-radio-button>
                                <mat-radio-button class="example-radio-button" (click)="openInvoiceModel(sendPaymentLink)">
                                  Payment Link</mat-radio-button>
                              </mat-radio-group>
                            </div>
                          </div> -->
          <!-- <div class="col-md-6 mt-3"> -->
          <!-- <div class="row"> -->
          <!-- <div *ngIf="selectedPayment == 'Cash'">
                                <table>
                                  <tr>
                                    <td> <label for="amount">Amount:</label>
                                    </td>
                                    <td><input name="amount" id="amount" type="number" /></td>
                                  </tr>
                                </table>
                               </div> -->
          <!-- <div class="row"> -->
          <!-- <div *ngIf="selectedPayment == 'Card'">
                            <table>
                              <tr>
                                <td> <label for="Card No">Card No:</label>
                                </td>
                                <td><input name="Card No" id="Card No" type="number" /></td>
                              </tr>
                              <br>
                              <tr>
                                <td> <label for="Bank Name">BankName:</label>
                                </td>
                                <td class="ml-2"><input name="Bank Name" id="Bank Name" type="text" /></td>
                              </tr>
                            </table>
    
                          </div>
                          <div *ngIf="selectedPayment == 'UPI'">
                            <table>
                              <tr>
                                <td> <label for="UPI"> UPI:</label>
                                </td>
                                <td><input name="UPI" id="UPI" type="text" /></td>
                              </tr>
                            </table>
    
    
                          </div>
                          <div class="ml-2 mb-2" *ngIf="selectedPayment == 'Cheque'">
                            <table>
                              <tr>
                                <td> <label for="Cheque no">Cheq No:</label>
                                </td>
                                <td><input name="Cheque no" id="Cheque no" type="number"
                                    [(ngModel)]="patientpaymentObj.paymentInfo.chequeNo"
                                    [ngModelOptions]="{standalone: true}" /></td>
                              </tr>
                              <tr>
                                <td> <label for="Cheque date">Cheq Date:</label>
                                </td>
                                <td><input name="Cheque date" id="Cheque date" type="text"
                                    [(ngModel)]="patientpaymentObj.paymentInfo.chequeDate"
                                    [ngModelOptions]="{standalone: true}" /></td>
                              </tr>
    
                            </table>
                          </div> -->
          <!-- </div> -->
          <!-- </div>
    
                        <div class="row mt-4">
    
                          <div class="col md-12">
                            <table>
                              <tr>
                                <td> <label for="Bill Amount">Bill Amount:</label>
                                </td>
                                <td><input class="input" name="Bill Amount" id="Bill Amount" type="number"
                                    [(ngModel)]="patientpaymentObj.billAmount" [ngModelOptions]="{standalone: true}"
                                    disabled /></td>
                                <td> <label for="Discount">Discount:</label>
                                </td>
                                <td><input style="width: 40px;" placeholder="%" name="Discount" id="Discount" type="text"
                                    (input)="discount('percentage')" [(ngModel)]="patientpaymentObj.discountPercentage"
                                    [ngModelOptions]="{standalone: true}"
                                    (keypress)="keyPressNumbersWithDecimal($event)" />&nbsp;
                                  <input style="width: 70px;" name="Discount" placeholder="Amount" id="Discount"
                                    type="number" (input)="discount('amount')"
                                    [(ngModel)]="patientpaymentObj.discountAmount" [ngModelOptions]="{standalone: true}"
                                    (keypress)="keyPressNumbersWithDecimal($event)" />
                                </td>
                              </tr>
                              <tr>
    
                                <td> <label for="Other Charges">Other Charges:</label>
                                </td>
                                <td><input class="input" name="Other Charges" id="Other Charges" type="number"
                                    (input)="otherChanges($event)" [(ngModel)]="patientpaymentObj.otherCharges"
                                    [ngModelOptions]="{standalone: true}" (keypress)="keyPressNumbersWithDecimal($event)" />
                                </td>
                                <td> <label for="Total Amount" style="font-weight: bolder;">Total Amount: </label>
                                </td>
                                <td><input style="outline: solid 1px; font-weight: bolder;" class="input"
                                    name="Total Amount" id="Total Amount" type="number"
                                    [(ngModel)]="patientpaymentObj.totalAmount" [ngModelOptions]="{standalone: true}"
                                    disabled /></td>
                              </tr>
                              <tr>
                                <td> <label for="Paid Amount">Paid Amount:</label>
                                </td>
                                <td><input class="input" name="Paid Amount" type="number"
                                    [(ngModel)]="patientpaymentObj.paidAmount" disabled
                                    [ngModelOptions]="{standalone: true}" (keypress)="keyPressNumbersWithDecimal($event)" />
                                </td>
                                <td> <label for="Balance TO Be Paid">Balance To Be Paid: </label>
                                </td>
                                <td><input class="input" name="Balance TO Be Paid" id="Balance TO Be Paid" type="number"
                                    [(ngModel)]="patientpaymentObj.totalAmount - patientpaymentObj.paidAmount - patientpaymentObj.orderAmount"
                                    [ngModelOptions]="{standalone: true}" disabled /></td>
                                <td> <label for="paying_now">Paying Now (Amount) : </label>
                                </td>
                                <td><input class="input" name="Paid Amount" id="paying_now" type="number"
                                    (input)="balancePaid()" [(ngModel)]="patientpaymentObj.orderAmount"
                                    [ngModelOptions]="{standalone: true}" (keypress)="keyPressNumbersWithDecimal($event)" />
                                </td>
    
                              </tr>
    
                            </table>
                          </div>
                          <div class="col-md-12 mt-2">
                            <table>
                              <tr>
                                <td> <label for="Remarks">Comments: </label>
                                </td>
                                <td>
                                  <textarea name="Remarks" style="margin-left: 21px;"
                                    [(ngModel)]="patientpaymentObj.comments"
                                    [ngModelOptions]="{standalone: true}"></textarea>
                                </td>
                              </tr>
                            </table>
                          </div>
                        </div>
    
                        <br />
                        <button type="submit" style="float: right;" class="btn btn-primary"
                          (click)="addBillingData()">Submit</button>
                        <br>
                      </div>
                    </div>
     -->

          <!-- </mat-expansion-panel>
                </mat-accordion> -->
          <!-- </div>
            </div> -->
        </div>
        <!-- </div> -->

        <div *ngIf="showQuestioner && !showUploadFiles">
          <div class="card bg-light">
            <div class="card-body">
              <div class="card p-3">
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group">
                      <label for="">PID</label>
                      <input
                        class="form-control"
                        formControlName="PID"
                        [disabled]
                      />
                    </div>
                    <div class="form-group">
                      <label for="">Patient Name</label>
                      <input class="form-control" formControlName="name" />
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div
                      class="form-group"
                      *ngIf="patientdetailsdata?.createdAt"
                    >
                      <label for="">REG. Date</label>
                      <input
                        class="form-control"
                        disabled
                        [value]="
                          patientdetailsdata?.createdAt
                            | date: 'dd-MM-yyyy HH:mm'
                        "
                      />
                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="qr-code border-success">
                      <label>Bar Code</label>
                      <ngx-barcode
                        [bc-value]="value"
                        [bc-display-value]="true"
                      ></ngx-barcode>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="qr-code border-success">
                      <label>QR Code</label>
                      <qrcode
                        [qrdata]="value"
                        [width]="150"
                        [errorCorrectionLevel]="'M'"
                      ></qrcode>
                    </div>
                  </div>
                </div>
              </div>
              <mat-card class="mt-3 questionnaire">
                <h4>Questionnaire</h4>
                <table class="table table-bordered m-0 text-center">
                  <tr>
                    <th class="sno">S.No</th>
                    <th class="question">Question</th>
                    <th class="answer">Answer</th>
                    <th>Code</th>
                  </tr>
                </table>
                <div *ngFor="let grp of questionForm.controls">
                  <form [formGroup]="grp" class="questForm">
                    <table class="table table-bordered m-0 text-center">
                      <td class="sec">{{ grp.value.name }}</td>
                    </table>
                    <!-- <label > </label> -->
                    <div
                      formArrayName="questions"
                      *ngFor="
                        let item of grp?.get('questions')['controls'];
                        let i = index
                      "
                    >
                      <table
                        [formGroup]="item"
                        class="table table-bordered m-0"
                      >
                        <tr>
                          <td class="sno">{{ i + 1 }}</td>
                          <td class="question">{{ item?.value?.question }}</td>
                          <td class="answer">
                            <div *ngIf="item.value.type == 'options'">
                              <mat-radio-group
                                aria-label="Select an option"
                                class="checkbox"
                                formControlName="answer"
                              >
                                <mat-radio-button
                                  class="col-lg-12 optionText"
                                  *ngFor="
                                    let answers of item.value?.possibleAnswers
                                  "
                                  [value]="answers"
                                  >{{ answers }}</mat-radio-button
                                >
                                <!-- <mat-radio-button value="no">No</mat-radio-button> -->
                              </mat-radio-group>
                            </div>
                            <div *ngIf="item.value.type == 'checkbox'">
                              <!-- <label formArrayName="answer" *ngFor="let order of item.get('answer')['controls']; let i = index">
                                                        <input type="checkbox" [formControlName]="i">
                                                        {{item.value.possibleAnswers[i]}}
                                                      </label> -->
                              <section
                                class="example-section checkbox"
                                formArrayName="answer"
                                *ngFor="
                                  let order of item.get('answer')['controls'];
                                  let i = index
                                "
                              >
                                <mat-checkbox
                                  class="example-margin"
                                  [formControlName]="i"
                                  class="col-lg-12 optionText"
                                  [value]="item.value.possibleAnswers[i]"
                                >
                                  {{
                                    item?.value?.possibleAnswers[i]
                                  }}</mat-checkbox
                                >
                              </section>
                            </div>
                            <div
                              class="input-with-measure"
                              *ngIf="
                                item.value.type == 'input' ||
                                item.value.type == 'paragraph' ||
                                item.value.type == 'textArea' ||
                                item.value.type == 'numeric'
                              "
                            >
                              <input
                                class="form-control"
                                formControlName="answer"
                              /><span>{{ item?.value?.units }}</span>
                            </div>
                            <div
                              class="input-with-measure"
                              *ngIf="item.value.type == 'dropdown'"
                            >
                              <ng-select
                                [placeholder]="
                                  getPlaceholder(item?.value?.question)
                                "
                                formControlName="answer"
                              >
                                <!-- <ng-option *ngFor="let language of item?.value?.possibleAnswers" [value]="language">{{language | titlecase }}</ng-option> -->
                                <ng-option
                                  *ngFor="
                                    let language of item?.value?.possibleAnswers
                                  "
                                  [value]="language"
                                  >{{ language | titlecase }}</ng-option
                                >
                              </ng-select>
                              <!-- <select class="form-control" formControlName="answer">
                                                            <option value="" disabled>Select Language</option>
                                                            <option *ngFor="let language of item?.value?.possibleAnswers" value="{{language}}">{{language | titlecase }}</option>
                                                        </select> -->
                              <!-- <input class="form-control"
                                                            formControlName="answer"><span>{{item?.value?.units}}</span> -->
                            </div>
                            <div
                              class="input-with-measure"
                              *ngIf="item.value.type == 'time'"
                            >
                              <!-- <igx-time-picker  formControlName="answer">
                                                        </igx-time-picker> -->
                              <input
                                class="form-control"
                                formControlName="answer"
                              /><span>{{ item?.value?.units }}</span>
                            </div>
                            <div *ngIf="item.value.type == 'date'">
                              <input
                                class="form-control"
                                type="date"
                                formControlName="answer"
                              />
                            </div>
                            <div *ngIf="item.value.type == 'radio'">
                              <mat-radio-group
                                aria-label="Select an option"
                                formControlName="answer"
                              >
                                <mat-radio-button value="yes"
                                  >Yes</mat-radio-button
                                >
                                <mat-radio-button value="no"
                                  >No</mat-radio-button
                                >
                              </mat-radio-group>
                            </div>
                          </td>
                          <td>{{ item.value.code }}</td>
                        </tr>

                        <tr
                          formArrayName="subquestions"
                          *ngFor="
                            let sub of item.get('subquestions')['controls'];
                            let j = index
                          "
                        >
                          <!-- < > -->
                          <td [formGroupName]="j" class="sno">
                            {{ i + 1 }}.{{ j + 1 }}
                          </td>
                          <td [formGroupName]="j" class="question">
                            {{ sub.value.question }}
                          </td>
                          <td [formGroupName]="j" class="answer">
                            <div *ngIf="sub.value.type == 'options'">
                              <mat-radio-group
                                aria-label="Select an option"
                                class="checkbox"
                                formControlName="answer"
                              >
                                <mat-radio-button
                                  class="col-lg-12 optionText"
                                  *ngFor="
                                    let answers of sub.value?.possibleAnswers
                                  "
                                  [value]="answers"
                                  >{{ answers }}
                                </mat-radio-button>
                                <!-- <mat-radio-button value="no">No</mat-radio-button> -->
                              </mat-radio-group>
                            </div>
                            <div *ngIf="sub.value.type == 'checkbox'">
                              <!-- <label formArrayName="answer" *ngFor="let order of item.get('answer')['controls']; let i = index">
                                                               <input type="checkbox" [formControlName]="i">
                                                               {{item.value.possibleAnswers[i]}}
                                                             </label> -->
                              <section
                                class="example-section checkbox"
                                formArrayName="answer"
                                *ngFor="
                                  let order of sub.get('answer')['controls'];
                                  let i = index
                                "
                              >
                                <mat-checkbox
                                  class="example-margin"
                                  [formControlName]="i"
                                  class="col-lg-12 optionText"
                                  [value]="sub.value.possibleAnswers[i]"
                                >
                                  {{
                                    sub.value.possibleAnswers[i]
                                  }}</mat-checkbox
                                >
                              </section>
                            </div>
                            <div
                              *ngIf="
                                sub.value.type == 'input' ||
                                sub.value.type == 'paragraph' ||
                                sub.value.type == 'textArea' ||
                                sub.value.type == 'numeric'
                              "
                            >
                              <input
                                class="form-control"
                                formControlName="answer"
                              />{{ sub.value?.units }}
                            </div>
                            <div
                              class="input-with-measure"
                              *ngIf="sub.value.type == 'dropdown'"
                            >
                              <ng-select
                                [placeholder]="
                                  getPlaceholder(sub?.value?.question)
                                "
                                formControlName="answer"
                              >
                                <!-- <ng-option *ngFor="let language of item?.value?.possibleAnswers" [value]="language">{{language | titlecase }}</ng-option> -->
                                <ng-option
                                  *ngFor="
                                    let language of sub?.value?.possibleAnswers
                                  "
                                  [value]="language"
                                  >{{ language | titlecase }}</ng-option
                                >
                              </ng-select>
                              <!-- <select class="form-control" formControlName="answer">
                                                        <option value="" disabled>Select Language</option>
                                                        <option *ngFor="let language of item?.value?.possibleAnswers" value="{{language}}">{{language | titlecase }}</option>
                                                    </select> -->
                              <!-- <input class="form-control"
                                                        formControlName="answer"><span>{{item?.value?.units}}</span> -->
                            </div>
                            <div
                              class="input-with-measure"
                              *ngIf="sub.value.type == 'time'"
                            >
                              <!-- <igx-time-picker  formControlName="answer">
                                                    </igx-time-picker> -->
                              <input
                                class="form-control"
                                formControlName="answer"
                              /><span>{{ sub?.value?.units }}</span>
                            </div>
                            <div *ngIf="sub.value.type == 'date'">
                              <input
                                class="form-control"
                                type="date"
                                formControlName="answer"
                              />
                            </div>
                            <div *ngIf="sub.value.type == 'radio'">
                              <mat-radio-group
                                aria-label="Select an option"
                                formControlName="answer"
                              >
                                <mat-radio-button value="yes"
                                  >Yes</mat-radio-button
                                >
                                <mat-radio-button value="no"
                                  >No</mat-radio-button
                                >
                              </mat-radio-group>
                            </div>
                          </td>
                          <td [formGroupName]="j">{{ sub.value.code }}</td>
                        </tr>
                      </table>
                    </div>
                  </form>
                </div>
                <button class="btn" (click)="questionnaireForm()">Apply</button>
              </mat-card>
            </div>
          </div>
        </div>
        <div *ngIf="!showQuestioner && showUploadFiles">
          <div class="card bg-light">
            <div class="card-body">
              <div class="card p-3">
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group">
                      <label for="">PID</label>
                      <input
                        class="form-control"
                        formControlName="PID"
                        readonly
                      />
                    </div>
                    <div class="form-group">
                      <label for="">Patient Name</label>
                      <input
                        class="form-control"
                        formControlName="name"
                        readonly
                      />
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div
                      class="form-group"
                      *ngIf="patientdetailsdata?.createdAt"
                    >
                      <label for="">REG. Date</label>
                      <input
                        class="form-control"
                        readonly
                        [value]="
                          patientdetailsdata?.createdAt
                            | date: 'dd-MM-yyyy HH:mm'
                        "
                      />
                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="qr-code border-success">
                      <label>Bar Code</label>
                      <ngx-barcode
                        [bc-value]="value"
                        [bc-display-value]="true"
                      ></ngx-barcode>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="qr-code border-success">
                      <label>QR Code</label>
                      <qrcode
                        [qrdata]="value"
                        [width]="150"
                        [errorCorrectionLevel]="'M'"
                      ></qrcode>
                    </div>
                  </div>
                </div>
              </div>
              <mat-card class="mt-3">
                <h4>Upload Reports</h4>
                <div>
                  <!-- [formGroup]="myForm" (submit)="questionnaireForm()" -->
                  <form>
                    <div class="form-group">
                      <input
                        type="file"
                        multiple
                        class="form-control"
                        [(ngModel)]="file"
                        name="file"
                        (change)="UploadFiles($event)"
                      />
                    </div>
                    <button
                      class="btn"
                      (click)="submitUploadFiles()"
                      [attr.disabled]="
                        uploadFilesData.length < 1 ? false : null
                      "
                      [ngClass]="{
                        'disable-button': uploadFilesData.length == 0
                      }"
                    >
                      Submit
                    </button>
                  </form>
                </div>
                <h4 *ngIf="uploadFilesDetails?.length > 0">
                  Previous Upload Reports
                </h4>
                <div class="row m-2">
                  <div class="col-lg-12">
                    <div
                      class="image reports-images"
                      *ngFor="let item of uploadFilesDetails"
                    >
                      <img
                        src="{{ image }}/{{ item?.attachment }}"
                        width="300px"
                        height="300px"
                        class="paient_repots"
                      />
                    </div>
                  </div>

                  <!-- <div class="col-lg-4">
                                <div class="imgae">
                                    <img src="../../../assets/depart.jpg" class="img-responsive img-fluid">
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="imgae">
                                    <img src="../../../assets/depart.jpg" class="img-responsive img-fluid">
                                </div>
                            </div> -->
                </div>
              </mat-card>
            </div>
          </div>
        </div>
      </form>
      <div id="print-barcode" class="d-none">
        <table>
          <tbody>
            <tr>
              <td>
                <ngx-barcode
                  [bc-value]="value"
                  [bc-display-value]="true"
                ></ngx-barcode>
              </td>
              <td>
                <ngx-barcode
                  [bc-value]="value"
                  [bc-display-value]="true"
                ></ngx-barcode>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- [ngClass]="{'printident': showqrcode}" -->
    <!-- id="printform" directPrint="true" ngxPrintItemMarker-->

    <ng-template #referrerDialogue>
      <mat-dialog-content>
        <a
          class="btn btn-xs btn-icon btn-hover-primary btn_close"
          style="margin-left: 93%; line-height: 21px"
          href="javascript:void(0)"
          (click)="onClose()"
          >X</a
        >&nbsp;

        <!-- <div class="country-container mt-3">
        <div class="container-fluid"> -->
        <div class="card">
          <div class="card-header">
            <!-- <div class="card-title"> -->
            <div class="row">
              <h2 class="card-label">Organization</h2>
              <!-- </div> -->
              <!-- <div class="card-toolbar">
                <div class="example-tools justify-content-centerr"> -->
              <input
                type="search"
                placeholder="Search Organization"
                style="width: 190px; margin-left: 3%"
                class="select_vaccine"
                [(ngModel)]="searchValue"
                (input)="searchHospital()"
              />&nbsp;
              <input type="button" value="ok" (click)="assignOrg()" />
              <!-- <button (click)="addHospital()" class="btn btnGroup">
                    Add
                  </button>  -->

              <!-- </div>
              </div> -->
            </div>
            <!-- <div>
              <input type="button" value="A">
              <input type="button" value="B">
              <input type="button" value="C">
              <input type="button" value="D">
              <input type="button" value="E">
              <input type="button" value="F">
           </div> -->
          </div>
          <div class="card-body">
            <div class="mx-auto" *ngIf="hospitalDetails?.length === 0">
              No Data Found
            </div>
            <div
              class="table-responsive example-container mat-elevation-z8"
              *ngIf="hospitalDetails?.length > 0"
            >
              <table class="table table-hover text-center">
                <thead>
                  <tr>
                    <th></th>
                    <th>S.No</th>

                    <th (click)="sortEvent('name')">
                      Name
                      <i
                        class="fa fa-chevron-up"
                        *ngIf="sortDirection === 'ASC' && sortvalue === 'name'"
                      ></i>
                      <i
                        class="fa fa-chevron-down"
                        *ngIf="sortDirection === 'DASC' && sortvalue === 'name'"
                      ></i>
                    </th>
                    <th (click)="sortEvent('referenceCode')">
                      Reference Code
                      <i
                        class="fa fa-chevron-up"
                        *ngIf="
                          sortDirection === 'ASC' &&
                          sortvalue === 'referenceCode'
                        "
                      ></i>
                      <i
                        class="fa fa-chevron-down"
                        *ngIf="
                          sortDirection === 'DASC' &&
                          sortvalue === 'referenceCode'
                        "
                      ></i>
                    </th>
                    <!-- <th (click)="sortEvent('type')">Type
                                <i class="fa fa-chevron-up" *ngIf="sortDirection === 'ASC' && sortvalue === 'type'" ></i>
                                <i class="fa fa-chevron-down" *ngIf="sortDirection === 'DASC' && sortvalue === 'type'"></i>
                              </th> -->
                    <!-- <th (click)="sortEvent('city')">City
                                <i class="fa fa-chevron-up" *ngIf="sortDirection === 'ASC' && sortvalue === 'city'" ></i>
                                <i class="fa fa-chevron-down" *ngIf="sortDirection === 'DASC' && sortvalue === 'city'"></i>
                              </th>
                               <th (click)="sortEvent('state')">State
                                <i class="fa fa-chevron-up" *ngIf="sortDirection === 'ASC' && sortvalue === 'state'" ></i>
                                <i class="fa fa-chevron-down" *ngIf="sortDirection === 'DASC' && sortvalue === 'state'"></i>
                              </th>
                               <th (click)="sortEvent('country')">Country
                                <i class="fa fa-chevron-up" *ngIf="sortDirection === 'ASC' && sortvalue === 'country'" ></i>
                                <i class="fa fa-chevron-down" *ngIf="sortDirection === 'DASC' && sortvalue === 'country'"></i>
                              </th> -->
                    <!-- <th (click)="sortEvent('description')">Description
                                <i class="fa fa-chevron-up" *ngIf="sortDirection === 'ASC' && sortvalue === 'description'" ></i>
                                <i class="fa fa-chevron-down" *ngIf="sortDirection === 'DASC' && sortvalue === 'description'"></i>
                              </th> -->
                    <th (click)="sortEvent('mobile')">
                      Mobile
                      <i
                        class="fa fa-chevron-up"
                        *ngIf="
                          sortDirection === 'ASC' && sortvalue === 'mobile'
                        "
                      ></i>
                      <i
                        class="fa fa-chevron-down"
                        *ngIf="
                          sortDirection === 'DASC' && sortvalue === 'mobile'
                        "
                      ></i>
                    </th>
                    <th (click)="sortEvent('contactPerson')">
                      Contact Person
                      <i
                        class="fa fa-chevron-up"
                        *ngIf="
                          sortDirection === 'ASC' &&
                          sortvalue === 'contactPerson'
                        "
                      ></i>
                      <i
                        class="fa fa-chevron-down"
                        *ngIf="
                          sortDirection === 'DASC' &&
                          sortvalue === 'contactPerson'
                        "
                      ></i>
                    </th>
                    <!-- <th>Action</th> -->
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let item of hospitalDetails; let i = index">
                    <td>
                      <mat-radio-button
                        (change)="selectOrg(item)"
                        class="example-radio-button"
                      >
                      </mat-radio-button>
                    </td>
                    <td>
                      {{ i + pageEvent?.pageIndex * pageEvent?.pageSize + 1 }}
                    </td>
                    <td>{{ item.name | titlecase }}</td>
                    <td>{{ item?.referenceCode }}</td>
                    <!-- <td>{{ item.type }}</td>
                               <td>{{ item.city }}</td>
                               <td>{{ item.state }}</td>
                               <td>{{ item.country }}</td>
                               <td>{{ item.description }}</td> -->
                    <td>{{ item.mobile }}</td>
                    <td>{{ item.contactPerson }}</td>
                    <!-- <td> -->
                    <!-- <div class="d-flex mb-0">
    
                                  <mat-icon (click)="editHospital(item)">edit</mat-icon>
                                  <mat-icon class="delete_icon_color" (click)="deleteHospital(item)">delete</mat-icon>
                                 </div> -->

                    <!-- </td> -->
                  </tr>
                </tbody>
              </table>
              <div
                style="border-bottom: 1px solid #ced4da; margin-top: -12px"
              ></div>
              <!-- pagination div starts from here -->
              <mat-paginator
                [length]="length"
                [pageSize]="pageSize"
                [pageSizeOptions]="pageSizeOptions"
                (page)="onPageEvent($event)"
              >
              </mat-paginator>

              <!-- pagination div ends here -->
            </div>
          </div>
        </div>
        <!-- </div>
      </div> -->
      </mat-dialog-content>
    </ng-template>

    <ng-template #myDailog>
      <mat-dialog-content>
        <div class="modal-heading-div">
          <h2 matDialogTitle class="mat">Update Test Values</h2>
          <button
            mat-button
            matDialogClose
            color="primary"
            class="cancel-button"
          >
            <i class="fa fa-times"></i>
          </button>
        </div>
        <mat-card>
          <form [formGroup]="updateTestsForm" (ngSubmit)="updateTestsDetails()">
            <div class="form-group">
              <label for="">Test Name</label>
              <!-- <input class="form-ontrol" [disabled] formControlName="test"> -->
              <select disabled formControlName="test" class="form-control">
                <option *ngFor="let item of testsDetails" [value]="item._id">
                  {{ item.name }}
                </option>
              </select>
            </div>
            <div class="form-group">
              <label for="">Value</label>
              <input class="form-control" formControlName="value" />
            </div>
            <div class="form-group">
              <label for="">Comment</label>
              <input class="form-control" formControlName="comment" />
            </div>
            <div>
              <button class="btn" type="submit">Update</button>
            </div>
          </form>
        </mat-card>
      </mat-dialog-content>
    </ng-template>

    <ng-template #content let-modal>
      <!-- <div></div> -->
      <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">
          Report Template: <b>{{ currentItem.test.name }}</b>
        </h4>
        <button
          type="button"
          class="close"
          aria-label="Close"
          (click)="modal.dismiss('Cross click')"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- *ngIf="!docViweEditorFlag" -->
        <div>
          <!-- <div><button></button></div> -->
          <!-- <ngx-doc-viewer [url]="doc" viewer="google" style="width:100%;height:50vh;"></ngx-doc-viewer> -->
          <div class="text-right">
            <!-- <button class="btn btn-md mb-4" (click)="toggleDisabled()">
                        {{ isDisabled ? 'Edit Template' : 'Cancel' }}
                    </button> -->
          </div>
          <div class="col-md-12">
            <div class="border p-3">
              <p class="mb-0" [innerHtml]="templateViewContent"></p>
            </div>
            <!-- data="templateViewContent" (change)="changedTemplateContent($event)"-->
            <!-- <ckeditor [editor]="Editor" [(ngModel)]="templateViewContent" [disabled]="isDisabled">
                    </ckeditor> -->
          </div>
        </div>
        <!-- <div *ngIf="docViweEditorFlag">
                <h6>Edit section</h6>
            </div> -->
      </div>
      <div class="modal-footer">
        <!-- (click)="editDocView()"-->
        <!-- <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')"> Cancel</button> -->
        <!-- <button type="button" class="btn btn-outline-dark" (click)="saveTemplateEditData()">Save changes</button> -->
      </div>
    </ng-template>

    <ng-template #openTestsModal>
      <h3 class="mb-2 font-weight-bold">Cancel Test</h3>
      <mat-dialog-content>
        <div class="">
          <form [formGroup]="reasonForm" (ngSubmit)="submitReason()">
            <div class="form-group">
              <label for="" class="title_info">Reason</label>
              <input
                type="text"
                class="form-control"
                formControlName="cancel_reason"
              />
            </div>

            <!-- <div class="button-alignment text-right">
                <button class="button-select mr-2" [mat-dialog-close]="true" cdkFocusInitial>Close</button>
                <button class="button-select" cdkFocusInitial>Confirm cancel</button>
            </div> -->

            <!-- <div class="col-md-4"></div>
                <div class="col-md-3">
                </div> -->

            <div class="row button-alignment">
              <div class="col-md-12 d-flex">
                <button
                  [mat-dialog-close]="true"
                  class="form-control cancel-btn button_bg mr-2"
                >
                  Cancel
                </button>
                <button
                  class="form-control confirm-btn"
                  [disabled]="!reasonForm.valid"
                  [ngClass]="{ btnDisabled: !reasonForm.valid }"
                >
                  Confirm cancel
                </button>
              </div>
            </div>
          </form>
        </div>
      </mat-dialog-content>
    </ng-template>

    <ng-template #vaccineModal>
      <p>modal</p>
    </ng-template>

    <ng-template #downloadTestReport>
      <mat-dialog-content>
        <div>
          <div class="d-flex justify-content-between">
            <h1 mat-dialog-title>Download Report</h1>
            <div class="button">
              <a
                class="btn btn-xs btn-icon btn-hover-primary btn_close"
                href="javascript:void(0)"
                (click)="onClose()"
                >X</a
              >
            </div>
          </div>
          <form [formGroup]="templeteForm">
            <div class="row">
              <div class="col-md-4 mt-3">
                <input
                  type="checkBox"
                  name="promotion"
                  id="promotion"
                  [formControl]="templeteForm.controls['promotionPage']"
                />
                <label for="promotion">Promotion Page</label>
              </div>
              <div class="col-md-6">
                <mat-form-field class="full-width">
                  <mat-label>Select Header</mat-label>
                  <mat-select
                    class=""
                    [formControl]="templeteForm.controls['header_type']"
                  >
                    <mat-option value="true"> With Header </mat-option>
                    <mat-option value="false"> Without Header </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

            <div class="row buttons mt-3">
              <div style="margin: 0 auto">
                <button
                  *ngIf="!patientdetailsdata?.isReferralPatient"
                  class="button-mat"
                  (click)="downloadReport(selectedDownloadTest)"
                  [ngClass]="{ btnDisabled: !templeteForm.valid }"
                  [disabled]="!templeteForm.valid"
                >
                  Download
                </button>
                <button
                  *ngIf="patientdetailsdata?.isReferralPatient"
                  class="button-mat"
                  (click)="
                    downloadReferralTestReport(
                      selectedDownloadTest,
                      patientdetailsdata
                    )
                  "
                  [ngClass]="{ btnDisabled: !templeteForm.valid }"
                  [disabled]="!templeteForm.valid"
                >
                  Download
                </button>
              </div>
            </div>
          </form>
        </div>
      </mat-dialog-content>
      <ngx-spinner
        bdColor="rgba(0, 0, 0, 0.8)"
        size="medium"
        color="#fff"
        type="timer"
        [fullScreen]="true"
      >
        <p style="color: white">Processing...</p>
      </ngx-spinner>
    </ng-template>
    <ng-template #testObjInfo>
      <div class="card" style="overflow: auto; height: 90vh">
        <ngx-json-viewer [json]="selectedTestInfoObj"></ngx-json-viewer>
      </div>
    </ng-template>

    <ng-template #addBulkDialog>
      <mat-dialog-content>
        <div>
          <form>
            <div class="mb-5" [formGroup]="bulkUploadForm">
              <div class="d-flex justify-content-between">
                <h1 mat-dialog-title>Upload Bulk Patients</h1>
                <div class="button">
                  <a
                    class="btn btn-xs btn-icon btn-hover-primary btn_close"
                    href="javascript:void(0)"
                    (click)="onClose()"
                    >X</a
                  >
                </div>
              </div>
              <div></div>
              <div class="mt-2">
                <!-- <mat-form-field class="full-width">
                <input type="text" [(ngModel)]="organizationName" matInput placeholder="Select Organization" (ngModelChange)=onSelectionChanged($event) [matAutocomplete]="autoCo" />
                <mat-autocomplete #autoCo="matAutocomplete"  >
                    <mat-option *ngFor="let item of filteredOrganizations" [value]="item?.name">
                      {{item?.name}} - {{item?.category}}
                    </mat-option>
                </mat-autocomplete>
              </mat-form-field> -->
                <!-- *ngIf="userdetails?.role == 'admin'" -->
                <mat-form-field class="full-width">
                  <mat-label>Select Organization</mat-label>
                  <mat-select
                    formControlName="subdivisionID"
                    (selectionChange)="selectedOrganization($event.value)"
                  >
                    <mat-option
                      *ngFor="let item of organizations"
                      [value]="item?._id"
                      >{{ item?.name }} - {{ item?.category }} -
                      {{ item?.referenceCode }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <p class="text-danger">{{ this.errormessage }}</p>
                <!-- <input class="full-width select_input"  type="text"readonly [ngModel]="subdivisionName" *ngIf="userdetails?.role != 'admin'"> -->
              </div>
              <label>Excel File:</label>
              <div class="input-group mb-3">
                <input
                  type="file"
                  class="form-control field"
                  accept=".csv,.xls,.xlsx"
                  placeholder="Excel File"
                  aria-label="Username"
                  (change)="onFileChanges($event)"
                  aria-describedby="basic-addon1"
                />
              </div>
              <p class="text-danger">{{ this.errormessage1 }}</p>
            </div>
            <div class="row buttons" style="justify-content: center">
              <div class="cancel mr-1">
                <button (click)="sampleFileDownload()" class="button-mat">
                  Download Sample File
                </button>
              </div>

              <div class="">
                <button class="button-mat" (click)="onSubmitUpload()">
                  Upload
                </button>
              </div>
              <div class="cancel mr-1">
                <button (click)="onClose()" class="button-mat">Cancel</button>
              </div>
            </div>
          </form>
        </div>
      </mat-dialog-content>
      <ngx-spinner
        bdColor="rgba(0, 0, 0, 0.8)"
        size="medium"
        color="#fff"
        type="timer"
        [fullScreen]="true"
      >
        <p style="color: white">Processing...</p>
      </ngx-spinner>
    </ng-template>

    <div class="d-none">
      <table id="patient-invalid-records">
        <tr>
          <th>SL NO</th>
          <th>NAME</th>
          <th>AGE</th>
          <th>Gender</th>
          <th>Mobile</th>
          <th>Address</th>
          <th>ADHAR CARD</th>
          <th>PASSPORt</th>
          <th>LOCATION</th>
          <th>Reference Code</th>
          <th>Test Code</th>
          <th>Sample Register Date</th>
        </tr>
        <tr *ngFor="let item of invalidRecordsData; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ item?.name }}</td>
          <td>{{ item?.age }}</td>
          <td>{{ item?.gender }}</td>
          <td>{{ item?.mobileNumber }}</td>
          <td>{{ item?.address }}</td>
          <td>{{ item?.aadhaar }}</td>
          <td>{{ item?.passport }}</td>
          <td>{{ item?.location }}</td>
          <td>{{ item?.referenceCode }}</td>
          <td>{{ item?.test }}</td>
          <td>{{ item?.sampleDate }}</td>
        </tr>
      </table>
    </div>
    <ngx-spinner
      bdColor="rgba(0, 0, 0, 0.8)"
      size="medium"
      color="#fff"
      type="timer"
      [fullScreen]="true"
    >
      <p style="color: white">Processing...</p>
    </ngx-spinner>

    <ng-template #sendPaymentLink>
      <div class="col-md-12 d-flex mt-3 text-center">
        <h3><b>Payment Link</b></h3>
      </div>
      <mat-radio-group
        [(ngModel)]="paymentLinkType"
        name="paymentLinkType"
        aria-label="Select an option"
        class="checkbox row"
      >
        <!-- <mat-radio-button class="col-lg-4 optionText" value="email">Email
      </mat-radio-button> -->
        <mat-radio-button
          class="col-lg-4 optionText"
          name="type_payment"
          value="sms"
          >SMS
        </mat-radio-button>
        <mat-radio-button
          class="col-lg-4 optionText"
          name="type_payment"
          value="whats_app"
          >WhatsApp
        </mat-radio-button>
      </mat-radio-group>

      <div class="col-md-6 d-flex mt-2" *ngIf="paymentLinkType == 'email'">
        <input
          class="inputbox"
          type="email"
          name="email"
          id="email"
          placeholder="Enter Email"
        />
      </div>

      <div class="col-md-6 d-flex mt-2" *ngIf="paymentLinkType != 'email'">
        <input
          class="inputbox"
          type="number"
          [(ngModel)]="patientpaymentObj.patient.mobileNumber"
          name="mobileNumber"
          id="mobileNumber"
          placeholder="Enter Mobile Number"
        />
      </div>
      <br />
      <div class="col-md-6 d-flex text-center">
        <button
          class="buttondialoge mt-2"
          (click)="createPaymentLink()"
          [disabled]="!patientpaymentObj.patient.mobileNumber"
        >
          Yes
        </button>

        <button
          class="buttondialoge mt-2 ml-2"
          [mat-dialog-close]="true"
          cdkFocusInitial
        >
          Close
        </button>
      </div>
      <ngx-spinner
        bdColor="rgba(0, 0, 0, 0.8)"
        size="medium"
        color="#fff"
        type="timer"
        [fullScreen]="true"
      >
        <p style="color: white">Loading...</p>
      </ngx-spinner>
    </ng-template>

    <ng-template #transationLogModal>
      <div class="col-md-12 d-flex mt-3 text-center">
        <h3><b>Transaction Details</b></h3>
      </div>

      <div class="table-responsive" style="height: 50vh; overflow: scroll">
        <table class="table table-hover">
          <thead>
            <tr class="text-center">
              <th>S.NO</th>
              <th>Transaction Date</th>
              <th>Transaction Type</th>
              <th>Paid Details</th>
              <th>Amount</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr
              class="text-center"
              *ngFor="let transInfo of transactionLog$.reverse(); let i = index"
            >
              <td>{{ i + 1 }}</td>
              <td>{{ transInfo.transactionDate }}</td>
              <td>{{ transInfo.transactionType }}</td>
              <td>
                {{ transInfo.details | json }}
              </td>
              <td>{{ transInfo.transactionAmount }}</td>
              <td>
                {{ transInfo.status }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="col-md-6 d-flex text-center">
        <button
          class="buttondialoge mt-2 ml-2"
          [mat-dialog-close]="true"
          cdkFocusInitial
        >
          Close
        </button>
      </div>
    </ng-template>
  </mat-tab>
  <mat-tab label="Doctor View">
    <div class="container-fluid registrationform">
      <form [formGroup]="patientRegistrationForm">
        <div class="patient mt-2">
          <h2 class="m-0">PATIENT REGISTRATION</h2>
          <div class="button-group">
            <div class="mt-2 mr-2">
              <mat-form-field class="example-full-width">
                <input
                  type="text"
                  placeholder="Search  By Name or PID"
                  aria-label="Number"
                  matInput
                  [(ngModel)]="selectValue"
                  [formControl]="myControl"
                  (keyup)="getpatients($event)"
                  [matAutocomplete]="auto"
                />
                <!-- (keyup)="checkPin($event)"  -->
                <mat-autocomplete
                  autoActiveFirstOption
                  #auto="matAutocomplete"
                  (optionSelected)="onFileChange($event.option.value)"
                >
                  <mat-option
                    *ngFor="let option of options"
                    [value]="option.pid"
                    multiple
                  >
                    {{ option?.name }} {{ option?.mobileNumber }}
                    {{ option?.pid }}
                  </mat-option>
                </mat-autocomplete>
              </mat-form-field>
            </div>

            <button
              class="btn-primary mr-2"
              *ngIf="!patientdetailsdata?.pid"
              (click)="bulkupload(addBulkDialog)"
            >
              Bulk Upload
            </button>

            <button
              class="btn-primary mr-2"
              (click)="printForm('printform')"
              hidden
            ></button>
            <button
              class="btn-primary mr-2"
              (click)="print('print')"
              *ngIf="!patientdetailsdata?.pid"
            >
              Print Form
            </button>
            <!-- <button class=" btn-primary mr-2" *ngIf="patientdetailsdata?.pid"  (click)="printForm('printform')"
                        ngxPrintItemButton className="printident" hidden></button> -->
            <button
              class="btn-primary mr-2"
              *ngIf="patientdetailsdata?.pid"
              (click)="printForm('reprintform')"
              ngxPrintItemButton
              className="printident"
            >
              Reprint Form
            </button>
            <button
              class="btn-primary mr-2"
              *ngIf="patientdetailsdata?.pid"
              printSectionId="print-barcode"
              ngxPrint
            >
              Print Barcode
            </button>
            <!-- <button class=" btn-primary mr-2" *ngIf="patientdetailsdata?.pid" 
                        >Print
                        Barcode</button> -->
            <button
              class="btn-primary mr-2"
              printSectionId="print-questionnaire"
              [useExistingCss]="true"
              ngxPrint
            >
              Print Questionnaire
            </button>
            <!-- <button class=" btn-primary mr-2" *ngIf="patientdetailsdata?.pid" (click)="printForm('reprintform')" >Reprint Form</button> -->

            <!-- printSectionId="printform" [useExistingCss]="true"  ngxPrint  (click)="printForm()"-->
            <button
              class="btn-primary mr-2"
              *ngIf="patientdetailsdata?.pid"
              (click)="onChangeForm('Questionnaire')"
            >
              {{ showQuestioner === false ? "Questionnaire" : "RegisterForm" }}
            </button>
            <button
              class="btn-primary mr-2"
              *ngIf="patientdetailsdata?.pid"
              (click)="onChangeForm('Upload Tests')"
            >
              {{
                showUploadFiles === false ? "Upload Reports" : "RegisterForm"
              }}
            </button>
          </div>
        </div>

        <div *ngIf="!showQuestioner && !showUploadFiles">
          <div class="card bg-light">
            <div class="card-body firstCard">
              <div class="card p-3" *ngIf="isSubDivisionPatient">
                <div class="progress-bar-icons" style="height: 73px">
                  <ul>
                    <li [ngClass]="{ active: patientaccshow === 'patient' }">
                      <span>Patient</span>
                      <p class="active"></p>
                    </li>
                    <li [ngClass]="{ active: testaccshow === 'test' }">
                      <span>Tests</span>
                      <p class="active"></p>
                    </li>
                    <li
                      [ngClass]="{ active: vaccineaccshow === 'vaccine' }"
                      *ngIf="patientdetailsdata?.isVaccineREG == true"
                    >
                      <span>Vaccine</span>
                      <p class="active"></p>
                    </li>
                    <li [ngClass]="{ active: pastaccshow === 'past' }">
                      <span>Past Medic History</span>
                      <p class="active"></p>
                    </li>
                    <li [ngClass]="{ active: familyaccshow === 'family' }">
                      <span>Family History</span>
                      <p class="active"></p>
                    </li>
                    <li
                      [ngClass]="{
                        active: doctorReviewshow === 'doctorReview'
                      }"
                    >
                      <span>Doctor Review</span>
                      <p class="active"></p>
                    </li>
                    <li
                      [ngClass]="{
                        active: questionnaireshow === 'questionnaireView'
                      }"
                      *ngIf="showQuestionnaireView"
                    >
                      <span>Questionnaire</span>
                      <p class="active"></p>
                    </li>
                    <li [ngClass]="{ active: billingshow === 'billing' }">
                      <span>Billing</span>
                      <p class="active"></p>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
            <div class="card-body firstCard">
              <div class="card p-3">
                <div class="row">
                  <div class="col-lg-3">
                    <div class="form-group">
                      <label for="">PID</label>
                      <button
                        class="btn-btn-primary scanButton"
                        (click)="sacnEanble()"
                        type="submit"
                        id="pid-b"
                        *ngIf="!hideScannerbutton"
                      >
                        Scan
                      </button>
                      <input
                        class="form-control"
                        formControlName="PID"
                        [attr.disabled]="disbalePIDInput"
                        #search
                      />
                    </div>
                    <div class="form-group">
                      <label for="">Patient Name</label>
                      <span
                        style="color: red; font-size: 17px"
                        class="ng-star-inserted"
                      >
                        *</span
                      >
                      <input
                        class="form-control"
                        formControlName="name"
                        [ngClass]="{ 'is-invalid': submitted && f.name.errors }"
                      />
                      <div
                        *ngIf="submitted && f.name.errors"
                        class="invalid-feedback"
                      >
                        <div *ngIf="f.name.errors.required">
                          Please enter name
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-3">
                    <div>
                      <div
                        class="form-group"
                        [ngClass]="{
                          visiable: patientdetailsdata?.createdAt,
                          visiableNone: !patientdetailsdata?.createdAt
                        }"
                      >
                        <label for="">REG. Date</label>
                        <input
                          class="form-control"
                          disabled
                          [value]="
                            patientdetailsdata?.createdAt
                              | date: 'dd-MM-yyyy HH:mm'
                          "
                        />
                      </div>
                    </div>
                    <div class="form-group">
                      <label>Gender</label>
                      <span
                        style="color: red; font-size: 17px"
                        class="ng-star-inserted"
                      >
                        *</span
                      >
                      <select
                        class="form-control"
                        formControlName="gender"
                        [ngClass]="{
                          'is-invalid': submitted && f.gender.errors
                        }"
                        required
                      >
                        <option value="" disabled>Select Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                      </select>
                      <div
                        *ngIf="submitted && f.gender.errors"
                        class="invalid-feedback"
                      >
                        <div *ngIf="f.gender.errors.required">
                          :Please Select a Gender
                        </div>
                      </div>
                    </div>
                    <!-- <p *ngIf="patientdetailsdata?.createdAt">Date:{{patientdetailsdata?.createdAt | date:'dd-MM-yyyy'}}</p> -->
                  </div>
                  <div class="col-lg-3">
                    <div class="qr-code border-success">
                      <label style="margin-left: 30px">Bar Code</label>
                      <ngx-barcode
                        [bc-value]="value"
                        [bc-display-value]="true"
                      ></ngx-barcode>
                    </div>
                  </div>
                  <div class="col-lg-3">
                    <!-- <div class="qr-code border-success">
                                    <label class="d-block">QR Code</label>
                                    <ngx-qrcode    [elementType]="'svg'" 
                                    [value] = "value"
                                    cssClass = "aclass"
                                    [width]="120"
                                    errorCorrectionLevel = "L">
                                    </ngx-qrcode>
                                </div> -->
                    <div class="row">
                      <div class="col-md-6">
                        <div class="qr-code border-success">
                          <label>QR Code</label>
                          <!-- <qrcode 
                                            [qrdata]="barCodeValue" [width]="150"  [errorCorrectionLevel]="'M'" [elementType]="'svg'" *ngIf="barCodeValue"
                                            ></qrcode> -->
                          <qrcode
                            [qrdata]="value"
                            [width]="120"
                            [errorCorrectionLevel]="'M'"
                          >
                          </qrcode>
                          <!-- <ngx-qrcode [elementType]="'svg'" [value]="value" cssClass="aclass"
                                                    [width]="120" errorCorrectionLevel="L">
                                                </ngx-qrcode> -->
                        </div>
                      </div>
                      <div class="col-md-6">
                        <img
                          src="../../../assets/PreviaLogo.png"
                          class="img-responsive img-fluid"
                        />
                        <!-- <img [src]="sanitizer.bypassSecurityTrustUrl('/' + cardModel[r.content].value)" /> -->
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-3">
                    <div class="form-group">
                      <label>DOB</label>
                      <input
                        type="date"
                        class="form-control"
                        [(ngModel)]="dateValue"
                        formControlName="DOB"
                        [max]="getToday()"
                        (change)="onDateChange($event)"
                      />
                    </div>
                  </div>
                  <div class="col-lg-1">
                    <div class="form-group">
                      <label>Age</label>
                      <input
                        type="text"
                        class="form-control"
                        [(ngModel)]="age"
                        [ngModelOptions]="{ standalone: true }"
                        (input)="getDate($event)"
                      />
                    </div>
                  </div>

                  <div class="col-lg-2">
                    <div class="form-group">
                      <label>Mobile</label>
                      <input
                        type="text"
                        class="form-control"
                        formControlName="mobileNumber"
                        required
                        [ngClass]="{
                          'is-invalid': submitted && f.mobileNumber.errors
                        }"
                        max="10"
                        min="10"
                        required
                        pattern="^[0-9]\d{9}$"
                        (keypress)="checkIfNumber($event)"
                      />
                      <div
                        *ngIf="submitted && f.mobileNumber.errors"
                        class="invalid-feedback"
                        (input)="patientDynamicFormValidation()"
                        required
                      >
                        <div *ngIf="f.mobileNumber.errors.required">
                          MobileNumber must be a valid MobileNumber
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-2">
                    <div class="form-group">
                      <label>Email</label>
                      <input
                        type="text"
                        class="form-control"
                        formControlName="emailAddress"
                        [ngClass]="{
                          'is-invalid': submitted && f.emailAddress.errors
                        }"
                        (input)="patientDynamicFormValidation()"
                        required
                      />
                      <div
                        *ngIf="submitted && f.emailAddress.errors"
                        class="invalid-feedback"
                      >
                        <div *ngIf="f.emailAddress.errors.required">
                          Email must be a valid email address
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-2">
                    <div class="form-group">
                      <label>Proof Details</label>
                      <div class="">
                        <ng-select
                          formControlName="proofType"
                          (input)="patientDynamicFormValidation()"
                        >
                          <ng-option value="" disabled>Select Proof</ng-option>
                          <!-- <ng-option *ngFor="let item of proofDetails" value="{{item}}">{{item}}</ng-option> -->
                          <ng-option value="voter">Voter Id</ng-option>
                          <ng-option value="license">License</ng-option>
                          <ng-option value="others">Others</ng-option>
                        </ng-select>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-2 mt-4">
                    <input
                      type="text"
                      class="form-control"
                      placeholder="Enter Id No"
                      [ngClass]="{
                        'is-invalid': f.proofType.value && f.proofValue.errors
                      }"
                      formControlName="proofValue"
                      maxlength="16"
                    />

                    <div
                      *ngIf="f.proofValue.errors && f.proofType.value"
                      class="invalid-feedback"
                    >
                      <div *ngIf="f.proofValue.errors.required">
                        Please enter Id No
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-3">
                    <div class="form-group">
                      <label>Aadhar</label>
                      <input
                        class="form-control"
                        formControlName="aadhaar"
                        required
                        [ngClass]="{
                          'is-invalid': submitted && f.aadhaar.errors
                        }"
                        max="12"
                        min="12"
                        required
                        pattern="^[0-9]\d{9}$"
                        (keypress)="checkIfNumberAadhar($event)"
                        (input)="patientDynamicFormValidation()"
                      />
                      <div
                        *ngIf="submitted && f.aadhaar.errors"
                        class="invalid-feedback"
                      >
                        <div *ngIf="f.aadhaar.errors.required">
                          Please enter valid Aadhar
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg-3">
                    <div class="form-group">
                      <label>Passport</label>
                      <input
                        type="text"
                        class="form-control"
                        formControlName="passport"
                      />
                    </div>
                  </div>

                  <div class="col-lg-3">
                    <div class="form-group">
                      <label>Occupation</label>
                      <input
                        type="text"
                        class="form-control"
                        formControlName="occupation"
                      />
                    </div>
                  </div>
                  <div class="col-lg-3">
                    <div class="form-group">
                      <label>City</label>
                      <input
                        type="text"
                        class="form-control"
                        formControlName="city"
                      />
                    </div>
                  </div>
                  <div class="col-lg-3">
                    <div class="form-group">
                      <label>State</label>
                      <input
                        type="text"
                        class="form-control"
                        formControlName="state"
                      />
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div class="form-group">
                      <label>Address</label>
                      <textarea
                        type="text"
                        class="form-control"
                        formControlName="address"
                      ></textarea>
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div class="form-group">
                      <label>Habits</label>
                      <textarea
                        class="form-control"
                        formControlName="habits"
                      ></textarea>
                    </div>
                  </div>
                  <div class="col-lg-4">
                    <div class="form-group">
                      <label>LifeStyle</label>
                      <textarea
                        type="text"
                        class="form-control"
                        formControlName="lifeStyle"
                      ></textarea>
                    </div>
                  </div>
                  <!-- <div class="col-lg-2">
                                    <div class="form-group">
                                        <label class="mb-3">Default Test package</label>
                                        <mat-checkbox class="defaultCheckBox" (change)="selectDefaultTestPackages($event)"
                                            [checked]="isDefaultTestPackage">
                                            Default Test package</mat-checkbox>
                                    </div>
                                </div> -->
                </div>

                <div class="row mt-2" *ngIf="isSubDivisionPatient">
                  <div class="col-md-12 col-12">
                    <div class="form-group">
                      <!-- <label>Enter address</label> -->
                      <input
                        type="text"
                        class="form-control"
                        (keydown.enter)="$event.preventDefault()"
                        placeholder="Search Patient Address"
                        autocorrect="off"
                        autocapitalize="off"
                        spellcheck="off"
                        type="text"
                        formControlName="address"
                        #searchtext
                      />
                    </div>
                  </div>
                </div>

                <div class="position-relative" *ngIf="isSubDivisionPatient">
                  <agm-map
                    [latitude]="latitude"
                    [longitude]="longitude"
                    [zoom]="zoom"
                  >
                    <agm-marker
                      [latitude]="latitude"
                      [longitude]="longitude"
                      [markerDraggable]="true"
                      [iconUrl]="icon"
                      [iconUrl]=""
                      (dragEnd)="markerDragEnd($event)"
                    >
                    </agm-marker>
                  </agm-map>
                  <div class="currentlocation">
                    <div>
                      <button
                        class="btn current-btn"
                        (click)="CurrentAddress()"
                      >
                        <img src="assets/images/352557-128.png" />
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- <div class="card p-3 my-3" *ngIf="isSubDivisionPatient">
            <div class="progress-bar-icons">
              <ul>
                <li [ngClass]="{ active: patientaccshow === 'patient' }">
                  <span>Patient</span>
                  <p class="active"></p>
                </li>
                <li [ngClass]="{ active: testaccshow === 'test' }">
                  <span>Tests</span>
                  <p class="active"></p>
                </li>
                <li
                  [ngClass]="{ active: vaccineaccshow === 'vaccine' }"
                  *ngIf="patientdetailsdata?.isVaccineREG == true"
                >
                  <span>Vaccine</span>
                  <p class="active"></p>
                </li>
                <li [ngClass]="{ active: pastaccshow === 'past' }">
                  <span>Past Medic History</span>
                  <p class="active"></p>
                </li>
                <li [ngClass]="{ active: familyaccshow === 'family' }">
                  <span>Family History</span>
                  <p class="active"></p>
                </li>
                <li [ngClass]="{ active: doctorReviewshow === 'doctorReview' }">
                  <span>Doctor Review</span>
                  <p class="active"></p>
                </li>
                <li
                  [ngClass]="{ active: questionnaireshow === 'questionnaireView' }"
                  *ngIf="showQuestionnaireView"
                >
                  <span>Questionnaire</span>
                  <p class="active"></p>
                </li>
              </ul>
            </div>
          </div> -->
          <div class="card mt-3 bg-light">
            <div class="card-body">
              <div class="" *ngIf="isSubDivisionPatient">
                <mat-accordion class="example-headers-align mt-2" multi>
                  <mat-expansion-panel>
                    <mat-expansion-panel-header (click)="accordian('patient')">
                      <mat-panel-title> Patient </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div
                      class="table-responsive details"
                      formGroupName="details"
                    >
                      <table class="table table-bordered">
                        <thead>
                          <tr>
                            <th>Height(cms)</th>
                            <th>Weight(Kgs)</th>
                            <th>BMi</th>
                            <th>Blood Presure</th>
                            <th>Acuity Of Vision</th>
                            <th>Blood Group</th>
                            <th>Temperature (°F)</th>
                            <th>Comment</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td>
                              <input
                                type="text"
                                class="form-control"
                                formControlName="height"
                                placeholder="Value"
                              />
                            </td>
                            <td>
                              <input
                                type="text"
                                class="form-control"
                                formControlName="weight"
                                placeholder="Value"
                              />
                            </td>
                            <td>
                              <input
                                type="text"
                                class="form-control"
                                formControlName="BMI"
                                placeholder="Value"
                              />
                            </td>
                            <td>
                              <input
                                type="text"
                                class="form-control"
                                formControlName="BP"
                                placeholder="Value"
                              />
                            </td>
                            <td>
                              <input
                                type="text"
                                class="form-control"
                                formControlName="acuityOfVision"
                                placeholder="Value"
                              />
                            </td>
                            <td>
                              <input
                                type="text"
                                class="form-control"
                                formControlName="bloodGroup"
                                placeholder="Value"
                              />
                            </td>
                            <td>
                              <input
                                type="text"
                                class="form-control"
                                formControlName="temperature"
                                placeholder="Value"
                              />
                            </td>
                            <td>
                              <input
                                type="text"
                                class="form-control"
                                formControlName="comment"
                                placeholder="Value"
                              />
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <h3 *ngIf="patientdetailsdata?.details?.length > 0">
                      Patient General Test details
                    </h3>
                    <div
                      class="table-responsive example-container mat-elevation-z8"
                      *ngIf="patientdetailsdata?.details?.length > 0"
                    >
                      <table class="table">
                        <thead>
                          <th>Date</th>
                          <th>Height(cms)</th>
                          <th>Weight(Kgs)</th>
                          <th>BMi</th>
                          <th>Blood Presure</th>
                          <th>Acuity Of Vision</th>
                          <th>Blood Group</th>
                          <th>Temperature(°F)</th>
                          <th>comment</th>
                        </thead>
                        <tbody>
                          <tr
                            class="previousData"
                            *ngFor="let item of patientdetailsdata?.details"
                          >
                            <td>
                              {{ item.createdAt | date: "dd-MM-yyyy HH:mm" }}
                            </td>
                            <td>{{ item.height }}</td>
                            <td>{{ item.weight }}</td>
                            <td>{{ item.BMI }}</td>
                            <td>{{ item.BP }}</td>
                            <td>{{ item.acuityOfVision }}</td>
                            <td>{{ item.bloodGroup }}</td>
                            <td>{{ item.temperature }}</td>
                            <td>{{ item.comment }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
              </div>

              <div class="mt-3">
                <mat-accordion class="example-headers-align mt-2" multi>
                  <mat-expansion-panel>
                    <mat-expansion-panel-header (click)="accordian('test')">
                      <mat-panel-title> Test </mat-panel-title>
                    </mat-expansion-panel-header>

                    <div class="mt-2 mr-2 row" *ngIf="isSubDivisionPatient">
                      <mat-form-field
                        class="example-full-width searchTest col-md-3 col-lg-3 col-3"
                      >
                        <input
                          type="text"
                          class="input"
                          placeholder="Search Tests"
                          aria-label="Number"
                          matInput
                          [(ngModel)]="testControl"
                          [ngModelOptions]="{ standalone: true }"
                          (keyup)="getTests($event)"
                          [matAutocomplete]="auto1"
                        />
                        <mat-autocomplete
                          autoActiveFirstOption
                          #auto1="matAutocomplete"
                          (optionSelected)="
                            onChangeTestValue($event.option.value)
                          "
                        >
                          <mat-option
                            *ngFor="let option of tests"
                            [value]="option"
                          >
                            {{ option?.name }} <b>|</b> {{ option?.type }}
                            <b>|</b> {{ option?.price || 0 | currency: "INR" }}
                          </mat-option>
                        </mat-autocomplete>
                      </mat-form-field>
                      <h3 class="col-md-6 col-lg-6 col-6"></h3>
                      <h3
                        class="col-md-3 col-lg-3 col-3"
                        style="font-weight: bold"
                        *ngIf="totalAmount"
                      >
                        Total Amount: {{ totalAmount }}
                      </h3>
                      <!-- <h3 class="col-md-3 col-lg-3 col-3 "><input class="inputfield" type="number" *ngIf="totalAmount"
                          placeholder="Paid Amount" formControlName="paidAmount" (input)="changePadAmount()"></h3> -->
                      <!-- <h3 >Paid Amount: {{totalPaidAmount}}</h3> -->
                      <!-- <h3 class="col-md-3 col-lg-3 col-3" *ngIf="totalAmount">Balance To Be Paid: {{totalAmount -
                        totalPaidAmount}}</h3> -->
                    </div>
                    <mat-card
                      *ngIf="
                        patientRegistrationForm.value.patientTestsArray
                          ?.length > 0
                      "
                    >
                      <div class="table-responsive">
                        <table class="table table-bordered">
                          <thead>
                            <tr>
                              <th>S.No</th>
                              <th>Test Names</th>
                              <th>Price</th>
                              <!-- <th>Paid Amount</th> -->
                              <th>Instructions</th>
                              <th>Date</th>
                              <th>Time</th>
                              <th>Refer By</th>
                              <th>Referral Name</th>
                              <th>Action</th>
                            </tr>
                            <tr
                              formArrayName="patientTestsArray"
                              *ngFor="
                                let patientInfo of patientRegistrationForm.get(
                                  'patientTestsArray'
                                )['controls'];
                                let i = index
                              "
                            >
                              <td [formGroupName]="i">{{ i + 1 }}</td>
                              <td [formGroupName]="i">
                                {{ patientInfo.value.name }}
                                <p
                                  class="p-0 m-0"
                                  *ngIf="patientInfo?.value?.tests?.length > 0"
                                >
                                  (<span
                                    *ngFor="
                                      let test of patientInfo?.value.tests
                                    "
                                    >{{ test?.name }}, </span
                                  >)
                                </p>
                              </td>
                              <td [formGroupName]="i">
                                {{ patientInfo?.value?.price }}
                              </td>
                              <!-- <td [formGroupName]="i">
                                <input
                                  type="text"
                                  class="select_vaccine"
                                  formControlName="paidAmount"
                                  (input)="enterTestPaidAmount()"
                                />
                              </td> -->
                              <td [formGroupName]="i">
                                <input
                                  type="text"
                                  class="select_vaccine"
                                  formControlName="instructions"
                                />
                              </td>
                              <td [formGroupName]="i">
                                <input
                                  class="select_date date"
                                  type="date"
                                  [min]="minDate"
                                  formControlName="sampleDate"
                                  (change)="onTestDateChange($event)"
                                />
                              </td>
                              <td [formGroupName]="i">
                                <input
                                  placeholder="Select Time"
                                  class="select_time1"
                                  [ngxTimepicker]="range"
                                  formControlName="sampleTime"
                                  min="{{ timePickerMin }}"
                                  readonly
                                />
                                <ngx-material-timepicker
                                  #range
                                  (timeSet)="setTime($event)"
                                >
                                </ngx-material-timepicker>
                              </td>
                              <td [formGroupName]="i">
                                <select
                                  class="select_vaccine"
                                  (change)="selectReferRole($event)"
                                  formControlName="referredType"
                                >
                                  <option hidden value="" disabled selected>
                                    Select Refer By
                                  </option>
                                  <option
                                    value="{{ refer.name }}"
                                    *ngFor="let refer of referRoles"
                                  >
                                    {{ refer.displayName }}
                                  </option>
                                </select>
                              </td>
                              <td [formGroupName]="i">
                                <select
                                  class="select_vaccine"
                                  formControlName="referredBy"
                                >
                                  <option hidden value="" disabled selected>
                                    Select Referral Name
                                  </option>
                                  <option
                                    value="{{ referInfo?._id }}"
                                    *ngFor="let referInfo of referRoleList"
                                  >
                                    {{ referInfo?.name }}
                                  </option>
                                </select>
                              </td>
                              <td [formGroupName]="i">
                                <mat-icon
                                  class="deleteTests"
                                  class="delete_icon_color"
                                  (click)="
                                    deleteTestsFromSelectionList(patientInfo, i)
                                  "
                                  style="
                                    cursor: pointer;
                                    background-color: none;
                                  "
                                  >delete
                                </mat-icon>
                              </td>
                            </tr>
                          </thead>
                        </table>
                      </div>
                    </mat-card>
                    <br />
                    <h3 *ngIf="patientdetailsdata?.tests?.length > 0">
                      Previous Tests
                    </h3>
                    <div
                      class="table-responsive test_data_scrool example-container mat-elevation-z8"
                      *ngIf="
                        patientdetailsdata?.tests?.length > 0 &&
                        patientdetailsdata?.isReferralPatient == false
                      "
                    >
                      <div class="row m-0 mb-2 mt-2 p-0 border_info">
                        <div class="col-md-2 font-weight-bold">
                          Sample Reg Date
                        </div>
                        <div class="col-md-2 font-weight-bold">
                          Sample Rec Date
                        </div>
                        <div class="col-md-1 font-weight-bold">SID</div>
                        <div class="col-md-1 font-weight-bold">Test Name</div>
                        <div class="col-md-1 font-weight-bold p-0 m-0">
                          Value
                        </div>
                        <div class="col-md-1 font-weight-bold p-0 m-0">
                          Comment
                        </div>
                        <!-- <div class="col-md-2 font-weight-bold">
                          Technician Comment
                        </div> -->
                        <div class="col-md-1 font-weight-bold p-0 m-0">
                          Referred By
                        </div>
                        <div class="col-md-1 font-weight-bold">Status</div>
                        <div
                          class="col-md-1 font-weight-bold"
                          style="margin-left: 10px"
                        >
                          Action
                        </div>
                      </div>

                      <div
                        *ngFor="
                          let item of patientdetailsdata?.tests
                            | patientPreviousTests
                        "
                        class="row"
                      >
                        <div class="col-md-11">
                          <div
                            class="row m-0"
                            *ngFor="let bind of item?.packageTests"
                          >
                            <div class="col-md-2">
                              <!-- <p>{{item?.sampleDate}} {{item?.sampleTime}}</p> -->
                              <mat-form-field style="width: 150px">
                                <input
                                  matInput
                                  [(ngModel)]="date"
                                  [ngModelOptions]="{ standalone: true }"
                                  [ngxMatDatetimePicker]="picker"
                                  placeholder="Choose a date"
                                  [disabled]="disabled"
                                />
                                <mat-datepicker-toggle
                                  matSuffix
                                  [for]="picker"
                                ></mat-datepicker-toggle>
                                <ngx-mat-datetime-picker
                                  #picker
                                  format="hh:mm a"
                                  [showSpinners]="showSpinners"
                                  [showSeconds]="showSeconds"
                                  [stepHour]="stepHour"
                                  [stepMinute]="stepMinute"
                                  [stepSecond]="stepSecond"
                                >
                                </ngx-mat-datetime-picker>
                              </mat-form-field>
                              <!-- <p><input type="date"  class="select_date date"></p> -->
                            </div>
                            <div class="col-md-2">
                              <!-- <p><input type="date"  class="select_date date"></p> -->
                              <mat-form-field style="width: 150px">
                                <input
                                  matInput
                                  [ngxMatDatetimePicker]="picker"
                                  placeholder="Choose a date"
                                  [disabled]="disabled"
                                />
                                <mat-datepicker-toggle
                                  matSuffix
                                  [for]="picker"
                                ></mat-datepicker-toggle>
                                <ngx-mat-datetime-picker
                                  #picker
                                  [format]="12"
                                  [showSpinners]="showSpinners"
                                  [showSeconds]="showSeconds"
                                  [stepHour]="stepHour"
                                  [stepMinute]="stepMinute"
                                  [stepSecond]="stepSecond"
                                >
                                </ngx-mat-datetime-picker>
                              </mat-form-field>
                            </div>
                            <div class="col-md-1">
                              <p>{{ item?.sid }}</p>
                            </div>
                            <div class="col-md-1 p-1 m-0">
                              <div>{{ bind?.testName }}</div>
                            </div>
                            <div class="col-md-1 text-center p-0 m-0">
                              {{ bind?.value }}
                            </div>
                            <div class="col-md-1 p-1 m-0">
                              {{ bind?.comment }}
                            </div>
                            <!-- <div class="col-md-1 p-1 m-0">
                              {{ bind?.technicianComments }}
                            </div> -->
                            <div class="col-md-2 p-1 m-0 text-center">
                              {{
                                bind?.labReferred
                                  ? bind?.labReferred?.name
                                  : bind?.referred?.name
                              }}
                              -
                              {{
                                bind?.labReferred
                                  ? bind?.referredType
                                  : bind?.referredType
                              }}
                            </div>
                            <div class="col-md-1 p-1 m-0">
                              {{ bind?.status }}
                            </div>
                          </div>
                          <div class="row m-0" *ngIf="item?.packageTests == 0">
                            <div class="col-md-2">
                              <!-- <p>{{item?.sampleDate}} {{item?.sampleTime}}</p> -->
                              <!-- <p><input type="date"  class="select_date date"></p> -->
                              <mat-form-field style="width: 150px">
                                <input
                                  [(ngModel)]="date"
                                  [ngModelOptions]="{ standalone: true }"
                                  matInput
                                  [ngxMatDatetimePicker]="picker"
                                  placeholder="Choose a date"
                                  [disabled]="disabled"
                                />
                                <mat-datepicker-toggle
                                  matSuffix
                                  [for]="picker"
                                ></mat-datepicker-toggle>
                                <ngx-mat-datetime-picker
                                  #picker
                                  [format]="12"
                                  [showSpinners]="showSpinners"
                                  [showSeconds]="showSeconds"
                                  [stepHour]="stepHour"
                                  [stepMinute]="stepMinute"
                                  [stepSecond]="stepSecond"
                                >
                                </ngx-mat-datetime-picker>
                              </mat-form-field>
                            </div>
                            <div class="col-md-2">
                              <!-- <p><input type="date" class="select_date date"></p> -->
                              <mat-form-field style="width: 150px">
                                <input
                                  matInput
                                  [ngxMatDatetimePicker]="picker"
                                  placeholder="Choose a date"
                                  [disabled]="disabled"
                                />
                                <mat-datepicker-toggle
                                  matSuffix
                                  [for]="picker"
                                ></mat-datepicker-toggle>
                                <ngx-mat-datetime-picker
                                  #picker
                                  [format]="12"
                                  [showSpinners]="showSpinners"
                                  [showSeconds]="showSeconds"
                                  [stepHour]="stepHour"
                                  [stepMinute]="stepMinute"
                                  [stepSecond]="stepSecond"
                                >
                                </ngx-mat-datetime-picker>
                              </mat-form-field>
                            </div>
                            <div class="col-md-1">
                              <p>{{ item?.sid }}</p>
                            </div>
                            <div class="col-md-1 p-1 m-0">
                              {{ item.test?.name }}
                            </div>
                            <div class="col-md-1 text-center p-0 m-0">
                              {{ item?.value }}
                            </div>
                            <div class="col-md-1 p-1 m-0">
                              {{ item?.comment }}
                            </div>
                            <!-- <div class="col-md-1 p-1 m-0">
                              {{ item?.technicianComments }}
                            </div> -->
                            <div class="col-md-2 p-1 m-0 text-center">
                              {{
                                item?.labReferred
                                  ? item?.labReferred?.name
                                  : item?.referred?.name
                              }}
                              - {{ item?.referredType }}
                              <!-- {{ item?.labReferred ?
                                                        item?.referredType : item?.referredType }} -->
                            </div>
                            <div class="col-md-1 p-1 m-0">
                              {{ item?.status }}
                            </div>
                          </div>
                          <hr class="m-2" />
                        </div>

                        <div class="col-md-1 border-bottom">
                          <span class="d-flex">
                            <button
                              class="deleteTests1"
                              [class.buttonColorDisabled]="
                                item?.status == 'completed'
                              "
                              [disabled]="item?.status == 'completed'"
                              *ngIf="isSubDivisionPatient"
                              (click)="
                                cancelTestsFromSelectionList(
                                  openTestsModal,
                                  item
                                )
                              "
                            >
                              cancel
                            </button>
                            &nbsp;
                            <button
                              [class.buttonColorDisabled]="
                                item?.status != 'completed'
                              "
                              class="download-rpt"
                              type="button"
                              [disabled]="item?.status != 'completed'"
                              (click)="
                                openDownloadReportModel(
                                  downloadTestReport,
                                  item
                                )
                              "
                            >
                              Download Report
                            </button>
                          </span>
                        </div>
                      </div>
                    </div>
                    <div *ngIf="patientdetailsdata?.isReferralPatient == true">
                      <div class="table-responsive">
                        <table class="table table-hover w-100">
                          <thead class="text-center">
                            <tr>
                              <th>S.No</th>
                              <th>Test Name</th>
                              <th>Test Info</th>
                              <th>Status</th>
                              <th>Actions</th>
                            </tr>
                          </thead>
                          <tbody class="text-center">
                            <tr
                              *ngFor="
                                let data of patientdetailsdata
                                  ?.organizationPatientInfo?.description
                                  ?.sidResultDetails;
                                let i = index
                              "
                            >
                              <td>{{ i + 1 }}</td>
                              <td>{{ data?.testName }}</td>
                              <td>
                                <button
                                  [disabled]="data?.reportStatusCode == 'PR'"
                                  mat-raised-button
                                  class="mat-primary1"
                                  (click)="
                                    openTestObjInfoModel(testObjInfo, data)
                                  "
                                >
                                  View
                                </button>
                              </td>
                              <td>
                                {{
                                  patientdetailsdata?.organizationPatientInfo
                                    ?.description?.reportStatusCode == null
                                    ? "AwaitingSample"
                                    : patientdetailsdata
                                        ?.organizationPatientInfo?.description
                                        ?.reportStatusCode == "PE"
                                    ? "Pending"
                                    : patientdetailsdata
                                        ?.organizationPatientInfo?.description
                                        ?.reportStatusCode == "CO"
                                    ? "Completed"
                                    : patientdetailsdata
                                        ?.organizationPatientInfo?.description
                                        ?.reportStatusCode == "AU"
                                    ? "Authorized"
                                    : patientdetailsdata
                                        ?.organizationPatientInfo?.description
                                        ?.reportStatusCode == "PR"
                                    ? "Printed"
                                    : "Dispatched"
                                }}
                              </td>
                              <td>
                                <button
                                  mat-raised-button
                                  class="mat-primary1"
                                  (click)="
                                    openDownloadReportModel(
                                      downloadTestReport,
                                      data
                                    )
                                  "
                                >
                                  DownloadReport
                                </button>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
              </div>
              <div
                class="mt-3"
                *ngIf="patientdetailsdata?.isVaccineREG == true"
              >
                <mat-accordion class="example-headers-align mt-2" multi>
                  <mat-expansion-panel>
                    <mat-expansion-panel-header (click)="accordian('vaccine')">
                      <mat-panel-title> Vaccine </mat-panel-title>
                    </mat-expansion-panel-header>

                    <div>
                      <form [formGroup]="vaccineForm">
                        <div class="table-responsive">
                          <table class="table table-bordered">
                            <thead>
                              <tr class="text-center">
                                <th class="date-heading-table">Date</th>

                                <th class="">Vaccine Name</th>
                                <th class="">Dose</th>
                                <th class="">Status</th>
                                <th>Vaccine Quantity</th>
                                <th class="">Technician</th>

                                <th>Action</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr class="text-center">
                                <td>
                                  <div class="form-group mb-0">
                                    <input
                                      type="date"
                                      class="mb-0"
                                      formControlName="vaccinatedDate"
                                      class="select_vaccine-date"
                                      [ngClass]="{
                                        'is-invalid':
                                          submitted && l.vaccinatedDate.errors
                                      }"
                                      required
                                    />
                                    <div
                                      *ngIf="
                                        submitted && l.vaccinatedDate.errors
                                      "
                                      class="invalid-feedback"
                                    >
                                      <div
                                        *ngIf="l.vaccinatedDate.errors.required"
                                      >
                                        Date is required
                                      </div>
                                    </div>
                                  </div>
                                </td>

                                <td>
                                  <select
                                    class="select_vaccine"
                                    formControlName="vaccineName"
                                  >
                                    <option hidden value="" disabled selected>
                                      Select Vaccine
                                    </option>
                                    <option value="covishield">
                                      Covishield
                                    </option>
                                    <option value="covaxin">Covaxin</option>
                                  </select>
                                </td>
                                <td>
                                  <input
                                    type="text"
                                    placeholder=""
                                    formControlName="vaccinationDose"
                                    readonly
                                    class="vaccine_dose"
                                  />
                                </td>
                                <td>
                                  <input
                                    type="text"
                                    placeholder=""
                                    formControlName="vaccinationStatus"
                                    readonly
                                    class="vaccine_status"
                                  />
                                </td>

                                <td>
                                  <input
                                    type="text"
                                    placeholder=""
                                    formControlName="noOfPersons"
                                    readonly
                                    class="vaccine_dose"
                                  />
                                </td>

                                <td>
                                  <div class="form-group mb-0">
                                    <select
                                      class=""
                                      formControlName="technician_id"
                                      class="select_vaccine"
                                      [ngClass]="{
                                        'is-invalid':
                                          submitted && l.technician_id.errors
                                      }"
                                      required
                                    >
                                      <option value="" disabled selected>
                                        Select Technician
                                      </option>
                                      <option
                                        *ngFor="let item of technicianListData"
                                        value="{{ item?._id }}"
                                      >
                                        {{ item.name }}
                                      </option>
                                    </select>
                                    <div
                                      *ngIf="
                                        submitted && l.technician_id.errors
                                      "
                                      class="invalid-feedback"
                                    >
                                      <div
                                        *ngIf="l.technician_id.errors.required"
                                      >
                                        Technician is required
                                      </div>
                                    </div>
                                  </div>
                                </td>

                                <td>
                                  <button
                                    class="button-select"
                                    (click)="openVaccine()"
                                  >
                                    Assign
                                  </button>
                                </td>

                                <!-- <td>
                                                                <button class="button-select"
                                                                    (click)="openVaccine()">{{vaccineForm.value?.technician_id
                                                                    ?
                                                                    "Modify" : "Assign" }}</button>
                                                            </td> -->
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </form>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
              </div>

              <div class="mt-3" *ngIf="isSubDivisionPatient">
                <mat-accordion class="example-headers-align mt-2" multi>
                  <mat-expansion-panel>
                    <mat-expansion-panel-header (click)="accordian('past')">
                      <mat-panel-title> Past Medic History </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="addRow text-right">
                      <button (click)="addmedicalHistoryItem()">Add row</button>
                      <!-- <mat-icon (click)="addmedicalHistoryItem()">add</mat-icon> -->
                    </div>
                    <div class="table-responsive">
                      <table class="table table-bordered">
                        <thead>
                          <tr>
                            <th>Medicine Name</th>
                            <th>Frequency</th>
                            <th>Number of Days</th>
                            <th>Comment</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr
                            formArrayName="medicalHistory"
                            *ngFor="
                              let item of patientRegistrationForm.get(
                                'medicalHistory'
                              )['controls'];
                              let i = index
                            "
                          >
                            <td [formGroupName]="i">
                              <input
                                type="text"
                                class="form-control"
                                formControlName="medicine"
                              />
                            </td>
                            <td [formGroupName]="i">
                              <input
                                type="number"
                                class="form-control"
                                formControlName="frequency"
                              />
                            </td>
                            <td [formGroupName]="i">
                              <input
                                type="number"
                                class="form-control"
                                formControlName="noOfDays"
                              />
                            </td>
                            <td [formGroupName]="i">
                              <input
                                type="text"
                                class="form-control"
                                formControlName="comment"
                              />
                            </td>
                            <td [formGroupName]="i">
                              <mat-icon
                                class="delete_icon_color"
                                (click)="removePatientmedicalHistory(i)"
                                >delete
                              </mat-icon>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <!-- <div formArrayName="medicalHistory"
                                        *ngFor="let item of patientRegistrationForm.get('medicalHistory')['controls'];  let i = index;">
                                        <div [formGroupName]="i">
                                            <div class="row">
                                                <div class="col-lg-3">
                                                    <div class="form-group">
                                                        <label>Medicine Name</label>
                                                        <input type="text" class="form-control" formControlName="medicine">
                                                    </div>
                                                </div>
                                                <div class="col-lg-3">
                                                    <div class="form-group">
                                                        <label>frequency</label>
                                                        <input type="text" class="form-control" formControlName="frequency">
                                                    </div>
                                                </div>
                                                <div class="col-lg-2">
                                                    <div class="form-group">
                                                        <label for="">number of days</label>
                                                        <input type="text" class="form-control" formControlName="noOfDays">
                                                    </div>
                                                </div>
                                                <div class="col-lg-3">
                                                    <div class="form-group">
                                                        <label>Comment</label>
                                                        <textarea type="text" class="form-control"
                                                            formControlName="comment"></textarea>
    
                                                    </div>
                                                </div>
                                                <div class="col-lg-1 mt-5" *ngIf="i>0">
                                                    <div  class="text-center removeIcon">
                                                        <span (click)="removePatientmedicalHistory(i)">&times;</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div> -->
                    <h3 *ngIf="patientdetailsdata?.medicalHistory?.length > 0">
                      Medical History details
                    </h3>
                    <div
                      class="table-responsive example-container mat-elevation-z8"
                      *ngIf="patientdetailsdata?.medicalHistory?.length > 0"
                    >
                      <table class="table">
                        <thead>
                          <th>Date</th>
                          <th>Medicine</th>
                          <th>Frequency</th>
                          <th>noOfDays</th>
                          <th>comment</th>
                        </thead>
                        <tbody>
                          <tr
                            *ngFor="
                              let item of patientdetailsdata?.medicalHistory
                            "
                          >
                            <td>
                              {{ item.createdAt | date: "dd-MM-yyyy HH:mm" }}
                            </td>
                            <td>{{ item.medicine }}</td>
                            <td>{{ item.frequency }}</td>
                            <td>{{ item.noOfDays }}</td>
                            <td>{{ item.comment }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
              </div>
              <div class="mt-3" *ngIf="isSubDivisionPatient">
                <mat-accordion class="example-headers-align mt-2" multi>
                  <mat-expansion-panel>
                    <mat-expansion-panel-header (click)="accordian('family')">
                      <mat-panel-title> Family History </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="addRow text-right">
                      <button (click)="addfamilyHistoryItem()">Add row</button>
                      <!-- <mat-icon (click)="addmedicalHistoryItem()">add</mat-icon> -->
                    </div>
                    <div class="table-responsive">
                      <table class="table table-bordered">
                        <thead>
                          <tr>
                            <th>Disease</th>
                            <th>Relation With Patient</th>
                            <th>From Years</th>
                            <th>Comment</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr
                            formArrayName="familyHistory"
                            *ngFor="
                              let item of patientRegistrationForm.get(
                                'familyHistory'
                              )['controls'];
                              let i = index
                            "
                          >
                            <td [formGroupName]="i">
                              <input
                                type="text"
                                class="form-control"
                                formControlName="decease"
                              />
                            </td>
                            <td [formGroupName]="i">
                              <input
                                type="text"
                                class="form-control"
                                formControlName="relation"
                              />
                            </td>
                            <td [formGroupName]="i">
                              <input
                                type="number"
                                class="form-control"
                                formControlName="fromYears"
                              />
                            </td>
                            <td [formGroupName]="i">
                              <input
                                type="text"
                                class="form-control"
                                formControlName="comment"
                              />
                            </td>
                            <td [formGroupName]="i">
                              <mat-icon
                                class="delete_icon_color"
                                (click)="removePatientfamilyHistory(i)"
                                >delete
                              </mat-icon>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <!-- <div class="addRow text-right">
                                        <mat-icon (click)="addfamilyHistoryItem()">add</mat-icon>
                                    </div>
                                    <div formArrayName="familyHistory"
                                        *ngFor="let item of patientRegistrationForm.get('familyHistory')['controls'];  let i = index;">
                                        <div [formGroupName]="i">
                                            <div class="row">
                                                <div class="col-lg-3">
                                                    <div class="form-group">
                                                        <label>Decease</label>
                                                        <input type="text" class="form-control" formControlName="decease">
                                                    </div>
                                                </div>
                                                <div class="col-lg-3">
                                                    <div class="form-group">
                                                        <label>Relation With Patient</label>
                                                        <input type="text" class="form-control" formControlName="relation">
                                                    </div>
                                                </div>
                                                <div class="col-lg-2">
                                                    <div class="form-group">
                                                        <label for="">From Years</label>
                                                        <input type="text" class="form-control" formControlName="fromYears">
                                                    </div>
                                                </div>
                                                <div class="col-lg-3">
                                                    <div class="form-group">
                                                        <label>Comment</label>
                                                        <textarea type="text" class="form-control"
                                                            formControlName="comment"></textarea>
                                                    </div>
                                                </div>
                                                <div class="col-lg-1 mt-5" *ngIf="i>0">
                                                    <div  class="text-center removeIcon">
                                                        <span (click)="removePatientfamilyHistory(i)">&times;</span>
                                                    </div>
                                                </div>
    
                                            </div>
                                        </div>
                                    </div> -->
                    <h3 *ngIf="patientdetailsdata?.familyHistory?.length > 0">
                      Family History details
                    </h3>
                    <div
                      class="table-responsive example-container mat-elevation-z8"
                      *ngIf="patientdetailsdata?.familyHistory?.length > 0"
                    >
                      <table class="table">
                        <thead>
                          <th>Date</th>
                          <th>Disease</th>
                          <th>Relation</th>
                          <th>FromYears</th>
                          <th>comment</th>
                        </thead>
                        <tbody>
                          <tr
                            *ngFor="
                              let item of patientdetailsdata?.familyHistory
                            "
                          >
                            <td>
                              {{ item.createdAt | date: "dd-MM-yyyy HH:mm" }}
                            </td>
                            <td>{{ item.decease }}</td>
                            <td>{{ item.relation }}</td>
                            <td>{{ item.fromYears }}</td>
                            <td>{{ item.comment }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
              </div>
              <div class="mt-3" *ngIf="isSubDivisionPatient">
                <mat-accordion class="example-headers-align mt-2" multi>
                  <mat-expansion-panel>
                    <mat-expansion-panel-header
                      (click)="accordian('doctorReview')"
                    >
                      <mat-panel-title> Doctor Review </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="addRow text-right">
                      <button (click)="addDoctorReviewItem()">Add row</button>
                      <!-- <mat-icon (click)="addmedicalHistoryItem()">add</mat-icon> -->
                    </div>
                    <div class="table-responsive">
                      <table class="table table-bordered">
                        <thead>
                          <tr>
                            <th>Review</th>
                            <th>Action</th>
                          </tr>
                        </thead>
                        <tbody>
                          <tr
                            formArrayName="doctorReview"
                            *ngFor="
                              let item of patientRegistrationForm.get(
                                'doctorReview'
                              )['controls'];
                              let i = index
                            "
                          >
                            <td [formGroupName]="i">
                              <textarea
                                type="text"
                                class="form-control"
                                formControlName="review"
                                placeholder="Review"
                              ></textarea>
                            </td>
                            <td [formGroupName]="i">
                              <mat-icon (click)="removePatientdoctorReview(i)"
                                >delete</mat-icon
                              >
                            </td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                    <!-- <div class="addRow text-right">
                                        <mat-icon (click)="addDoctorReviewItem()">add</mat-icon>
                                    </div>
                                    <div formArrayName="doctorReview"
                                        *ngFor="let item of patientRegistrationForm.get('doctorReview')['controls'];  let i = index;">
                                        <div [formGroupName]="i">
                                            <div class="row">
                                                <div class="col-lg-11">
                                                    <div class="form-group">
                                                        <label>Review</label>
                                                        <textarea type="text" class="form-control" formControlName="review"
                                                            placeholder="Review"></textarea>
                                                    </div>
                                                    
                                                </div>
                                                <div class="col-lg-1 mt-5" *ngIf="i>0">
                                                    <div  class="text-center removeIcon">
                                                        <span (click)="removePatientdoctorReview(i)">&times;</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div> -->
                    <h3 *ngIf="patientdetailsdata?.doctorReviews?.length > 0">
                      Previous Reviews
                    </h3>
                    <div
                      class="table-responsive example-container mat-elevation-z8"
                      *ngIf="patientdetailsdata?.doctorReviews?.length > 0"
                    >
                      <table class="table">
                        <thead>
                          <th>Date</th>
                          <th>Review</th>
                        </thead>
                        <tbody>
                          <tr
                            *ngFor="
                              let item of patientdetailsdata?.doctorReviews
                            "
                          >
                            <td>
                              {{ item.createdAt | date: "dd-MM-yyyy HH:mm" }}
                            </td>
                            <td>{{ item.review }}</td>
                          </tr>
                        </tbody>
                      </table>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
              </div>
              <div
                class="mt-3"
                *ngIf="showQuestionnaireView && isSubDivisionPatient"
              >
                <mat-accordion class="example-headers-align mt-2" multi>
                  <mat-expansion-panel>
                    <mat-expansion-panel-header
                      (click)="accordian('questionnaireView')"
                    >
                      <mat-panel-title> Questionnaire Review </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="card bg-light">
                      <div class="card-body">
                        <mat-card class="mt-3 questionnaire">
                          <h4>Questionnaire</h4>
                          <table class="table table-bordered m-0 text-center">
                            <tr>
                              <th class="sno">S.No</th>
                              <th class="question">Question</th>
                              <th class="answer">Answer</th>
                              <th>Code</th>
                            </tr>
                          </table>
                          <div *ngFor="let grp of questionForm.controls">
                            <form [formGroup]="grp" class="questForm">
                              <table
                                class="table table-bordered m-0 text-center"
                              >
                                <td class="sec">{{ grp.value.name }}</td>
                              </table>
                              <!-- <label > </label> -->
                              <div
                                formArrayName="questions"
                                *ngFor="
                                  let item of grp?.get('questions')['controls'];
                                  let i = index
                                "
                              >
                                <table
                                  [formGroup]="item"
                                  class="table table-bordered m-0"
                                >
                                  <tr>
                                    <td class="sno">{{ i + 1 }}</td>
                                    <td class="question">
                                      {{ item?.value?.question }}
                                    </td>
                                    <td class="answer">
                                      <div *ngIf="item.value.type == 'options'">
                                        <mat-radio-group
                                          aria-label="Select an option"
                                          class="checkbox"
                                          formControlName="answer"
                                        >
                                          <mat-radio-button
                                            [disabled]="true"
                                            class="col-lg-12 optionText"
                                            *ngFor="
                                              let answers of item.value
                                                ?.possibleAnswers
                                            "
                                            [value]="answers"
                                            >{{ answers }}
                                          </mat-radio-button>
                                          <!-- <mat-radio-button value="no">No</mat-radio-button> -->
                                        </mat-radio-group>
                                      </div>
                                      <div
                                        *ngIf="item.value.type == 'checkbox'"
                                      >
                                        <!-- <label formArrayName="answer" *ngFor="let order of item.get('answer')['controls']; let i = index">
                                                                            <input type="checkbox" [formControlName]="i">
                                                                            {{item.value.possibleAnswers[i]}}
                                                                          </label> -->
                                        <section
                                          class="example-section checkbox"
                                          formArrayName="answer"
                                          *ngFor="
                                            let order of item.get('answer')[
                                              'controls'
                                            ];
                                            let i = index
                                          "
                                        >
                                          <mat-checkbox
                                            class="example-margin"
                                            [disabled]="true"
                                            [formControlName]="i"
                                            class="col-lg-12 optionText"
                                            [value]="
                                              item.value.possibleAnswers[i]
                                            "
                                          >
                                            {{ item.value.possibleAnswers[i] }}
                                          </mat-checkbox>
                                        </section>
                                      </div>
                                      <div
                                        class="input-with-measure"
                                        *ngIf="
                                          item.value.type == 'input' ||
                                          item.value.type == 'paragraph' ||
                                          item.value.type == 'textArea' ||
                                          item.value.type == 'numeric'
                                        "
                                      >
                                        <input
                                          class="form-control"
                                          formControlName="answer"
                                          readonly
                                        /><span>{{ item.value.units }}</span>
                                      </div>
                                      <div *ngIf="item.value.type == 'date'">
                                        <input
                                          class="form-control"
                                          type="date"
                                          formControlName="answer"
                                          readonly
                                        />
                                      </div>
                                      <div *ngIf="item.value.type == 'radio'">
                                        <mat-radio-group
                                          aria-label="Select an option"
                                          formControlName="answer"
                                        >
                                          <mat-radio-button
                                            value="yes"
                                            [disabled]="true"
                                            >Yes
                                          </mat-radio-button>
                                          <mat-radio-button
                                            value="no"
                                            [disabled]="true"
                                            >No
                                          </mat-radio-button>
                                        </mat-radio-group>
                                      </div>
                                    </td>
                                    <td>{{ item.value.code }}</td>
                                  </tr>

                                  <tr
                                    formArrayName="subquestions"
                                    *ngFor="
                                      let sub of item.get('subquestions')[
                                        'controls'
                                      ];
                                      let j = index
                                    "
                                  >
                                    <!-- < > -->
                                    <td [formGroupName]="j" class="sno">
                                      {{ i + 1 }}.{{ j + 1 }}
                                    </td>
                                    <td [formGroupName]="j" class="question">
                                      {{ sub.value.question }}
                                    </td>
                                    <td [formGroupName]="j" class="answer">
                                      <div *ngIf="sub.value.type == 'options'">
                                        <mat-radio-group
                                          aria-label="Select an option"
                                          class="checkbox"
                                          formControlName="answer"
                                        >
                                          <mat-radio-button
                                            [disabled]="true"
                                            class="col-lg-12 optionText"
                                            *ngFor="
                                              let answers of sub.value
                                                ?.possibleAnswers
                                            "
                                            [value]="answers"
                                            >{{ answers }}
                                          </mat-radio-button>
                                          <!-- <mat-radio-button value="no">No</mat-radio-button> -->
                                        </mat-radio-group>
                                      </div>
                                      <div *ngIf="sub.value.type == 'checkbox'">
                                        <!-- <label formArrayName="answer" *ngFor="let order of item.get('answer')['controls']; let i = index">
                                                                                   <input type="checkbox" [formControlName]="i">
                                                                                   {{item.value.possibleAnswers[i]}}
                                                                                 </label> -->
                                        <section
                                          class="example-section checkbox"
                                          formArrayName="answer"
                                          *ngFor="
                                            let order of sub.get('answer')[
                                              'controls'
                                            ];
                                            let i = index
                                          "
                                        >
                                          <mat-checkbox
                                            class="example-margin"
                                            [disabled]="true"
                                            [formControlName]="i"
                                            class="col-lg-12 optionText"
                                            [value]="
                                              sub.value.possibleAnswers[i]
                                            "
                                          >
                                            {{ sub.value.possibleAnswers[i] }}
                                          </mat-checkbox>
                                        </section>
                                      </div>
                                      <div
                                        *ngIf="
                                          sub.value.type == 'input' ||
                                          sub.value.type == 'paragraph' ||
                                          sub.value.type == 'textArea' ||
                                          sub.value.type == 'numeric'
                                        "
                                      >
                                        <input
                                          class="form-control"
                                          formControlName="answer"
                                          readonly
                                        />{{ sub.value?.units }}
                                      </div>
                                      <div *ngIf="sub.value.type == 'date'">
                                        <input
                                          class="form-control"
                                          type="date"
                                          formControlName="answer"
                                          readonly
                                        />
                                      </div>
                                      <div *ngIf="sub.value.type == 'radio'">
                                        <mat-radio-group
                                          aria-label="Select an option"
                                          formControlName="answer"
                                        >
                                          <mat-radio-button
                                            value="yes"
                                            [disabled]="true"
                                            >Yes
                                          </mat-radio-button>
                                          <mat-radio-button
                                            value="no"
                                            [disabled]="true"
                                            >No
                                          </mat-radio-button>
                                        </mat-radio-group>
                                      </div>
                                    </td>
                                    <td [formGroupName]="j">
                                      {{ sub.value.code }}
                                    </td>
                                  </tr>
                                </table>
                              </div>
                            </form>
                          </div>
                        </mat-card>
                      </div>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
              </div>
              <div class="mt-3">
                <mat-accordion class="example-headers-align mt-2" multi>
                  <mat-expansion-panel>
                    <mat-expansion-panel-header (click)="accordian('billing')">
                      <mat-panel-title> Billing </mat-panel-title>
                    </mat-expansion-panel-header>
                    <div class="row">
                      <!-- <div class="col-md-6">
                        <input type="search" placeholder="Search By Name" class="select_vaccine">
                        <table style="height: 100px;" class="table table-bordered m-0 text-center  mt-3">
                          <thead>
                            <tr>
                              <th>S.No</th>
                              <th>Test/Profile</th>
                              <th>Reporting Date</th>
                              <th>Amount</th>
                              <th>Discount</th>
                              <th>Action</th>
                            </tr>
                          </thead>
                          <tbody>
    
                            <tr *ngFor="
                            let item of patientdetailsdata?.tests
                              | patientPreviousTests;let i=index
                          ">
                              <td>{{i+1}}</td>
                              <td>{{ item?.test?.testMaster?.name }}</td>
                              <td>{{item?.sampleDate}}</td>
                              <td>{{item?.test?.price | number : '1.2-2'}}</td>
                              <td></td>
                              <td>
                                <mat-icon class="delete_icon_color">delete</mat-icon>
                              </td>
    
                            </tr>
    
                          </tbody>
                        </table>
                      </div> -->
                      <div class="col-md-12">
                        <!-- <input type="search" placeholder="Search By Name" class="select_vaccine"> -->
                        <table
                          style="height: 100px"
                          class="table table-bordered m-0 text-center mt-3"
                        >
                          <thead>
                            <tr>
                              <th>Select</th>
                              <th>S.No</th>
                              <th>Invoice ID</th>
                              <th>Invoice Date</th>
                              <th>Bill Amount</th>
                              <th>Other Charges</th>
                              <th>Total Amount</th>
                              <th>Paid Amount</th>
                              <th>Due Amount</th>
                              <th>Transactions</th>
                            </tr>
                          </thead>
                          <tbody>
                            <tr
                              *ngFor="let item of transactions; let i = index"
                            >
                              <td>
                                <span *ngIf="item.dueAmount == 0">Paid</span>
                                <mat-radio-button
                                  *ngIf="item.dueAmount > 0"
                                  (change)="selectedInvoice(item)"
                                  class="example-radio-button"
                                  name="payment"
                                >
                                </mat-radio-button>
                              </td>
                              <td>{{ i + 1 }}</td>
                              <td>{{ item?.invoiceId }}</td>
                              <td>{{ item?.invoiceDate }}</td>
                              <td>
                                {{
                                  item?.billAmount ||
                                    item?.totalAmount -
                                      (item?.otherCharges || 0)
                                    | currency: "INR"
                                }}
                              </td>
                              <td>
                                {{ item?.otherCharges || 0 | currency: "INR" }}
                              </td>
                              <td>{{ item?.totalAmount | currency: "INR" }}</td>
                              <td>
                                {{
                                  item?.totalAmount - item?.dueAmount
                                    | currency: "INR"
                                }}
                              </td>
                              <td>{{ item.dueAmount | currency: "INR" }}</td>
                              <td>
                                <i
                                  class="fa fa-eye"
                                  *ngIf="item && item.transactions.length > 0"
                                  (click)="
                                    openTransactionLog(
                                      transationLogModal,
                                      item.transactions
                                    )
                                  "
                                ></i>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                      </div>
                      <div
                        class="col-md-12"
                        *ngIf="
                          patientpaymentObj && patientpaymentObj.totalAmount
                        "
                      >
                        <div class="card" style="margin-top: 20px">
                          <div class="row">
                            <div class="col-md-12">
                              <mat-radio-group
                                aria-label="Select an option"
                                class="example-radio-group"
                                [(ngModel)]="selectedPayment"
                                [ngModelOptions]="{ standalone: true }"
                              >
                                <mat-radio-button
                                  class="example-radio-button"
                                  [value]="item"
                                  *ngFor="let item of paymentTypes"
                                  (change)="paymentChange($event)"
                                  >{{ item }}
                                </mat-radio-button>
                                <mat-radio-button
                                  class="example-radio-button"
                                  (click)="openInvoiceModel(sendPaymentLink)"
                                >
                                  Payment Link</mat-radio-button
                                >
                              </mat-radio-group>
                            </div>
                          </div>
                          <!-- <div class="col-md-6 mt-3"> -->
                          <!-- <div class="row"> -->
                          <!-- <div *ngIf="selectedPayment == 'Cash'">
                                <table>
                                  <tr>
                                    <td> <label for="amount">Amount:</label>
                                    </td>
                                    <td><input name="amount" id="amount" type="number" /></td>
                                  </tr>
                                </table>
                               </div> -->
                          <!-- <div class="row"> -->
                          <div *ngIf="selectedPayment == 'Card'">
                            <table>
                              <tr>
                                <td><label for="Card No">Card No:</label></td>
                                <td>
                                  <input
                                    name="Card No"
                                    id="Card No"
                                    type="number"
                                  />
                                </td>
                              </tr>
                              <br />
                              <tr>
                                <td>
                                  <label for="Bank Name">BankName:</label>
                                </td>
                                <td class="ml-2">
                                  <input
                                    name="Bank Name"
                                    id="Bank Name"
                                    type="text"
                                  />
                                </td>
                              </tr>
                            </table>
                          </div>
                          <div *ngIf="selectedPayment == 'UPI'">
                            <table>
                              <tr>
                                <td><label for="UPI"> UPI:</label></td>
                                <td>
                                  <input name="UPI" id="UPI" type="text" />
                                </td>
                              </tr>
                            </table>
                          </div>
                          <div
                            class="ml-2 mb-2"
                            *ngIf="selectedPayment == 'Cheque'"
                          >
                            <table>
                              <tr>
                                <td><label for="Cheque no">Cheq No:</label></td>
                                <td>
                                  <input
                                    name="Cheque no"
                                    id="Cheque no"
                                    type="number"
                                    [(ngModel)]="
                                      patientpaymentObj.paymentInfo.chequeNo
                                    "
                                    [ngModelOptions]="{ standalone: true }"
                                  />
                                </td>
                              </tr>
                              <tr>
                                <td>
                                  <label for="Cheque date">Cheq Date:</label>
                                </td>
                                <td>
                                  <input
                                    name="Cheque date"
                                    id="Cheque date"
                                    type="text"
                                    [(ngModel)]="
                                      patientpaymentObj.paymentInfo.chequeDate
                                    "
                                    [ngModelOptions]="{ standalone: true }"
                                  />
                                </td>
                              </tr>
                            </table>
                          </div>
                          <!-- </div> -->
                        </div>

                        <div class="row mt-4">
                          <div class="col md-12">
                            <table>
                              <tr>
                                <td>
                                  <label for="Bill Amount">Bill Amount:</label>
                                </td>
                                <td>
                                  <input
                                    class="input"
                                    name="Bill Amount"
                                    id="Bill Amount"
                                    type="number"
                                    [(ngModel)]="patientpaymentObj.billAmount"
                                    [ngModelOptions]="{ standalone: true }"
                                    disabled
                                  />
                                </td>
                                <td><label for="Discount">Discount:</label></td>
                                <td>
                                  <input
                                    style="width: 40px"
                                    placeholder="%"
                                    name="Discount"
                                    id="Discount"
                                    type="text"
                                    (input)="discount('percentage')"
                                    [(ngModel)]="
                                      patientpaymentObj.discountPercentage
                                    "
                                    [ngModelOptions]="{ standalone: true }"
                                    (keypress)="
                                      keyPressNumbersWithDecimal($event)
                                    "
                                  />&nbsp;
                                  <input
                                    style="width: 70px"
                                    name="Discount"
                                    placeholder="Amount"
                                    id="Discount"
                                    type="number"
                                    (input)="discount('amount')"
                                    [(ngModel)]="
                                      patientpaymentObj.discountAmount
                                    "
                                    [ngModelOptions]="{ standalone: true }"
                                    (keypress)="
                                      keyPressNumbersWithDecimal($event)
                                    "
                                  />
                                </td>
                              </tr>
                              <tr>
                                <td>
                                  <label for="Other Charges"
                                    >Other Charges:</label
                                  >
                                </td>
                                <td>
                                  <input
                                    class="input"
                                    name="Other Charges"
                                    id="Other Charges"
                                    type="number"
                                    (input)="otherChanges($event)"
                                    [(ngModel)]="patientpaymentObj.otherCharges"
                                    [ngModelOptions]="{ standalone: true }"
                                    (keypress)="
                                      keyPressNumbersWithDecimal($event)
                                    "
                                  />
                                </td>
                                <td>
                                  <label
                                    for="Total Amount"
                                    style="font-weight: bolder"
                                    >Total Amount:
                                  </label>
                                </td>
                                <td>
                                  <input
                                    style="
                                      outline: solid 1px;
                                      font-weight: bolder;
                                    "
                                    class="input"
                                    name="Total Amount"
                                    id="Total Amount"
                                    type="number"
                                    [(ngModel)]="patientpaymentObj.totalAmount"
                                    [ngModelOptions]="{ standalone: true }"
                                    disabled
                                  />
                                </td>
                              </tr>
                              <tr>
                                <td>
                                  <label for="Paid Amount">Paid Amount:</label>
                                </td>
                                <td>
                                  <input
                                    class="input"
                                    name="Paid Amount"
                                    type="number"
                                    [(ngModel)]="patientpaymentObj.paidAmount"
                                    disabled
                                    [ngModelOptions]="{ standalone: true }"
                                    (keypress)="
                                      keyPressNumbersWithDecimal($event)
                                    "
                                  />
                                </td>
                                <td>
                                  <label for="Balance TO Be Paid"
                                    >Balance To Be Paid:
                                  </label>
                                </td>
                                <td>
                                  <input
                                    class="input"
                                    name="Balance TO Be Paid"
                                    id="Balance TO Be Paid"
                                    type="number"
                                    [(ngModel)]="
                                      patientpaymentObj.totalAmount -
                                      patientpaymentObj.paidAmount -
                                      patientpaymentObj.orderAmount
                                    "
                                    [ngModelOptions]="{ standalone: true }"
                                    disabled
                                  />
                                </td>
                                <td>
                                  <label for="paying_now"
                                    >Paying Now (Amount) :
                                  </label>
                                </td>
                                <td>
                                  <input
                                    class="input"
                                    name="Paid Amount"
                                    id="paying_now"
                                    type="number"
                                    (input)="balancePaid()"
                                    [(ngModel)]="patientpaymentObj.orderAmount"
                                    [ngModelOptions]="{ standalone: true }"
                                    (keypress)="
                                      keyPressNumbersWithDecimal($event)
                                    "
                                  />
                                </td>
                              </tr>
                            </table>
                          </div>
                          <div class="col-md-12 mt-2">
                            <table>
                              <tr>
                                <td><label for="Remarks">Comments: </label></td>
                                <td>
                                  <textarea
                                    name="Remarks"
                                    style="margin-left: 21px"
                                    [(ngModel)]="patientpaymentObj.comments"
                                    [ngModelOptions]="{ standalone: true }"
                                  ></textarea>
                                </td>
                              </tr>
                            </table>
                          </div>
                        </div>

                        <br />
                        <button
                          type="submit"
                          style="float: right"
                          class="btn btn-primary"
                          (click)="addBillingData()"
                        >
                          Submit
                        </button>
                        <br />
                      </div>
                    </div>
                  </mat-expansion-panel>
                </mat-accordion>
              </div>
            </div>
          </div>
        </div>

        <div *ngIf="showQuestioner && !showUploadFiles">
          <div class="card bg-light">
            <div class="card-body">
              <div class="card p-3">
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group">
                      <label for="">PID</label>
                      <input
                        class="form-control"
                        formControlName="PID"
                        [disabled]
                      />
                    </div>
                    <div class="form-group">
                      <label for="">Patient Name</label>
                      <input class="form-control" formControlName="name" />
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div
                      class="form-group"
                      *ngIf="patientdetailsdata?.createdAt"
                    >
                      <label for="">REG. Date</label>
                      <input
                        class="form-control"
                        disabled
                        [value]="
                          patientdetailsdata?.createdAt
                            | date: 'dd-MM-yyyy HH:mm'
                        "
                      />
                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="qr-code border-success">
                      <label style="margin-left: 30px">Bar Code</label>
                      <ngx-barcode
                        [bc-value]="value"
                        [bc-display-value]="true"
                      ></ngx-barcode>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="qr-code border-success">
                      <label>QR Code</label>
                      <qrcode
                        [qrdata]="value"
                        [width]="150"
                        [errorCorrectionLevel]="'M'"
                      ></qrcode>
                    </div>
                  </div>
                </div>
              </div>
              <mat-card class="mt-3 questionnaire">
                <h4>Questionnaire</h4>
                <table class="table table-bordered m-0 text-center">
                  <tr>
                    <th class="sno">S.No</th>
                    <th class="question">Question</th>
                    <th class="answer">Answer</th>
                    <th>Code</th>
                  </tr>
                </table>
                <div *ngFor="let grp of questionForm.controls">
                  <form [formGroup]="grp" class="questForm">
                    <table class="table table-bordered m-0 text-center">
                      <td class="sec">{{ grp.value.name }}</td>
                    </table>
                    <!-- <label > </label> -->
                    <div
                      formArrayName="questions"
                      *ngFor="
                        let item of grp?.get('questions')['controls'];
                        let i = index
                      "
                    >
                      <table
                        [formGroup]="item"
                        class="table table-bordered m-0"
                      >
                        <tr>
                          <td class="sno">{{ i + 1 }}</td>
                          <td class="question">{{ item?.value?.question }}</td>
                          <td class="answer">
                            <div *ngIf="item.value.type == 'options'">
                              <mat-radio-group
                                aria-label="Select an option"
                                class="checkbox"
                                formControlName="answer"
                              >
                                <mat-radio-button
                                  class="col-lg-12 optionText"
                                  *ngFor="
                                    let answers of item.value?.possibleAnswers
                                  "
                                  [value]="answers"
                                  >{{ answers }}</mat-radio-button
                                >
                                <!-- <mat-radio-button value="no">No</mat-radio-button> -->
                              </mat-radio-group>
                            </div>
                            <div *ngIf="item.value.type == 'checkbox'">
                              <!-- <label formArrayName="answer" *ngFor="let order of item.get('answer')['controls']; let i = index">
                                                        <input type="checkbox" [formControlName]="i">
                                                        {{item.value.possibleAnswers[i]}}
                                                      </label> -->
                              <section
                                class="example-section checkbox"
                                formArrayName="answer"
                                *ngFor="
                                  let order of item.get('answer')['controls'];
                                  let i = index
                                "
                              >
                                <mat-checkbox
                                  class="example-margin"
                                  [formControlName]="i"
                                  class="col-lg-12 optionText"
                                  [value]="item.value.possibleAnswers[i]"
                                >
                                  {{
                                    item?.value?.possibleAnswers[i]
                                  }}</mat-checkbox
                                >
                              </section>
                            </div>
                            <div
                              class="input-with-measure"
                              *ngIf="
                                item.value.type == 'input' ||
                                item.value.type == 'paragraph' ||
                                item.value.type == 'textArea' ||
                                item.value.type == 'numeric'
                              "
                            >
                              <input
                                class="form-control"
                                formControlName="answer"
                              /><span>{{ item?.value?.units }}</span>
                            </div>
                            <div
                              class="input-with-measure"
                              *ngIf="item.value.type == 'dropdown'"
                            >
                              <ng-select
                                [placeholder]="
                                  getPlaceholder(item?.value?.question)
                                "
                                formControlName="answer"
                              >
                                <!-- <ng-option *ngFor="let language of item?.value?.possibleAnswers" [value]="language">{{language | titlecase }}</ng-option> -->
                                <ng-option
                                  *ngFor="
                                    let language of item?.value?.possibleAnswers
                                  "
                                  [value]="language"
                                  >{{ language | titlecase }}</ng-option
                                >
                              </ng-select>
                              <!-- <select class="form-control" formControlName="answer">
                                                            <option value="" disabled>Select Language</option>
                                                            <option *ngFor="let language of item?.value?.possibleAnswers" value="{{language}}">{{language | titlecase }}</option>
                                                        </select> -->
                              <!-- <input class="form-control"
                                                            formControlName="answer"><span>{{item?.value?.units}}</span> -->
                            </div>
                            <div
                              class="input-with-measure"
                              *ngIf="item.value.type == 'time'"
                            >
                              <!-- <igx-time-picker  formControlName="answer">
                                                        </igx-time-picker> -->
                              <input
                                class="form-control"
                                formControlName="answer"
                              /><span>{{ item?.value?.units }}</span>
                            </div>
                            <div *ngIf="item.value.type == 'date'">
                              <input
                                class="form-control"
                                type="date"
                                formControlName="answer"
                              />
                            </div>
                            <div *ngIf="item.value.type == 'radio'">
                              <mat-radio-group
                                aria-label="Select an option"
                                formControlName="answer"
                              >
                                <mat-radio-button value="yes"
                                  >Yes</mat-radio-button
                                >
                                <mat-radio-button value="no"
                                  >No</mat-radio-button
                                >
                              </mat-radio-group>
                            </div>
                          </td>
                          <td>{{ item.value.code }}</td>
                        </tr>

                        <tr
                          formArrayName="subquestions"
                          *ngFor="
                            let sub of item.get('subquestions')['controls'];
                            let j = index
                          "
                        >
                          <!-- < > -->
                          <td [formGroupName]="j" class="sno">
                            {{ i + 1 }}.{{ j + 1 }}
                          </td>
                          <td [formGroupName]="j" class="question">
                            {{ sub.value.question }}
                          </td>
                          <td [formGroupName]="j" class="answer">
                            <div *ngIf="sub.value.type == 'options'">
                              <mat-radio-group
                                aria-label="Select an option"
                                class="checkbox"
                                formControlName="answer"
                              >
                                <mat-radio-button
                                  class="col-lg-12 optionText"
                                  *ngFor="
                                    let answers of sub.value?.possibleAnswers
                                  "
                                  [value]="answers"
                                  >{{ answers }}
                                </mat-radio-button>
                                <!-- <mat-radio-button value="no">No</mat-radio-button> -->
                              </mat-radio-group>
                            </div>
                            <div *ngIf="sub.value.type == 'checkbox'">
                              <!-- <label formArrayName="answer" *ngFor="let order of item.get('answer')['controls']; let i = index">
                                                               <input type="checkbox" [formControlName]="i">
                                                               {{item.value.possibleAnswers[i]}}
                                                             </label> -->
                              <section
                                class="example-section checkbox"
                                formArrayName="answer"
                                *ngFor="
                                  let order of sub.get('answer')['controls'];
                                  let i = index
                                "
                              >
                                <mat-checkbox
                                  class="example-margin"
                                  [formControlName]="i"
                                  class="col-lg-12 optionText"
                                  [value]="sub.value.possibleAnswers[i]"
                                >
                                  {{
                                    sub.value.possibleAnswers[i]
                                  }}</mat-checkbox
                                >
                              </section>
                            </div>
                            <div
                              *ngIf="
                                sub.value.type == 'input' ||
                                sub.value.type == 'paragraph' ||
                                sub.value.type == 'textArea' ||
                                sub.value.type == 'numeric'
                              "
                            >
                              <input
                                class="form-control"
                                formControlName="answer"
                              />{{ sub.value?.units }}
                            </div>
                            <div
                              class="input-with-measure"
                              *ngIf="sub.value.type == 'dropdown'"
                            >
                              <ng-select
                                [placeholder]="
                                  getPlaceholder(sub?.value?.question)
                                "
                                formControlName="answer"
                              >
                                <!-- <ng-option *ngFor="let language of item?.value?.possibleAnswers" [value]="language">{{language | titlecase }}</ng-option> -->
                                <ng-option
                                  *ngFor="
                                    let language of sub?.value?.possibleAnswers
                                  "
                                  [value]="language"
                                  >{{ language | titlecase }}</ng-option
                                >
                              </ng-select>
                              <!-- <select class="form-control" formControlName="answer">
                                                        <option value="" disabled>Select Language</option>
                                                        <option *ngFor="let language of item?.value?.possibleAnswers" value="{{language}}">{{language | titlecase }}</option>
                                                    </select> -->
                              <!-- <input class="form-control"
                                                        formControlName="answer"><span>{{item?.value?.units}}</span> -->
                            </div>
                            <div
                              class="input-with-measure"
                              *ngIf="sub.value.type == 'time'"
                            >
                              <!-- <igx-time-picker  formControlName="answer">
                                                    </igx-time-picker> -->
                              <input
                                class="form-control"
                                formControlName="answer"
                              /><span>{{ sub?.value?.units }}</span>
                            </div>
                            <div *ngIf="sub.value.type == 'date'">
                              <input
                                class="form-control"
                                type="date"
                                formControlName="answer"
                              />
                            </div>
                            <div *ngIf="sub.value.type == 'radio'">
                              <mat-radio-group
                                aria-label="Select an option"
                                formControlName="answer"
                              >
                                <mat-radio-button value="yes"
                                  >Yes</mat-radio-button
                                >
                                <mat-radio-button value="no"
                                  >No</mat-radio-button
                                >
                              </mat-radio-group>
                            </div>
                          </td>
                          <td [formGroupName]="j">{{ sub.value.code }}</td>
                        </tr>
                      </table>
                    </div>
                  </form>
                </div>
                <button class="btn" (click)="questionnaireForm()">Apply</button>
              </mat-card>
            </div>
          </div>
        </div>
        <div *ngIf="!showQuestioner && showUploadFiles">
          <div class="card bg-light">
            <div class="card-body">
              <div class="card p-3">
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group">
                      <label for="">PID</label>
                      <input
                        class="form-control"
                        formControlName="PID"
                        readonly
                      />
                    </div>
                    <div class="form-group">
                      <label for="">Patient Name</label>
                      <input
                        class="form-control"
                        formControlName="name"
                        readonly
                      />
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div
                      class="form-group"
                      *ngIf="patientdetailsdata?.createdAt"
                    >
                      <label for="">REG. Date</label>
                      <input
                        class="form-control"
                        readonly
                        [value]="
                          patientdetailsdata?.createdAt
                            | date: 'dd-MM-yyyy HH:mm'
                        "
                      />
                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="qr-code border-success">
                      <label style="margin-left: 30px">Bar Code</label>
                      <ngx-barcode
                        [bc-value]="value"
                        [bc-display-value]="true"
                      ></ngx-barcode>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="qr-code border-success">
                      <label>QR Code</label>
                      <qrcode
                        [qrdata]="value"
                        [width]="150"
                        [errorCorrectionLevel]="'M'"
                      ></qrcode>
                    </div>
                  </div>
                </div>
              </div>
              <mat-card class="mt-3">
                <h4>Upload Reports</h4>
                <div>
                  <!-- [formGroup]="myForm" (submit)="questionnaireForm()" -->
                  <form>
                    <div class="form-group">
                      <input
                        type="file"
                        multiple
                        class="form-control"
                        [(ngModel)]="file"
                        name="file"
                        (change)="UploadFiles($event)"
                      />
                    </div>
                    <button
                      class="btn"
                      (click)="submitUploadFiles()"
                      [attr.disabled]="
                        uploadFilesData.length < 1 ? false : null
                      "
                      [ngClass]="{
                        'disable-button': uploadFilesData.length == 0
                      }"
                    >
                      Submit
                    </button>
                  </form>
                </div>
                <h4 *ngIf="uploadFilesDetails?.length > 0">
                  Previous Upload Reports
                </h4>
                <div class="row m-2">
                  <div class="col-lg-12">
                    <div
                      class="image reports-images"
                      *ngFor="let item of uploadFilesDetails"
                    >
                      <img
                        src="{{ image }}/{{ item?.attachment }}"
                        width="300px"
                        height="300px"
                        class="paient_repots"
                      />
                    </div>
                  </div>

                  <!-- <div class="col-lg-4">
                                <div class="imgae">
                                    <img src="../../../assets/depart.jpg" class="img-responsive img-fluid">
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="imgae">
                                    <img src="../../../assets/depart.jpg" class="img-responsive img-fluid">
                                </div>
                            </div> -->
                </div>
              </mat-card>
            </div>
          </div>
        </div>
        <div
          class="text-right my-3 submitButton"
          *ngIf="!showQuestioner && !showUploadFiles"
        >
          <!-- *ngIf="patientCreatedBy == user._id || !patientCreatedBy" -->
          <div *ngIf="isSubDivisionPatient">
            <button class="btn mr-3" (click)="clearForm()">Clear</button>
            <button class="btn" type="submit" (click)="onSubmit()">Save</button>
          </div>

          <!-- [disabled]="!patientRegistrationForm.valid" [ngClass]="{'btnDisabled':!patientRegistrationForm.valid}" -->
        </div>
      </form>
    </div>

    <!-- [ngClass]="{'printident': showqrcode}" -->
    <!-- id="printform" directPrint="true" ngxPrintItemMarker-->
    <div class="printident">
      <div class="card bg-light">
        <div class="card-body">
          <div class="card p-3">
            <form>
              <div class="row">
                <div class="col-md-4">
                  <div class="form-group">
                    <label for="">PID</label>
                    <input class="form-control" [value]="barCodeValue" />
                  </div>
                  <div class="form-group">
                    <label for="">Patient Name</label>
                    <input
                      class="form-control"
                      [value]="patientdetailsdata?.name"
                      *ngIf="patientdetailsdata?.name"
                    />
                    <input
                      class="form-control"
                      *ngIf="!patientdetailsdata?.name"
                    />
                  </div>
                </div>
                <div class="col-md-2">
                  <div
                    class="form-group"
                    *ngIf="patientdetailsdata?.createdAt || createdAt"
                  >
                    <label for="">REG. Date</label>
                    <!-- <input class="form-control" disabled *ngIf="patientdetailsdata?.createdAt" [value]="patientdetailsdata?.createdAt | date:'dd-MM-yyyy'"> -->
                    <input
                      class="form-control"
                      style="font-size: 13px"
                      *ngIf="createdAt"
                      [value]="createdAt | date: 'dd-MM-yyyy HH:mm'"
                    />
                  </div>
                  <div class="form-group">
                    <label>Gender</label>
                    <input
                      class="form-control"
                      [value]="patientdetailsdata?.gender"
                      *ngIf="patientdetailsdata?.gender"
                    />
                    <input
                      class="form-control"
                      *ngIf="!patientdetailsdata?.gender"
                    />
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="qr-code border-success">
                    <label style="margin-left: 30px">Bar Code</label>
                    <ngx-barcode
                      [bc-value]="barCodeValue"
                      [bc-display-value]="true"
                      *ngIf="barCodeValue"
                    >
                    </ngx-barcode>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="row">
                    <div class="col-md-6">
                      <div class="qr-code border-success">
                        <label>QR Code</label>
                        <!-- <qrcode 
                                            [qrdata]="barCodeValue" [width]="150"  [errorCorrectionLevel]="'M'" [elementType]="'svg'" *ngIf="barCodeValue"
                                            ></qrcode> -->
                        <ngx-qrcode
                          [elementType]="'svg'"
                          [value]="barCodeValue"
                          cssClass="aclass"
                          [width]="120"
                          errorCorrectionLevel="L"
                        >
                        </ngx-qrcode>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <img
                        src="../../../assets/PreviaLogo.png"
                        class="img-responsive img-fluid"
                      />
                      <!-- <img [src]="sanitizer.bypassSecurityTrustUrl('/' + cardModel[r.content].value)" /> -->
                    </div>
                  </div>
                </div>

                <div class="col-md-3">
                  <div class="form-group">
                    <label>DOB</label>
                    <input
                      class="form-control"
                      [value]="patientdetailsdata?.DOB"
                      *ngIf="patientdetailsdata?.DOB"
                    />
                    <input
                      class="form-control"
                      *ngIf="!patientdetailsdata?.DOB"
                    />
                  </div>
                </div>
                <div class="col-md-1">
                  <div class="form-group">
                    <label>Age</label>
                    <input class="form-control" [value]="age" />
                    <!-- <input class="form-control" *ngIf="!patientdetailsdata?.name"> -->
                  </div>
                </div>
                <div class="col-md-2">
                  <div class="form-group">
                    <label>Mobile</label>
                    <input
                      class="form-control"
                      [value]="patientdetailsdata?.mobileNumber"
                      *ngIf="patientdetailsdata?.mobileNumber"
                    />
                    <input
                      class="form-control"
                      *ngIf="!patientdetailsdata?.mobileNumber"
                    />
                  </div>

                  <!-- newabc -->

  

                </div>

                <!-- newstart -->
                
              
                <!-- newstrat -->

                <div class="col-md-2">
                  <div class="form-group">
                    <label>Email</label>
                    <input
                      class="form-control"
                      [value]="patientdetailsdata?.emailAddress"
                      *ngIf="patientdetailsdata?.emailAddress"
                    />
                    <input
                      class="form-control"
                      *ngIf="!patientdetailsdata?.emailAddress"
                    />
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="form-group">
                    <label>Proof Details</label>
                    <div class="input-flex">
                      <input
                        class="form-control borderRight"
                        [value]="patientdetailsdata?.proofType"
                        *ngIf="patientdetailsdata?.proofType"
                      />
                      <input
                        class="form-control borderRight"
                        *ngIf="!patientdetailsdata?.proofType"
                      />
                      <input
                        class="form-control"
                        [value]="patientdetailsdata?.proofValue"
                        *ngIf="patientdetailsdata?.proofValue"
                      />
                      <input
                        class="form-control"
                        *ngIf="!patientdetailsdata?.proofValue"
                      />
                    </div>
                    <!-- <div *ngIf="submitted && f.aadhaar.errors" class="invalid-feedback">
                                        <div *ngIf="f.aadhaar.errors.required" >Please enter valid  Aadhar</div>
                                    </div> -->
                  </div>
                </div>
                <div class="col-md-2">
                  <div class="form-group">
                    <label>Aaadhar</label>
                    <input
                      class="form-control"
                      [value]="patientdetailsdata?.aadhaar"
                      *ngIf="patientdetailsdata?.aadhaar"
                    />
                    <input
                      class="form-control"
                      *ngIf="!patientdetailsdata?.aadhaar"
                    />
                  </div>
                </div>

                <div class="col-md-2">
                  <div class="form-group">
                    <label>Economic Status</label>
                    <input
                      class="form-control"
                      [value]="patientdetailsdata?.economicStatus"
                      *ngIf="patientdetailsdata?.economicStatus"
                    />
                    <input
                      class="form-control"
                      *ngIf="!patientdetailsdata?.economicStatus"
                    />
                  </div>
                </div>

                <div class="col-md-2">
                  <div class="form-group">
                    <label>Occupation</label>
                    <input
                      class="form-control"
                      [value]="patientdetailsdata?.occupation"
                      *ngIf="patientdetailsdata?.occupation"
                    />
                    <input
                      class="form-control"
                      *ngIf="!patientdetailsdata?.occupation"
                    />
                  </div>
                </div>
                <div class="col-md-2">
                  <div class="form-group">
                    <label>Address</label>
                    <input
                      class="form-control"
                      [value]="patientdetailsdata?.address"
                      *ngIf="patientdetailsdata?.address"
                    />
                    <input
                      class="form-control"
                      *ngIf="!patientdetailsdata?.address"
                    />
                  </div>
                </div>

                <div class="col-md-2">
                  <div class="form-group">
                    <label>City</label>
                    <input
                      class="form-control"
                      [value]="patientdetailsdata?.city"
                      *ngIf="patientdetailsdata?.city"
                    />
                    <input
                      class="form-control"
                      *ngIf="!patientdetailsdata?.city"
                    />
                  </div>
                </div>
                <div class="col-md-2">
                  <div class="form-group">
                    <label>State</label>
                    <input
                      class="form-control"
                      [value]="patientdetailsdata?.state"
                      *ngIf="patientdetailsdata?.state"
                    />
                    <input
                      class="form-control"
                      *ngIf="!patientdetailsdata?.state"
                    />
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label>Habits</label>
                    <textarea
                      type="text"
                      class="form-control"
                      [value]="patientdetailsdata?.habits"
                      *ngIf="patientdetailsdata?.habits"
                    ></textarea>
                    <textarea
                      type="text"
                      class="form-control"
                      *ngIf="!patientdetailsdata?.habits"
                    ></textarea>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label>LifeStyle</label>
                    <textarea
                      type="text"
                      class="form-control"
                      [value]="patientdetailsdata?.lifeStyle"
                      *ngIf="patientdetailsdata?.lifeStyle"
                    ></textarea>
                    <textarea
                      type="text"
                      class="form-control"
                      *ngIf="!patientdetailsdata?.lifeStyle"
                    ></textarea>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="card mt-3 bg-light">
        <div class="card-body">
          <div class="">
            <h3>Patient general tests</h3>
            <div
              class="table-responsive details"
              *ngIf="
                !patientdetailsdata?.details?.length ||
                patientdetailsdata?.details?.length == 0
              "
            >
              <table class="table table-bordered">
                <thead>
                  <tr>
                    <th>Height(cms)</th>
                    <th>Weight(Kgs)</th>
                    <th>BMi</th>
                    <th>Blood Presure</th>
                    <th>Acuity Of Vision</th>
                    <th>Blood Group</th>
                    <th>Temperature</th>
                    <th>comment</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><input type="text" class="form-control b-0" /></td>
                    <td><input type="text" class="form-control b-0" /></td>
                    <td><input type="text" class="form-control b-0" /></td>
                    <td><input type="text" class="form-control b-0" /></td>
                    <td><input type="text" class="form-control b-0" /></td>
                    <td><input type="text" class="form-control b-0" /></td>
                    <td><input type="text" class="form-control b-0" /></td>
                  2  <td><input type="text" class="form-control b-0" /></td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div
              class="table-responsive example-container mat-elevation-z8"
              *ngIf="patientdetailsdata?.details?.length > 0"
            >
              <table class="table table-bordered">
                <thead>
                  <th>Date</th>
                  <th>Height(cms)</th>
                  <th>Weight(Kgs)</th>
                  <th>BMi</th>
                  <th>Blood Presure</th>
                  <th>Acuity Of Vision</th>
                  <th>Blood Group</th>
                  <th>Temperature(°F)</th>
                  <th>comment</th>
                </thead>
                <tbody>
                  <tr
                    class="previousData"
                    *ngFor="let item of patientdetailsdata?.details"
                  >
                    <td>{{ item.createdAt | date: "dd-MM-yyyy HH:mm" }}</td>
                    <td>{{ item.height }}</td>
                    <td>{{ item.weight }}</td>
                    <td>{{ item.BMI }}</td>
                    <td>{{ item.BP }}</td>
                    <td>{{ item.acuityOfVision }}</td>
                    <td>{{ item.bloodGroup }}</td>
                    <td>{{ item.temperature }}</td>
                    <td>{{ item.comment }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="mt-3">
            <h3>Tests</h3>
            <div
              *ngIf="
                !patientdetailsdata?.tests?.length ||
                patientdetailsdata?.tests?.length == 0
              "
              class="card cardLength"
              style="width: 100%; height: 180px; border-radius: 20px !important"
            ></div>
            <div
              class="table-responsive example-container mat-elevation-z8"
              *ngIf="patientdetailsdata?.tests?.length > 0"
            >
              <table class="table table-bordered">
                <thead>
                  <th>Date</th>
                  <th>Test Name</th>
                  <th>Value</th>
                  <th>comment</th>
                </thead>
                <tbody>
                  <tr *ngFor="let item of patientdetailsdata?.tests">
                    <td>{{ item.createdAt | date: "dd-MM-yyyy HH:mm" }}</td>
                    <td>{{ item.test?.name }}</td>
                    <td>
                      <div
                        *ngIf="
                          item?.testResult?.resultType != 'template' &&
                          item.status == 'completed'
                        "
                      >
                        {{ item.value }}
                      </div>
                      <div
                        *ngIf="
                          item?.testResult?.resultType == 'template' &&
                          item.status == 'completed'
                        "
                      >
                        <button class="btn btn-md px-2">Template</button>
                      </div>
                    </td>
                    <td>{{ item.comment }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="mt-3">
            <h3>Past Medical History HH</h3>
            <div
              *ngIf="
                !patientdetailsdata?.medicalHistory?.length ||
                patientdetailsdata?.medicalHistory?.length == 0
              "
              class="card cardLength"
              style="width: 100%; height: 180px; border-radius: 20px !important"
            ></div>
            <div
              class="table-responsive example-container mat-elevation-z8"
              *ngIf="patientdetailsdata?.medicalHistory?.length > 0"
            >
              <table class="table table-bordered">
                <thead>
                  <th>Date</th>
                  <th>Medicine</th>
                  <th>Frequency</th>
                  <th>noOfDays</th>
                  <th>comment</th>
                </thead>
                <tbody>
                  <tr *ngFor="let item of patientdetailsdata?.medicalHistory">
                    <td>{{ item.createdAt | date: "dd-MM-yyyy HH:mm" }}</td>
                    <td>{{ item.medicine }}</td>
                    <td>{{ item.frequency }}</td>
                    <td>{{ item.noOfDays }}</td>
                    <td>{{ item.comment }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="mt-4">
            <h3>Family History</h3>
            <div
              *ngIf="
                !patientdetailsdata?.familyHistory?.length ||
                patientdetailsdata?.familyHistory?.length == 0
              "
              class="card cardLength"
              style="width: 100%; height: 180px; border-radius: 20px !important"
            ></div>
            <div
              class="table-responsive example-container mat-elevation-z8"
              *ngIf="patientdetailsdata?.familyHistory?.length > 0"
            >
              <table class="table table-bordered">
                <thead>
                  <th>Date</th>
                  <th>Disease</th>
                  <th>Relation</th>
                  <th>FromYears</th>
                  <th>comment</th>
                </thead>
                <tbody>
                  <tr *ngFor="let item of patientdetailsdata?.familyHistory">
                    <td>{{ item.createdAt | date: "dd-MM-yyyy HH:mm" }}</td>
                    <td>{{ item.decease }}</td>
                    <td>{{ item.relation }}</td>
                    <td>{{ item.fromYears }}</td>
                    <td>{{ item.comment }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <br />

      <div class="card page-break">
        <div class="">
          <h3 class="text-center">Questionnaire - {{ barCodeValue }}</h3>
          <div class="m-2 p-3">
            <div>
              <table class="table table-bordered">
                <tr>
                  <th>S.No</th>
                  <th>Question</th>
                  <th>Response</th>
                  <th>Code</th>
                </tr>
                <ng-template
                  #rowTemplateOutlet
                  let-index="index"
                  let-index2="index2"
                  let-item="item"
                  let-Question="Question"
                >
                  <tr class="tableheader qnHeading">
                    <!--  -->
                    <td
                      colspan="5"
                      style="
                        background: #ddd;
                        text-align: center;
                        font-weight: bold;
                      "
                      *ngIf="index == 0"
                    >
                      {{ item.name }}
                    </td>
                  </tr>

                  <tr>
                    <td>{{ index + 1 }}</td>
                    <td>{{ Question.question }}</td>
                    <td>
                      <span
                        class="row"
                        *ngIf="
                          Question?.type === 'input' ||
                          Question?.type === 'textArea' ||
                          Question?.type === 'dropdown' ||
                          Question?.type === 'time'
                        "
                      >
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-left: 6px;
                          "
                        /><span style="font-size: 12px">{{
                          Question?.units
                        }}</span>
                      </span>

                      <span *ngIf="Question?.type === 'paragraph'">
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-right: 9px;
                            display: block0;
                          "
                        />
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-right: 9px;
                            display: block0;
                          "
                        />
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-right: 9px;
                            display: block0;
                          "
                        />
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-right: 9px;
                            display: block0;
                          "
                        />
                      </span>
                      <span *ngIf="Question?.type === 'radio'">
                        1.Yes &nbsp;&nbsp; 2.No
                      </span>
                      <span *ngIf="Question?.type === 'options'">
                        <!-- 1.Yes &nbsp;&nbsp;
                                            2.No -->
                        <p
                          *ngFor="
                            let answers of Question?.possibleAnswers;
                            let indexvalue = index
                          "
                        >
                          {{ indexvalue + 1 }}.{{ answers }}
                        </p>
                      </span>
                      <span *ngIf="Question?.type === 'checkbox'">
                        <div
                          class="d-flex"
                          style="align-items: center; margin-bottom: 10px"
                          *ngFor="let answers of Question?.possibleAnswers"
                        >
                          <input type="checkbox" />
                          <span style="padding-left: 8px">{{ answers }}</span>
                        </div>
                      </span>
                      <span *ngIf="Question?.type === 'numeric'">
                        <div>
                          <div style="display: flex">
                            <p
                              style="border: solid 1px #ccc; padding: 15px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 15px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 15px"
                            ></p>
                            <span>{{ Question?.units }}</span>
                          </div>
                        </div>
                      </span>

                      <span
                        *ngIf="Question?.type === 'date'"
                        style="display: flex; justify-content: space-evenly"
                      >
                        <div>
                          <div style="display: flex; justify-content: center">
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                          </div>
                          <div style="text-align: center">dd</div>
                        </div>
                        <div>
                          <div style="display: flex; justify-content: center">
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                          </div>
                          <div style="text-align: center">mm</div>
                        </div>
                        <div>
                          <div style="display: flex; justify-content: center">
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                          </div>
                          <div style="text-align: center">yyyy</div>
                        </div>
                      </span>
                    </td>
                    <td style="width: 15%">{{ Question.code }}</td>
                  </tr>
                  <tr
                    *ngFor="
                      let subQuestion of Question?.subQuestions;
                      let ind = index
                    "
                  >
                    <td>{{ index + 1 }}.{{ ind + 1 }}</td>
                    <td>{{ subQuestion?.question }}</td>

                    <td>
                      <span
                        class="row"
                        *ngIf="
                          subQuestion?.type === 'input' ||
                          subQuestion?.type === 'textArea' ||
                          subQuestion?.type === 'dropdown' ||
                          subQuestion?.type === 'time'
                        "
                      >
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-left: 6px;
                          "
                        /><span style="font-size: 12px">{{
                          subQuestion?.units
                        }}</span>
                      </span>
                      <span *ngIf="subQuestion?.type === 'radio'">
                        1.Yes &nbsp;&nbsp; 2.No
                      </span>
                      <span *ngIf="subQuestion?.type === 'options'">
                        <!-- 1.Yes &nbsp;&nbsp;
                                            2.No -->
                        <p
                          *ngFor="
                            let answers of subQuestion?.possibleAnswers;
                            let indexvalue = index
                          "
                        >
                          {{ indexvalue + 1 }}.{{ answers }}
                        </p>
                      </span>
                      <span *ngIf="subQuestion?.type === 'checkbox'">
                        <div
                          class="d-flex"
                          style="align-items: center; margin-bottom: 10px"
                          *ngFor="let answers of subQuestion?.possibleAnswers"
                        >
                          <input type="checkbox" />
                          <span style="padding-left: 8px">{{ answers }}</span>
                        </div>
                      </span>
                      <span *ngIf="subQuestion?.type === 'numeric'">
                        <div>
                          <div style="display: flex">
                            <p
                              style="border: solid 1px #ccc; padding: 15px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 15px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 15px"
                            ></p>
                            <span>{{ subQuestion?.units }}</span>
                          </div>
                        </div>
                      </span>
                      <span *ngIf="Question?.type === 'paragraph'">
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-right: 9px;
                            display: block0;
                          "
                        />
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-right: 9px;
                            display: block0;
                          "
                        />
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-right: 9px;
                            display: block0;
                          "
                        />
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-right: 9px;
                            display: block0;
                          "
                        />
                      </span>
                      <span
                        *ngIf="subQuestion?.type === 'date'"
                        style="display: flex; justify-content: space-evenly"
                      >
                        <div>
                          <div style="display: flex; justify-content: center">
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                          </div>
                          <div style="text-align: center">dd</div>
                        </div>
                        <div>
                          <div style="display: flex; justify-content: center">
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                          </div>
                          <div style="text-align: center">mm</div>
                        </div>
                        <div>
                          <div style="display: flex; justify-content: center">
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                          </div>
                          <div style="text-align: center">yyyy</div>
                        </div>
                      </span>
                    </td>
                    <td style="width: 15%">{{ subQuestion?.code }}</td>
                  </tr>
                </ng-template>

                <ng-container
                  *ngFor="let item of questionariesDetails; let inde = index"
                >
                  <ng-container
                    *ngFor="let Question of item?.questions; let i = index"
                  >
                    <ng-container
                      *ngTemplateOutlet="
                        rowTemplateOutlet;
                        context: {
                          item: item,
                          Question: Question,
                          index: i,
                          index2: inde
                        }
                      "
                    >
                    </ng-container>
                  </ng-container>
                </ng-container>
              </table>
            </div>
          </div>
        </div>
      </div>
      <div *ngIf="isShown">
        <p style="page-break-after: always">&nbsp;</p>
        <div class="card bg-light" *ngIf="showqrcode === true">
          <div class="card-body">
            <div class="card p-3">
              <form>
                <div class="row">
                  <div class="col-md-4">
                    <div class="form-group">
                      <label for="">PID</label>
                      <input class="form-control" [value]="barCodeValue" />
                    </div>
                    <div class="form-group">
                      <label for="">Patient Name</label>
                      <input
                        class="form-control"
                        [value]="patientdetailsdata?.name"
                        *ngIf="patientdetailsdata?.name"
                      />
                      <input
                        class="form-control"
                        *ngIf="!patientdetailsdata?.name"
                      />
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div
                      class="form-group"
                      *ngIf="patientdetailsdata?.createdAt || createdAt"
                    >
                      <label for="">REG. Date</label>
                      <!-- <input class="form-control" disabled *ngIf="patientdetailsdata?.createdAt" [value]="patientdetailsdata?.createdAt | date:'dd-MM-yyyy'"> -->
                      <input
                        class="form-control"
                        style="font-size: 13px"
                        *ngIf="createdAt"
                        [value]="createdAt | date: 'dd-MM-yyyy HH:mm'"
                      />
                    </div>
                    <div class="form-group">
                      <label>Gender</label>
                      <input
                        class="form-control"
                        [value]="patientdetailsdata?.gender"
                        *ngIf="patientdetailsdata?.gender"
                      />
                      <input
                        class="form-control"
                        *ngIf="!patientdetailsdata?.gender"
                      />
                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="qr-code border-success">
                      <label style="margin-left: 30px">Bar Code</label>
                      <ngx-barcode
                        [bc-value]="barCodeValue"
                        [bc-display-value]="true"
                        *ngIf="barCodeValue"
                      >
                      </ngx-barcode>
                    </div>
                  </div>
                  <div class="col-md-3">
                    <div class="row">
                      <div class="col-md-6">
                        <div class="qr-code border-success">
                          <label>QR Code</label>
                          <!-- <qrcode 
                                            [qrdata]="barCodeValue" [width]="150"  [errorCorrectionLevel]="'M'" [elementType]="'svg'" *ngIf="barCodeValue"
                                            ></qrcode> -->
                          <ngx-qrcode
                            [elementType]="'svg'"
                            [value]="barCodeValue"
                            cssClass="aclass"
                            [width]="120"
                            errorCorrectionLevel="L"
                          >
                          </ngx-qrcode>
                        </div>
                      </div>
                      <div class="col-md-6">
                        <img
                          src="../../../assets/PreviaLogo.png"
                          class="img-responsive img-fluid"
                        />
                        <!-- <img [src]="sanitizer.bypassSecurityTrustUrl('/' + cardModel[r.content].value)" /> -->
                      </div>
                    </div>
                  </div>

                  <div class="col-md-3">
                    <div class="form-group">
                      <label>DOB</label>
                      <input
                        class="form-control"
                        [value]="patientdetailsdata?.DOB"
                        *ngIf="patientdetailsdata?.DOB"
                      />
                      <input
                        class="form-control"
                        *ngIf="!patientdetailsdata?.DOB"
                      />
                    </div>
                  </div>
                  <div class="col-md-1">
                    <div class="form-group">
                      <label>Age</label>
                      <input class="form-control" [value]="age" />
                      <!-- <input class="form-control" *ngIf="!patientdetailsdata?.name"> -->
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div class="form-group">
                      <label>Mobile</label>
                      <input
                        class="form-control"
                        [value]="patientdetailsdata?.mobileNumber"
                        *ngIf="patientdetailsdata?.mobileNumber"
                      />
                      <input
                        class="form-control"
                        *ngIf="!patientdetailsdata?.mobileNumber"
                      />
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div class="form-group">
                      <label>Email</label>
                      <input
                        class="form-control"
                        [value]="patientdetailsdata?.emailAddress"
                        *ngIf="patientdetailsdata?.emailAddress"
                      />
                      <input
                        class="form-control"
                        *ngIf="!patientdetailsdata?.emailAddress"
                      />
                    </div>
                  </div>
                  <div class="col-md-4">
                    <div class="form-group">
                      <label>Proof Details</label>
                      <div class="input-flex">
                        <input
                          class="form-control borderRight"
                          [value]="patientdetailsdata?.proofType"
                          *ngIf="patientdetailsdata?.proofType"
                        />
                        <input
                          class="form-control borderRight"
                          *ngIf="!patientdetailsdata?.proofType"
                        />
                        <input
                          class="form-control"
                          [value]="patientdetailsdata?.proofValue"
                          *ngIf="patientdetailsdata?.proofValue"
                        />
                        <input
                          class="form-control"
                          *ngIf="!patientdetailsdata?.proofValue"
                        />
                      </div>
                      <!-- <div *ngIf="submitted && f.aadhaar.errors" class="invalid-feedback">
                                        <div *ngIf="f.aadhaar.errors.required" >Please enter valid  Aadhar</div>
                                    </div> -->
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div class="form-group">
                      <label>Aaadhar</label>
                      <input
                        class="form-control"
                        [value]="patientdetailsdata?.aadhaar"
                        *ngIf="patientdetailsdata?.aadhaar"
                      />
                      <input
                        class="form-control"
                        *ngIf="!patientdetailsdata?.aadhaar"
                      />
                    </div>
                  </div>

                  <div class="col-md-2">
                    <div class="form-group">
                      <label>Economic Status</label>
                      <input
                        class="form-control"
                        [value]="patientdetailsdata?.economicStatus"
                        *ngIf="patientdetailsdata?.economicStatus"
                      />
                      <input
                        class="form-control"
                        *ngIf="!patientdetailsdata?.economicStatus"
                      />
                    </div>
                  </div>

                  <div class="col-md-2">
                    <div class="form-group">
                      <label>Occupation</label>
                      <input
                        class="form-control"
                        [value]="patientdetailsdata?.occupation"
                        *ngIf="patientdetailsdata?.occupation"
                      />
                      <input
                        class="form-control"
                        *ngIf="!patientdetailsdata?.occupation"
                      />
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div class="form-group">
                      <label>Address</label>
                      <input
                        class="form-control"
                        [value]="patientdetailsdata?.address"
                        *ngIf="patientdetailsdata?.address"
                      />
                      <input
                        class="form-control"
                        *ngIf="!patientdetailsdata?.address"
                      />
                    </div>
                  </div>

                  <div class="col-md-2">
                    <div class="form-group">
                      <label>City</label>
                      <input
                        class="form-control"
                        [value]="patientdetailsdata?.city"
                        *ngIf="patientdetailsdata?.city"
                      />
                      <input
                        class="form-control"
                        *ngIf="!patientdetailsdata?.city"
                      />
                    </div>
                  </div>
                  <div class="col-md-2">
                    <div class="form-group">
                      <label>State</label>
                      <input
                        class="form-control"
                        [value]="patientdetailsdata?.state"
                        *ngIf="patientdetailsdata?.state"
                      />
                      <input
                        class="form-control"
                        *ngIf="!patientdetailsdata?.state"
                      />
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label>Habits</label>
                      <textarea
                        type="text"
                        class="form-control"
                        [value]="patientdetailsdata?.habits"
                        *ngIf="patientdetailsdata?.habits"
                      ></textarea>
                      <textarea
                        type="text"
                        class="form-control"
                        *ngIf="!patientdetailsdata?.habits"
                      ></textarea>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="form-group">
                      <label>LifeStyle</label>
                      <textarea
                        type="text"
                        class="form-control"
                        [value]="patientdetailsdata?.lifeStyle"
                        *ngIf="patientdetailsdata?.lifeStyle"
                      ></textarea>
                      <textarea
                        type="text"
                        class="form-control"
                        *ngIf="!patientdetailsdata?.lifeStyle"
                      ></textarea>
                    </div>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="print-questionnaire" class="d-none">
      <div class="card">
        <div class="">
          <h3 class="text-center">
            Questionnaire - {{ patientdetailsdata?.pid }}
          </h3>
          <div class="m-2 p-3">
            <!-- *ngFor="let item of questionariesDetails ; let i=index" -->
            <div>
              <table class="table table-bordered">
                <tr>
                  <th>S.No</th>
                  <th class="questionWidth">Question</th>
                  <th>Response</th>
                  <th>Code</th>
                </tr>
                <ng-template
                  #rowTemplateOutlet1
                  let-index="index"
                  let-index2="index2"
                  let-item="item"
                  let-Question="Question"
                >
                  <tr class="tableheader qnHeading">
                    <!--  -->
                    <td
                      colspan="5"
                      style="
                        background: #ddd;
                        text-align: center;
                        font-weight: bold;
                      "
                      *ngIf="index == 0"
                    >
                      {{ item.name }}
                    </td>
                  </tr>

                  <tr>
                    <td>{{ index + 1 }}</td>
                    <td>{{ Question.question }}</td>
                    <td>
                      <span
                        class="row"
                        *ngIf="
                          Question?.type === 'input' ||
                          Question?.type === 'textArea' ||
                          Question?.type === 'dropdown' ||
                          Question?.type === 'time'
                        "
                      >
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-left: 6px;
                          "
                        /><span style="font-size: 12px">{{
                          Question?.units
                        }}</span>
                      </span>

                      <span *ngIf="Question?.type === 'paragraph'">
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-right: 9px;
                            display: block0;
                          "
                        />
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-right: 9px;
                            display: block0;
                          "
                        />
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-right: 9px;
                            display: block0;
                          "
                        />
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-right: 9px;
                            display: block0;
                          "
                        />
                      </span>
                      <span *ngIf="Question?.type === 'radio'">
                        1.Yes &nbsp;&nbsp; 2.No
                      </span>
                      <span *ngIf="Question?.type === 'options'">
                        <!-- 1.Yes &nbsp;&nbsp;
                                            2.No -->
                        <p
                          *ngFor="
                            let answers of Question?.possibleAnswers;
                            let indexvalue = index
                          "
                        >
                          {{ indexvalue + 1 }}.{{ answers }}
                        </p>
                      </span>
                      <span *ngIf="Question?.type === 'checkbox'">
                        <div
                          class="d-flex"
                          style="align-items: center; margin-bottom: 10px"
                          *ngFor="let answers of Question?.possibleAnswers"
                        >
                          <input type="checkbox" />
                          <span style="padding-left: 8px">{{ answers }}</span>
                        </div>
                      </span>
                      <span *ngIf="Question?.type === 'numeric'">
                        <div>
                          <div style="display: flex">
                            <p
                              style="border: solid 1px #ccc; padding: 15px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 15px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 15px"
                            ></p>
                            <span>{{ Question?.units }}</span>
                          </div>
                        </div>
                      </span>

                      <span
                        *ngIf="Question?.type === 'date'"
                        style="display: flex; justify-content: space-evenly"
                      >
                        <div>
                          <div style="display: flex; justify-content: center">
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                          </div>
                          <div style="text-align: center">dd</div>
                        </div>
                        <div>
                          <div style="display: flex; justify-content: center">
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                          </div>
                          <div style="text-align: center">mm</div>
                        </div>
                        <div>
                          <div style="display: flex; justify-content: center">
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                          </div>
                          <div style="text-align: center">yyyy</div>
                        </div>
                      </span>
                    </td>
                    <td style="width: 15%">{{ Question.code }}</td>
                  </tr>
                  <tr
                    *ngFor="
                      let subQuestion of Question?.subQuestions;
                      let ind = index
                    "
                  >
                    <td>{{ index + 1 }}.{{ ind + 1 }}</td>
                    <td>{{ subQuestion?.question }}</td>

                    <td>
                      <span
                        class="row"
                        *ngIf="
                          subQuestion?.type === 'input' ||
                          subQuestion?.type === 'textArea' ||
                          subQuestion?.type === 'dropdown' ||
                          subQuestion?.type === 'time'
                        "
                      >
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-left: 6px;
                          "
                        /><span style="font-size: 12px">{{
                          subQuestion?.units
                        }}</span>
                      </span>
                      <span *ngIf="subQuestion?.type === 'radio'">
                        1.Yes &nbsp;&nbsp; 2.No
                      </span>
                      <span *ngIf="subQuestion?.type === 'options'">
                        <!-- 1.Yes &nbsp;&nbsp;
                                            2.No -->
                        <p
                          *ngFor="
                            let answers of subQuestion?.possibleAnswers;
                            let indexvalue = index
                          "
                        >
                          {{ indexvalue + 1 }}.{{ answers }}
                        </p>
                      </span>
                      <span *ngIf="subQuestion?.type === 'checkbox'">
                        <div
                          class="d-flex"
                          style="align-items: center; margin-bottom: 10px"
                          *ngFor="let answers of subQuestion?.possibleAnswers"
                        >
                          <input type="checkbox" />
                          <span style="padding-left: 8px">{{ answers }}</span>
                        </div>
                      </span>
                      <span *ngIf="subQuestion?.type === 'numeric'">
                        <div>
                          <div style="display: flex">
                            <p
                              style="border: solid 1px #ccc; padding: 15px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 15px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 15px"
                            ></p>
                            <span>{{ subQuestion?.units }}</span>
                          </div>
                        </div>
                      </span>
                      <span *ngIf="Question?.type === 'paragraph'">
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-right: 9px;
                            display: block0;
                          "
                        />
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-right: 9px;
                            display: block0;
                          "
                        />
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-right: 9px;
                            display: block0;
                          "
                        />
                        <input
                          type="text"
                          style="
                            border-width: 0px 0px 1px;
                            border-style: dashed;
                            border-color: black;
                            margin-right: 9px;
                            display: block0;
                          "
                        />
                      </span>
                      <span
                        *ngIf="subQuestion?.type === 'date'"
                        style="display: flex; justify-content: space-evenly"
                      >
                        <div>
                          <div style="display: flex; justify-content: center">
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                          </div>
                          <div style="text-align: center">dd</div>
                        </div>
                        <div>
                          <div style="display: flex; justify-content: center">
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                          </div>
                          <div style="text-align: center">mm</div>
                        </div>
                        <div>
                          <div style="display: flex; justify-content: center">
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                            <p
                              style="border: solid 1px #ccc; padding: 10px"
                            ></p>
                          </div>
                          <div style="text-align: center">yyyy</div>
                        </div>
                      </span>
                    </td>
                    <td style="width: 15%">{{ subQuestion?.code }}</td>
                  </tr>
                </ng-template>

                <ng-container
                  *ngFor="let item of questionariesDetails; let inde = index"
                >
                  <ng-container
                    *ngFor="let Question of item?.questions; let i = index"
                  >
                    <ng-container
                      *ngTemplateOutlet="
                        rowTemplateOutlet1;
                        context: {
                          item: item,
                          Question: Question,
                          index: i,
                          index2: inde
                        }
                      "
                    >
                    </ng-container>
                  </ng-container>
                </ng-container>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div id="print-barcode" class="d-none">
      <table>
        <tbody>
          <tr>
            <td>
              <ngx-barcode
                [bc-value]="value"
                [bc-display-value]="true"
              ></ngx-barcode>
            </td>
            <td>
              <ngx-barcode
                [bc-value]="value"
                [bc-display-value]="true"
              ></ngx-barcode>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <ng-template #myDailog>
      <mat-dialog-content>
        <div class="modal-heading-div">
          <h2 matDialogTitle class="mat">Update Test Values</h2>
          <button
            mat-button
            matDialogClose
            color="primary"
            class="cancel-button"
          >
            <i class="fa fa-times"></i>
          </button>
        </div>
        <mat-card>
          <form [formGroup]="updateTestsForm" (ngSubmit)="updateTestsDetails()">
            <div class="form-group">
              <label for="">Test Name</label>
              <!-- <input class="form-ontrol" [disabled] formControlName="test"> -->
              <select disabled formControlName="test" class="form-control">
                <option *ngFor="let item of testsDetails" [value]="item._id">
                  {{ item.name }}
                </option>
              </select>
            </div>
            <div class="form-group">
              <label for="">Value</label>
              <input class="form-control" formControlName="value" />
            </div>
            <div class="form-group">
              <label for="">Comment</label>
              <input class="form-control" formControlName="comment" />
            </div>
            <div>
              <button class="btn" type="submit">Update</button>
            </div>
          </form>
        </mat-card>
      </mat-dialog-content>
    </ng-template>

    <ng-template #content let-modal>
      <!-- <div></div> -->
      <div class="modal-header">
        <h4 class="modal-title" id="modal-basic-title">
          Report Template: <b>{{ currentItem.test.name }}</b>
        </h4>
        <button
          type="button"
          class="close"
          aria-label="Close"
          (click)="modal.dismiss('Cross click')"
        >
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- *ngIf="!docViweEditorFlag" -->
        <div>
          <!-- <div><button></button></div> -->
          <!-- <ngx-doc-viewer [url]="doc" viewer="google" style="width:100%;height:50vh;"></ngx-doc-viewer> -->
          <div class="text-right">
            <!-- <button class="btn btn-md mb-4" (click)="toggleDisabled()">
                        {{ isDisabled ? 'Edit Template' : 'Cancel' }}
                    </button> -->
          </div>
          <div class="col-md-12">
            <div class="border p-3">
              <p class="mb-0" [innerHtml]="templateViewContent"></p>
            </div>
            <!-- data="templateViewContent" (change)="changedTemplateContent($event)"-->
            <!-- <ckeditor [editor]="Editor" [(ngModel)]="templateViewContent" [disabled]="isDisabled">
                    </ckeditor> -->
          </div>
        </div>
        <!-- <div *ngIf="docViweEditorFlag">
                <h6>Edit section</h6>
            </div> -->
      </div>
      <div class="modal-footer">
        <!-- (click)="editDocView()"-->
        <!-- <button type="button" class="btn btn-outline-dark" (click)="modal.close('Save click')"> Cancel</button> -->
        <!-- <button type="button" class="btn btn-outline-dark" (click)="saveTemplateEditData()">Save changes</button> -->
      </div>
    </ng-template>

    <ng-template #openTestsModal>
      <h3 class="mb-2 font-weight-bold">Cancel Test</h3>
      <mat-dialog-content>
        <div class="">
          <form [formGroup]="reasonForm" (ngSubmit)="submitReason()">
            <div class="form-group">
              <label for="" class="title_info">Reason</label>
              <input
                type="text"
                class="form-control"
                formControlName="cancel_reason"
              />
            </div>

            <!-- <div class="button-alignment text-right">
                <button class="button-select mr-2" [mat-dialog-close]="true" cdkFocusInitial>Close</button>
                <button class="button-select" cdkFocusInitial>Confirm cancel</button>
            </div> -->

            <!-- <div class="col-md-4"></div>
                <div class="col-md-3">
                </div> -->

            <div class="row button-alignment">
              <div class="col-md-12 d-flex">
                <button
                  [mat-dialog-close]="true"
                  class="form-control cancel-btn button_bg mr-2"
                >
                  Cancel
                </button>
                <button
                  class="form-control confirm-btn"
                  [disabled]="!reasonForm.valid"
                  [ngClass]="{ btnDisabled: !reasonForm.valid }"
                >
                  Confirm cancel
                </button>
              </div>
            </div>
          </form>
        </div>
      </mat-dialog-content>
    </ng-template>

    <ng-template #vaccineModal>
      <p>modal</p>
    </ng-template>

    <ng-template #downloadTestReport>
      <mat-dialog-content>
        <div>
          <div class="d-flex justify-content-between">
            <h1 mat-dialog-title>Download Report</h1>
            <div class="button">
              <a
                class="btn btn-xs btn-icon btn-hover-primary btn_close"
                href="javascript:void(0)"
                (click)="onClose()"
                >X</a
              >
            </div>
          </div>
          <form [formGroup]="templeteForm">
            <div class="row">
              <div class="col-md-4 mt-3">
                <input
                  type="checkBox"
                  name="promotion"
                  id="promotion"
                  [formControl]="templeteForm.controls['promotionPage']"
                />
                <label for="promotion">Promotion Page</label>
              </div>
              <div class="col-md-6">
                <mat-form-field class="full-width">
                  <mat-label>Select Header</mat-label>
                  <mat-select
                    class=""
                    [formControl]="templeteForm.controls['header_type']"
                  >
                    <mat-option value="true"> With Header </mat-option>
                    <mat-option value="false"> Without Header </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>

            <div class="row buttons mt-3">
              <div style="margin: 0 auto">
                <button
                  *ngIf="!patientdetailsdata?.isReferralPatient"
                  class="button-mat"
                  (click)="downloadReport(selectedDownloadTest)"
                  [ngClass]="{ btnDisabled: !templeteForm.valid }"
                  [disabled]="!templeteForm.valid"
                >
                  Download
                </button>
                <button
                  *ngIf="patientdetailsdata?.isReferralPatient"
                  class="button-mat"
                  (click)="
                    downloadReferralTestReport(
                      selectedDownloadTest,
                      patientdetailsdata
                    )
                  "
                  [ngClass]="{ btnDisabled: !templeteForm.valid }"
                  [disabled]="!templeteForm.valid"
                >
                  Download
                </button>
              </div>
            </div>
          </form>
        </div>
      </mat-dialog-content>
      <ngx-spinner
        bdColor="rgba(0, 0, 0, 0.8)"
        size="medium"
        color="#fff"
        type="timer"
        [fullScreen]="true"
      >
        <p style="color: white">Processing...</p>
      </ngx-spinner>
    </ng-template>
    <ng-template #testObjInfo>
      <div class="card" style="overflow: auto; height: 90vh">
        <ngx-json-viewer [json]="selectedTestInfoObj"></ngx-json-viewer>
      </div>
    </ng-template>

    <ng-template #addBulkDialog>
      <mat-dialog-content>
        <div>
          <form>
            <div class="mb-5" [formGroup]="bulkUploadForm">
              <div class="d-flex justify-content-between">
                <h1 mat-dialog-title>Upload Bulk Patients</h1>
                <div class="button">
                  <a
                    class="btn btn-xs btn-icon btn-hover-primary btn_close"
                    href="javascript:void(0)"
                    (click)="onClose()"
                    >X</a
                  >
                </div>
              </div>
              <div></div>
              <div class="mt-2">
                <!-- <mat-form-field class="full-width">
                <input type="text" [(ngModel)]="organizationName" matInput placeholder="Select Organization" (ngModelChange)=onSelectionChanged($event) [matAutocomplete]="autoCo" />
                <mat-autocomplete #autoCo="matAutocomplete"  >
                    <mat-option *ngFor="let item of filteredOrganizations" [value]="item?.name">
                      {{item?.name}} - {{item?.category}}
                    </mat-option>
                </mat-autocomplete>
              </mat-form-field> -->
                <!-- *ngIf="userdetails?.role == 'admin'" -->
                <mat-form-field class="full-width">
                  <mat-label>Select Organization</mat-label>
                  <mat-select
                    formControlName="subdivisionID"
                    (selectionChange)="selectedOrganization($event.value)"
                  >
                    <mat-option
                      *ngFor="let item of organizations"
                      [value]="item?._id"
                      >{{ item?.name }} - {{ item?.category }} -
                      {{ item?.referenceCode }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                <p class="text-danger">{{ this.errormessage }}</p>
                <!-- <input class="full-width select_input"  type="text"readonly [ngModel]="subdivisionName" *ngIf="userdetails?.role != 'admin'"> -->
              </div>
              <label>Excel File:</label>
              <div class="input-group mb-3">
                <input
                  type="file"
                  class="form-control field"
                  accept=".csv,.xls,.xlsx"
                  placeholder="Excel File"
                  aria-label="Username"
                  (change)="onFileChanges($event)"
                  aria-describedby="basic-addon1"
                />
              </div>
              <p class="text-danger">{{ this.errormessage1 }}</p>
            </div>
            <div class="row buttons" style="justify-content: center">
              <div class="cancel mr-1">
                <button (click)="sampleFileDownload()" class="button-mat">
                  Download Sample File
                </button>
              </div>

              <div class="">
                <button class="button-mat" (click)="onSubmitUpload()">
                  Upload
                </button>
              </div>
              <div class="cancel mr-1">
                <button (click)="onClose()" class="button-mat">Cancel</button>
              </div>
            </div>
          </form>
        </div>
      </mat-dialog-content>
      <ngx-spinner
        bdColor="rgba(0, 0, 0, 0.8)"
        size="medium"
        color="#fff"
        type="timer"
        [fullScreen]="true"
      >
        <p style="color: white">Processing...</p>
      </ngx-spinner>
    </ng-template>

    <div class="d-none">
      <table id="patient-invalid-records">
        <tr>
          <th>SL NO</th>
          <th>NAME</th>
          <th>AGE</th>
          <th>Gender</th>
          <th>Mobile</th>
          <th>Address</th>
          <th>ADHAR CARD</th>
          <th>PASSPORt</th>
          <th>LOCATION</th>
          <th>Reference Code</th>
          <th>Test Code</th>
          <th>Sample Register Date</th>
        </tr>
        <tr *ngFor="let item of invalidRecordsData; let i = index">
          <td>{{ i + 1 }}</td>
          <td>{{ item?.name }}</td>
          <td>{{ item?.age }}</td>
          <td>{{ item?.gender }}</td>
          <td>{{ item?.mobileNumber }}</td>
          <td>{{ item?.address }}</td>
          <td>{{ item?.aadhaar }}</td>
          <td>{{ item?.passport }}</td>
          <td>{{ item?.location }}</td>
          <td>{{ item?.referenceCode }}</td>
          <td>{{ item?.test }}</td>
          <td>{{ item?.sampleDate }}</td>
        </tr>
      </table>
    </div>
    <ngx-spinner
      bdColor="rgba(0, 0, 0, 0.8)"
      size="medium"
      color="#fff"
      type="timer"
      [fullScreen]="true"
    >
      <p style="color: white">Processing...</p>
    </ngx-spinner>

    <ng-template #sendPaymentLink>
      <div class="col-md-12 d-flex mt-3 text-center">
        <h3><b>Payment Link</b></h3>
      </div>
      <mat-radio-group
        [(ngModel)]="paymentLinkType"
        name="paymentLinkType"
        aria-label="Select an option"
        class="checkbox row"
      >
        <!-- <mat-radio-button class="col-lg-4 optionText" value="email">Email
      </mat-radio-button> -->
        <mat-radio-button
          class="col-lg-4 optionText"
          name="type_payment"
          value="sms"
          >SMS
        </mat-radio-button>
        <mat-radio-button
          class="col-lg-4 optionText"
          name="type_payment"
          value="whats_app"
          >WhatsApp
        </mat-radio-button>
      </mat-radio-group>

      <div class="col-md-6 d-flex mt-2" *ngIf="paymentLinkType == 'email'">
        <input
          class="inputbox"
          type="email"
          name="email"
          id="email"
          placeholder="Enter Email"
        />
      </div>

      <div class="col-md-6 d-flex mt-2" *ngIf="paymentLinkType != 'email'">
        <input
          class="inputbox"
          type="number"
          [(ngModel)]="patientpaymentObj.patient.mobileNumber"
          name="mobileNumber"
          id="mobileNumber"
          placeholder="Enter Mobile Number"
        />
      </div>
      <br />
      <div class="col-md-6 d-flex text-center">
        <button
          class="buttondialoge mt-2"
          (click)="createPaymentLink()"
          [disabled]="!patientpaymentObj.patient.mobileNumber"
        >
          Yes
        </button>

        <button
          class="buttondialoge mt-2 ml-2"
          [mat-dialog-close]="true"
          cdkFocusInitial
        >
          Close
        </button>
      </div>
      <ngx-spinner
        bdColor="rgba(0, 0, 0, 0.8)"
        size="medium"
        color="#fff"
        type="timer"
        [fullScreen]="true"
      >
        <p style="color: white">Loading...</p>
      </ngx-spinner>
    </ng-template>

    <ng-template #transationLogModal>
      <div class="col-md-12 d-flex mt-3 text-center">
        <h3><b>Transaction Details</b></h3>
      </div>

      <div class="table-responsive" style="height: 50vh; overflow: scroll">
        <table class="table table-hover">
          <thead>
            <tr class="text-center">
              <th>S.NO</th>
              <th>Transaction Date</th>
              <th>Transaction Type</th>
              <th>Paid Details</th>
              <th>Amount</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody>
            <tr
              class="text-center"
              *ngFor="let transInfo of transactionLog$.reverse(); let i = index"
            >
              <td>{{ i + 1 }}</td>
              <td>{{ transInfo.transactionDate }}</td>
              <td>{{ transInfo.transactionType }}</td>
              <td>
                {{ transInfo.details | json }}
              </td>
              <td>{{ transInfo.transactionAmount }}</td>
              <td>
                {{ transInfo.status }}
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="col-md-6 d-flex text-center">
        <button
          class="buttondialoge mt-2 ml-2"
          [mat-dialog-close]="true"
          cdkFocusInitial
        >
          Close
        </button>
      </div>
    </ng-template>
  </mat-tab>
</mat-tab-group>

  